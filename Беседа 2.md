<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# üìã –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê MAX-LOYALTY

–Ø –∏–∑—É—á–∏–ª –≤–µ—Å—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–∏–∞–ª–æ–≥ –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω–æ. –í–æ—Ç **–ø–æ–ª–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**, –∫–æ—Ç–æ—Ä—É—é –º—ã –≤—ã—Å—Ç—Ä–æ–∏–ª–∏ –≤–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º–∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑—è–º–∏ –∏ —Ä–æ–ª—è–º–∏:

***

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –£–†–û–í–ù–ò

### **–£–†–û–í–ï–ù–¨ 1: –ü–õ–ê–¢–§–û–†–ú–ê (OWNER)**

**–†–æ–ª—å:** –í–ª–∞–¥–µ–ª–µ—Ü –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π

- –í–∏–¥–∏—Ç **–≥–ª–æ–±–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –≤—Å–µ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º**
- –£–ø—Ä–∞–≤–ª—è–µ—Ç **–∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤** (—Å–æ–∑–¥–∞–Ω–∏–µ, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ)
- –ú–æ–∂–µ—Ç –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –ª—é–±–æ–π **RestaurantAdmin account** (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ú–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å **–ø–∞—Ä–æ–ª–∏ –ª—é–±—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
- –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å **—Å–ø–µ—Ü-—Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤** (Self-registration)
- –£–ø—Ä–∞–≤–ª—è–µ—Ç **6 —Ç–∞—Ä–∏—Ñ–∞–º–∏** –∏ –∏—Ö —Ü–µ–Ω–∞–º–∏
- –í–∏–¥–∏—Ç **—Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –≤—Å–µ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º**
- –£–ø—Ä–∞–≤–ª—è–µ—Ç **–±–∏–ª–ª–∏–Ω–≥–æ–º –∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏**

**–î–∞–Ω–Ω—ã–µ –≤ –ë–î:**

- `User` —Å role = `OWNER`
- `Account` (–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∫–∞–∫ —Ü–µ–ª–æ–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
- `GlobalAnalytics` (–ø—Ä–æ—Å–º–æ—Ç—Ä—ã –ø–æ –≤—Å–µ–º —Ç–µ–Ω–∞–Ω—Ç–∞–º)

***

### **–£–†–û–í–ï–ù–¨ 2: RESTAURANT ACCOUNT (SUBSCRIPTION LEVEL)**

**–ß—Ç–æ —ç—Ç–æ:** –ê–∫–∫–∞—É–Ω—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –∫—É–ø–∏–ª —Ç–∞—Ä–∏—Ñ
**–¢–∞—Ä–∏—Ñ:** STANDARD / MEDIUM / PRO / ULTIMATE / CUSTOM / FREE
**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ—É:**

- STANDARD: 1 —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –¥–æ 500 –≥–æ—Å—Ç–µ–π
- MEDIUM: 3 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞, –¥–æ 2000 –≥–æ—Å—Ç–µ–π
- PRO: 5 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, –¥–æ 6000 –≥–æ—Å—Ç–µ–π
- ULTIMATE: ‚àû —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, ‚àû –≥–æ—Å—Ç–µ–π
- CUSTOM: –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã
- FREE: –±–µ–∑–ª–∏–º–∏—Ç, —Ç–æ–ª—å–∫–æ –¥–ª—è Owner

**–ü–ª–∞—Ç–µ–∂–Ω–∞—è –º–æ–¥–µ–ª—å:**

- –ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (–ø–æ–ª–Ω–∞—è —Ü–µ–Ω–∞)
- –ì–æ–¥–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (—Å–∫–∏–¥–∫–∞ 20%)

**–î–∞–Ω–Ω—ã–µ –≤ –ë–î:**

- `Tenant` (–æ—Å–Ω–æ–≤–Ω–æ–π record –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏)
- `Subscription` (—Ç–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ + –∏—Å—Ç–æ—Ä–∏—è)
- `BillingInfo` (–ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- `TenantLimits` (–ª–∏–º–∏—Ç—ã –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ç–∞—Ä–∏—Ñ—É)

***

### **–£–†–û–í–ï–ù–¨ 3: RESTAURANT ADMIN (–£–ü–†–ê–í–õ–Ø–Æ–©–ò–ô –†–ï–°–¢–û–†–ê–ù–ê/–°–ï–¢–ò)**

**–†–æ–ª—å:** RestaurantAdmin
**–ú–æ–∂–µ—Ç –±—ã—Ç—å:** 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º Tenant
**–ü—Ä–∞–≤–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ:** –ú–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –í–∏–¥–∏—Ç **–í–°–ï —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –≤ —Å–≤–æ–µ–π —Å–µ—Ç–∏** (–µ—Å–ª–∏ —Å–µ—Ç—å)
- –í–∏–¥–∏—Ç **–æ–±—â—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –≤—Å–µ–π —Å–µ—Ç–∏**
- –°–æ–∑–¥–∞–µ—Ç **–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤** (–ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º)
- –°–æ–∑–¥–∞–µ—Ç **–∫–∞—Å—Å–∏—Ä–æ–≤** (–ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º)
- –°–æ–∑–¥–∞–µ—Ç –¥—Ä—É–≥–∏—Ö **RestaurantAdmin** —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –ü—Ä–æ–≤–æ–¥–∏—Ç **–∫–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko –∏ R-Keeper)
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:**
    - –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø: —Å–∫–∏–¥–æ—á–Ω–∞—è –∏–ª–∏ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è
    - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ (–ë—Ä–æ–Ω–∑–∞, –°–µ—Ä–µ–±—Ä–æ, –ó–æ–ª–æ—Ç–æ, –∏ —Ç.–¥.)
    - –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å **–æ–±—â—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –≤—Å–µ–π —Å–µ—Ç–∏** –∏–ª–∏ **–æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**
    - –í—ã–±–∏—Ä–∞–µ—Ç –¥–∏–∑–∞–π–Ω –∫–∞—Ä—Ç—ã –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ª–æ–≥–æ—Ç–∏–ø
    - –°–æ–∑–¥–∞–µ—Ç **–ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏** (–¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è, –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∫–∞—Å—Ç–æ–º–Ω—ã–µ)
    - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç **—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –≥–æ—Å—Ç–µ–π** (—Ä–∞–∑–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ª—é–¥–µ–π)
- –í–∏–¥–∏—Ç **–≤—Å–µ—Ö –≥–æ—Å—Ç–µ–π** (–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—ã)
- –ú–æ–∂–µ—Ç **—Ä—É—á–Ω–æ –Ω–∞—á–∏—Å–ª—è—Ç—å/—Å–ø–∏—Å—ã–≤–∞—Ç—å –±–∞–ª–ª—ã** (–≤—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è)
- –í–∏–¥–∏—Ç **–ø–æ–ª–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É**

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞:**

- –ú–æ–≥—É—Ç –±—ã—Ç—å —É—Ä–µ–∑–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–∞–º–∏)
- –ú–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É)

**–î–∞–Ω–Ω—ã–µ –≤ –ë–î:**

- `User` —Å role = `RESTAURANT_ADMIN`
- `UserRole` (—Å–≤—è–∑—å User ‚Üî Tenant)
- `UserPermission` (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞)
- `RestaurantAdmin` (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π —Ä–æ–ª–∏)

***

### **–£–†–û–í–ï–ù–¨ 4: MANAGER (–ú–ï–ù–ï–î–ñ–ï–† –ö–û–ù–ö–†–ï–¢–ù–û–ì–û –†–ï–°–¢–û–†–ê–ù–ê)**

**–†–æ–ª—å:** Manager
**–ü—Ä–∏–≤—è–∑–∫–∞:** –ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É –≤ —Å–µ—Ç–∏
**–í–∏–¥–∏–º–æ—Å—Ç—å:** –ü–û–õ–ù–ê–Ø –ò–ó–û–õ–Ø–¶–ò–Ø (–≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω)
**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:** RestaurantAdmin –º–æ–∂–µ—Ç –¥–∞—Ç—å –µ–º—É –¥–æ—Å—Ç—É–ø –∫ –¥—Ä—É–≥–∏–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –í–∏–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**
- –í–∏–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –≥–æ—Å—Ç–µ–π —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**
- –í–∏–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞**
- –ú–æ–∂–µ—Ç **—Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–∞—Å—Å–∏—Ä–æ–≤** (–¥–ª—è —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
- –ú–æ–∂–µ—Ç **–Ω–∞–∑–Ω–∞—á–∞—Ç—å –∫–∞—Å—Å–∏—Ä–æ–≤**
- –ú–æ–∂–µ—Ç **–ø—Ä–æ–≤–æ–¥–∏—Ç—å –∫–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ü–û–°)
- –ú–æ–∂–µ—Ç **—Ä—É—á–Ω–æ –Ω–∞—á–∏—Å–ª—è—Ç—å/—Å–ø–∏—Å—ã–≤–∞—Ç—å –±–∞–ª–ª—ã** (–µ—Å–ª–∏ –Ω–µ —É–±—Ä–∞–ª Admin)
- –ú–æ–∂–µ—Ç **—Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Å—Ç–µ–π**
- –ú–æ–∂–µ—Ç **–≤–∏–¥–µ—Ç—å –≥–æ—Å—Ç–µ–π**
- –ú–æ–∂–µ—Ç **–≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å –±–∞–ª–ª–∞–º–∏** (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞:**

- RestaurantAdmin –º–æ–∂–µ—Ç —É–±—Ä–∞—Ç—å –ø—Ä–∞–≤–æ –Ω–∞ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–∞–º–∏
- RestaurantAdmin –º–æ–∂–µ—Ç –¥–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- RestaurantAdmin –º–æ–∂–µ—Ç –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥—Ä—É–≥–∏–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º —Å–µ—Ç–∏

**–î–∞–Ω–Ω—ã–µ –≤ –ë–î:**

- `User` —Å role = `MANAGER`
- `UserRole` (—Å–≤—è–∑—å User ‚Üî Restaurant)
- `UserPermission` (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞)
- `RestaurantManager` (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π —Ä–æ–ª–∏)

***

### **–£–†–û–í–ï–ù–¨ 5: CASHIER (–ö–ê–°–°–ò–†)**

**–†–æ–ª—å:** Cashier
**–ü—Ä–∏–≤—è–∑–∫–∞:** –ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É
**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** –¢–û–õ–¨–ö–û —Ä–∞–±–æ—Ç–∞ —Å –ü–û–° —Å–∏—Å—Ç–µ–º–æ–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –ú–æ–∂–µ—Ç **–Ω–∞—á–∏—Å–ª—è—Ç—å/—Å–ø–∏—Å—ã–≤–∞—Ç—å –±–∞–ª–ª—ã** —á–µ—Ä–µ–∑ –ü–û–°
- –ú–æ–∂–µ—Ç **—Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–æ—Å—Ç–µ–π** (—Ç–µ–ª–µ—Ñ–æ–Ω, –∏–º—è, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ú–æ–∂–µ—Ç **–¥–æ–±–∞–≤–ª—è—Ç—å –¥–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –æ –≥–æ—Å—Ç—è—Ö (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- –í–∏–¥–∏—Ç **–±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –æ –≥–æ—Å—Ç—è—Ö
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é **–ù–ï –≤–∏–¥–∏—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É** (–Ω–æ Admin –º–æ–∂–µ—Ç –¥–∞—Ç—å)

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞:**

- RestaurantAdmin –º–æ–∂–µ—Ç –¥–∞—Ç—å –ø—Ä–∞–≤–æ –≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- RestaurantAdmin –º–æ–∂–µ—Ç –¥–∞—Ç—å –ø—Ä–∞–≤–æ –Ω–∞ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–∞–º–∏ (–Ω–µ–æ–±—ã—á–Ω–æ)
- RestaurantAdmin –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º

**–î–∞–Ω–Ω—ã–µ –≤ –ë–î:**

- `User` —Å role = `CASHIER`
- `UserRole` (—Å–≤—è–∑—å User ‚Üî Restaurant)
- `UserPermission` (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞)

***

### **–£–†–û–í–ï–ù–¨ 6: GUEST (–ì–û–°–¢–¨)**

**–†–æ–ª—å:** Guest (–Ω–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** 3 —Å–ø–æ—Å–æ–±–∞:

1. **–ß–µ—Ä–µ–∑ –∫–∞—Å—Å–∏—Ä–∞** (–æ—Ñ–∏—Ü–∏–∞–Ω—Ç/–∫–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç –∏–º—è + —Ç–µ–ª–µ—Ñ–æ–Ω + –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è)
2. **–ü–æ —Å—Å—ã–ª–∫–µ** (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –±—ã—Å—Ç—Ä–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞)
3. **–ß–µ—Ä–µ–∑ Telegram –±–æ—Ç** (–º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram ID –∏–ª–∏ –Ω–æ–º–µ—Ä)

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –í–∏–¥–∏—Ç **—Å–≤–æ—é –∫–∞—Ä—Ç—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏** –≤ Telegram mini app
- –í–∏–¥–∏—Ç **–∏—Å—Ç–æ—Ä–∏—é –±–∞–ª–ª–æ–≤** (–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è)
- –í–∏–¥–∏—Ç **–∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–µ—â–µ–Ω–∏–π –∏ —á–µ–∫–æ–≤**
- –í–∏–¥–∏—Ç **—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (–±–∞–ª–ª—ã —Å–∫–æ—Ä–æ —Å–≥–æ—Ä—è—Ç, –ø—Ä–∏—à–ª–∏ –Ω–æ–≤—ã–µ –±–∞–ª–ª—ã, –∏ —Ç.–¥.)
- –ú–æ–∂–µ—Ç **—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ 3 –º–µ—Å—è—Ü–∞)
- –ú–æ–∂–µ—Ç **–¥–æ–±–∞–≤–ª—è—Ç—å –¥–µ—Ç–µ–π** –∫ —Å–≤–æ–µ–π –∫–∞—Ä—Ç–µ (–¥–ª—è –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è)
- –í–∏–¥–∏—Ç **QR-–∫–æ–¥ –∏ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥** (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

**–î–∞–Ω–Ω—ã–µ –≤ –ë–î:**

- `User` —Å role = `GUEST`
- `GuestProfile` (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è)
- `GuestCard` (–∫–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏, –±–∞–ª–ª—ã, —É—Ä–æ–≤–µ–Ω—å)
- `GuestChild` (–¥–µ—Ç–∏ –≥–æ—Å—Ç—è)
- `BallTransaction` (–∏—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤)
- `GuestVisit` (–∏—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π)

***

## üè™ –°–¢–†–£–ö–¢–£–†–ê –†–ï–°–¢–û–†–ê–ù–ê –ò –°–ï–¢–ò

### **SINGLE RESTAURANT (–û–¥–∏–Ω —Ä–µ—Å—Ç–æ—Ä–∞–Ω)**

```
Tenant (—Ä–µ—Å—Ç–æ—Ä–∞–Ω)
  ‚îú‚îÄ Subscription (—Ç–∞—Ä–∏—Ñ, –Ω–∞–ø—Ä–∏–º–µ—Ä STANDARD)
  ‚îú‚îÄ RestaurantAdmin (–æ–¥–∏–Ω —É–ø—Ä–∞–≤–ª—è—é—â–∏–π)
  ‚îÇ   ‚îî‚îÄ DynamicPermissions (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞)
  ‚îú‚îÄ Restaurant (–æ–¥–∏–Ω —Ä–µ—Å—Ç–æ—Ä–∞–Ω –≤ —ç—Ç–æ–º —Ç–µ–Ω–∞–Ω—Ç–µ)
  ‚îÇ   ‚îú‚îÄ Manager (–æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ DynamicPermissions
  ‚îÇ   ‚îú‚îÄ Cashier (–æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Å—Å–∏—Ä–æ–≤)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ DynamicPermissions
  ‚îÇ   ‚îú‚îÄ LoyaltySystem (—Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
  ‚îÇ   ‚îÇ   ‚îú‚îÄ LoyaltyLevel (–ë—Ä–æ–Ω–∑–∞, –°–µ—Ä–µ–±—Ä–æ, –ó–æ–ª–æ—Ç–æ)
  ‚îÇ   ‚îÇ   ‚îú‚îÄ LoyaltyRule (–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ LoyaltyPromo (–ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏)
  ‚îÇ   ‚îú‚îÄ Guest (–≥–æ—Å—Ç–∏ —ç—Ç–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
  ‚îÇ   ‚îÇ   ‚îú‚îÄ GuestCard (–∫–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ BallTransaction (–∏—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤)
  ‚îÇ   ‚îî‚îÄ POSIntegration (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ü–û–°)
```


***

### **RESTAURANT CHAIN (–°–µ—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤)**

```
Tenant (—Å–µ—Ç—å)
  ‚îú‚îÄ Subscription (—Ç–∞—Ä–∏—Ñ, –Ω–∞–ø—Ä–∏–º–µ—Ä PRO - 5 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤)
  ‚îú‚îÄ TenantLimits (–ª–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ—É: 5 —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, 6000 –≥–æ—Å—Ç–µ–π)
  ‚îÇ
  ‚îú‚îÄ RestaurantAdmin (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)
  ‚îÇ   ‚îú‚îÄ DynamicPermissions (—Ä–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∞–¥–º–∏–Ω–æ–≤)
  ‚îÇ   ‚îÇ   ‚îú‚îÄ –ê–¥–º–∏–Ω1: –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞
  ‚îÇ   ‚îÇ   ‚îú‚îÄ –ê–¥–º–∏–Ω2: —Ç–æ–ª—å–∫–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏ (–Ω–µ –≤–∏–¥–∏—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ –ê–¥–º–∏–Ω3: —Ç–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–Ω–µ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
  ‚îÇ   ‚îî‚îÄ (–≤–∏–¥–∏—Ç –í–°–ï —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã –≤ —Å–µ—Ç–∏)
  ‚îÇ
  ‚îú‚îÄ GlobalLoyaltySystem (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –û–ë–©–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤—Å–µ–π —Å–µ—Ç–∏)
  ‚îÇ   ‚îú‚îÄ –í–∞—Ä–∏–∞–Ω—Ç A: –ï–¥–∏–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–ª—è –≥–æ—Å—Ç—è (–±–∞–ª–ª—ã –∫–æ–ø—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ)
  ‚îÇ   ‚îú‚îÄ –í–∞—Ä–∏–∞–Ω—Ç B: –†–∞–∑–Ω—ã–µ –∫–∞—Ä—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–Ω–æ –æ–±—â–∏–π –¥–∏–∑–∞–π–Ω)
  ‚îÇ   ‚îî‚îÄ (–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è)
  ‚îÇ
  ‚îú‚îÄ Restaurant (—Ä–µ—Å—Ç–æ—Ä–∞–Ω 1)
  ‚îÇ   ‚îú‚îÄ Manager (—Ç–æ–ª—å–∫–æ —ç—Ç–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏–ª–∏ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏–µ)
  ‚îÇ   ‚îÇ   ‚îú‚îÄ DynamicPermissions
  ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ –ú–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –¢–û–õ–¨–ö–û —Å–≤–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω (–¥–µ—Ñ–æ–ª—Ç)
  ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ (Admin –º–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ä–∏—Ç—å - –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã)
  ‚îÇ   ‚îÇ   ‚îî‚îÄ (–≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≥–æ—Å—Ç–µ–π —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
  ‚îÇ   ‚îú‚îÄ Cashier (—Ç–æ–ª—å–∫–æ —ç—Ç–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
  ‚îÇ   ‚îú‚îÄ LocalLoyaltySystem (—Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
  ‚îÇ   ‚îÇ   ‚îú‚îÄ LoyaltyLevel
  ‚îÇ   ‚îÇ   ‚îú‚îÄ LoyaltyRule
  ‚îÇ   ‚îÇ   ‚îî‚îÄ LoyaltyPromo
  ‚îÇ   ‚îî‚îÄ Guest (–≥–æ—Å—Ç–∏ —ç—Ç–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –¥—Ä—É–≥–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö —Å–µ—Ç–∏)
  ‚îÇ
  ‚îú‚îÄ Restaurant (—Ä–µ—Å—Ç–æ—Ä–∞–Ω 2)
  ‚îÇ   ‚îú‚îÄ Manager
  ‚îÇ   ‚îú‚îÄ Cashier
  ‚îÇ   ‚îú‚îÄ LocalLoyaltySystem
  ‚îÇ   ‚îî‚îÄ Guest (–º–æ–≥—É—Ç –±—ã—Ç—å —Ç–µ –∂–µ –≥–æ—Å—Ç–∏, —á—Ç–æ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ 1)
  ‚îÇ
  ‚îî‚îÄ ... (—Ä–µ—Å—Ç–æ—Ä–∞–Ω 3, 4, 5)
```


***

## üé´ –°–ò–°–¢–ï–ú–ê –õ–û–Ø–õ–¨–ù–û–°–¢–ò (LOYALTY SYSTEM)

### **–¢–ò–ü 1: –°–ö–ò–î–û–ß–ù–ê–Ø –°–ò–°–¢–ï–ú–ê**

```
LoyaltySystem (type = "DISCOUNT")
‚îú‚îÄ LoyaltyLevel
‚îÇ  ‚îú‚îÄ –ë—Ä–æ–Ω–∑–∞: —Å–∫–∏–¥–∫–∞ 5% –Ω–∞ —á–µ–∫
‚îÇ  ‚îú‚îÄ –°–µ—Ä–µ–±—Ä–æ: —Å–∫–∏–¥–∫–∞ 10% –Ω–∞ —á–µ–∫
‚îÇ  ‚îî‚îÄ –ó–æ–ª–æ—Ç–æ: —Å–∫–∏–¥–∫–∞ 15% –Ω–∞ —á–µ–∫
‚îÇ
‚îú‚îÄ LoyaltyRule (—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è)
‚îÇ  ‚îú‚îÄ –ü—Ä–∞–≤–∏–ª–æ 1: –í—Å–µ –Ω–æ–≤—ã–µ –≥–æ—Å—Ç–∏ ‚Üí –ë—Ä–æ–Ω–∑–∞
‚îÇ  ‚îú‚îÄ –ü—Ä–∞–≤–∏–ª–æ 2: –ì–æ—Å—Ç–∏ —Å —Å—É–º–º–æ–π —á–µ–∫–æ–≤ > 10000—Ä ‚Üí –°–µ—Ä–µ–±—Ä–æ
‚îÇ  ‚îî‚îÄ –ü—Ä–∞–≤–∏–ª–æ 3: –ì–æ—Å—Ç–∏ —Å —Å—É–º–º–æ–π > 50000—Ä ‚Üí –ó–æ–ª–æ—Ç–æ
‚îÇ
‚îú‚îÄ LoyaltyPromo (–ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏)
‚îÇ  ‚îú‚îÄ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è: +500 –±–∞–ª–ª–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –¥–æ–ø —Å–∫–∏–¥–∫–∞)
‚îÇ  ‚îú‚îÄ –ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (30+ –¥–Ω–µ–π): +200 –±–∞–ª–ª–æ–≤
‚îÇ  ‚îî‚îÄ –ü–µ—Ä–≤—ã–π —á–µ–∫: +100 –±–∞–ª–ª–æ–≤
‚îÇ
‚îî‚îÄ GuestCard (–∫–∞—Ä—Ç–∞ –≥–æ—Å—Ç—è)
   ‚îî‚îÄ –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç —Å–∫–∏–¥–∫—É: 5%, 10% –∏–ª–∏ 15%
```


### **–¢–ò–ü 2: –ù–ê–ö–û–ü–ò–¢–ï–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê**

```
LoyaltySystem (type = "POINTS")
‚îú‚îÄ LoyaltyLevel
‚îÇ  ‚îú‚îÄ –ë—Ä–æ–Ω–∑–∞: 5% —Å—É–º–º—ã —á–µ–∫–∞ –±–∞–ª–ª–∞–º–∏
‚îÇ  ‚îú‚îÄ –°–µ—Ä–µ–±—Ä–æ: 10% —Å—É–º–º—ã —á–µ–∫–∞ –±–∞–ª–ª–∞–º–∏
‚îÇ  ‚îî‚îÄ –ó–æ–ª–æ—Ç–æ: 15% —Å—É–º–º—ã —á–µ–∫–∞ –±–∞–ª–ª–∞–º–∏
‚îÇ
‚îú‚îÄ LoyaltyRule (—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è)
‚îÇ  ‚îú‚îÄ –ü—Ä–∞–≤–∏–ª–æ 1: –í—Å–µ –Ω–æ–≤—ã–µ –≥–æ—Å—Ç–∏ ‚Üí –ë—Ä–æ–Ω–∑–∞ (5%)
‚îÇ  ‚îú‚îÄ –ü—Ä–∞–≤–∏–ª–æ 2: –ì–æ—Å—Ç–∏ —Å —Å—É–º–º–æ–π > 10000—Ä ‚Üí –°–µ—Ä–µ–±—Ä–æ (10%)
‚îÇ  ‚îî‚îÄ –ü—Ä–∞–≤–∏–ª–æ 3: –ì–æ—Å—Ç–∏ —Å —Å—É–º–º–æ–π > 50000—Ä ‚Üí –ó–æ–ª–æ—Ç–æ (15%)
‚îÇ
‚îú‚îÄ LoyaltyPromo (–ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏)
‚îÇ  ‚îú‚îÄ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è: +1000 –±–∞–ª–ª–æ–≤ (–Ω–∞ 7 –¥–Ω–µ–π)
‚îÇ  ‚îú‚îÄ –ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (30+ –¥–Ω–µ–π): +500 –±–∞–ª–ª–æ–≤
‚îÇ  ‚îî‚îÄ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è —Ä–µ–±–µ–Ω–∫–∞: +500 –±–∞–ª–ª–æ–≤
‚îÇ
‚îú‚îÄ BallTransaction (–∏—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤)
‚îÇ  ‚îú‚îÄ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ: +100 –±–∞–ª–ª–æ–≤ (5% –æ—Ç —á–µ–∫–∞ 2000—Ä)
‚îÇ  ‚îú‚îÄ –°–ø–∏—Å–∞–Ω–∏–µ: -100 –±–∞–ª–ª–æ–≤ (–≥–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –±–∞–ª–ª—ã)
‚îÇ  ‚îî‚îÄ –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: +500/-200 (–º–µ–Ω–µ–¥–∂–µ—Ä)
‚îÇ
‚îî‚îÄ GuestCard (–∫–∞—Ä—Ç–∞ –≥–æ—Å—Ç—è)
   ‚îú‚îÄ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: 2500 –±–∞–ª–ª–æ–≤
   ‚îú‚îÄ –£—Ä–æ–≤–µ–Ω—å: –°–µ—Ä–µ–±—Ä–æ (10%)
   ‚îî‚îÄ –ò—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤ (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
```


***

## üë• –°–ò–°–¢–ï–ú–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò –ì–û–°–¢–ï–ô

### **–°–ü–û–°–û–ë 1: –ß–µ—Ä–µ–∑ –∫–∞—Å—Å–∏—Ä–∞ (–≤ –ü–û–° —Å–∏—Å—Ç–µ–º–µ)**

```
–ü—Ä–æ—Ü–µ—Å—Å:
1. –ì–æ—Å—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω
2. –ö–∞—Å—Å–∏—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ—Å—Ç—è
3. –í–≤–æ–¥–∏—Ç: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ –Ω–∞—à–µ–π –ë–î: User + GuestProfile + GuestCard
5. –ü–û–° —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –Ω–∞—à–µ–π –ë–î (PUSH –æ—Ç –ü–û–°)
6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è QR-–∫–æ–¥ –∏ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
7. –ö–∞—Å—Å–∏—Ä –ø–µ—á–∞—Ç–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ
8. –ì–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º —Å–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç—É –≤ Telegram

–î–∞–Ω–Ω—ã–µ –≤ –ë–î:
‚îú‚îÄ User (phone, password = NULL)
‚îú‚îÄ GuestProfile (name, birthdate, restaurant_id)
‚îú‚îÄ GuestCard (qr_code, code_6_digit, level, balance)
‚îî‚îÄ POSSync (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –ü–û–°)
```


### **–°–ü–û–°–û–ë 2: –ü–æ —Å—Å—ã–ª–∫–µ (–±—ã—Å—Ç—Ä–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)**

```
–ü—Ä–æ—Ü–µ—Å—Å:
1. Admin —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
   https://max-loyalty.com/register?restaurant_id=123&token=xyz
2. –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
3. –í–∏–¥–∏—Ç —Ñ–æ—Ä–º—É: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –í–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏ —Å–æ–∑–¥–∞–µ—Ç –ø–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –ü–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç—É —Å QR-–∫–æ–¥–æ–º –∏ 6-–∑–Ω–∞—á–Ω—ã–º –∫–æ–¥–æ–º
6. –ú–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç—É –≤ Telegram –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–µ –≤ –ë–î:
‚îú‚îÄ User (phone, email, password_hash)
‚îú‚îÄ GuestProfile
‚îú‚îÄ GuestCard
‚îî‚îÄ RegistrationLink (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ –∫–∞–∫–∏–º —Å—Å—ã–ª–∫–∞–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å)
```


### **–°–ü–û–°–û–ë 3: –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç**

```
–ü—Ä–æ—Ü–µ—Å—Å:
1. Admin —Å–æ–∑–¥–∞–µ—Ç Telegram –±–æ—Ç –¥–ª—è —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
   (@restaurant_loyalty_bot)
2. –ë–æ—Ç —É–∂–µ —Å–≤—è–∑–∞–Ω —Å RestaurantAdmin account
3. –ì–æ—Å—Ç—å –ø–∏—à–µ—Ç /start –≤ –±–æ—Ç–µ
4. –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram ID (–±—ã—Å—Ç—Ä–æ, –±–µ–∑ –ø–∞—Ä–æ–ª—è)
   ‚îî‚îÄ –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç telegram_id ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –≥–æ—Å—Ç—è
5. –í–∞—Ä–∏–∞–Ω—Ç B: –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è)
   ‚îî‚îÄ –¢–µ–ª–µ—Ñ–æ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
6. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è mini app (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞)
7. –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç: –∫–∞—Ä—Ç–∞, –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤, QR-–∫–æ–¥, 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
8. –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–µ–π, –∏–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–î–∞–Ω–Ω—ã–µ –≤ –ë–î:
‚îú‚îÄ User (phone, telegram_id, password = NULL)
‚îú‚îÄ UserSession (telegram session)
‚îú‚îÄ GuestProfile
‚îú‚îÄ GuestCard
‚îî‚îÄ TelegramBot (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
```


***

## üéØ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–°–¢–û–†–ê–ù–ê–ú–ò

### **FLOW –î–õ–Ø OWNER**

```
1. Owner —Å–æ–∑–¥–∞–µ—Ç —Å–ø–µ—Ü-—Å—Å—ã–ª–∫—É –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
   ‚îî‚îÄ OwnerRegistrationLink (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∏–ª–∏ –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤–∞—è)

2. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
   ‚îî‚îÄ –í–∏–¥–∏—Ç —Ñ–æ—Ä–º—É: –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –ø–æ—á—Ç–∞, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –§–ò–û –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞

3. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ (Standard, Medium, Pro, Ultimate, Custom)
   ‚îî‚îÄ –í–∏–¥–∏—Ç —Ü–µ–Ω—É (–º–µ—Å—è—á–Ω–∞—è –∏–ª–∏ –≥–æ–¥–æ–≤–∞—è —Å 20% —Å–∫–∏–¥–∫–æ–π)

4. –í–≤–æ–¥–∏—Ç –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Stripe, YooKassa –∏ —Ç.–¥.)
   ‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è Subscription –∑–∞–ø–∏—Å—å

5. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Admin panel
   ‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, —Ä–µ—Å—Ç–æ—Ä–∞–Ω(—ã), –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤, –∫–∞—Å—Å–∏—Ä–æ–≤
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

6. Owner –≤–∏–¥–∏—Ç –≤—Å–µ:
   ‚îî‚îÄ –í—Å–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
   ‚îî‚îÄ –í—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏
   ‚îî‚îÄ –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏
   ‚îî‚îÄ –ú–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ –ª—é–±–æ–π account –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å—ë
```


***

## üîê AUTH FLOW (—É–∂–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω)

```
REGISTRATION:
1. Email + Password + Name + Phone
2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è (8+ —Å–∏–º–≤–æ–ª–æ–≤, —Ü–∏—Ñ—Ä—ã, –∑–∞–≥–ª–∞–≤–Ω—ã–µ)
3. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è (bcrypt)
4. Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–æ–ª–µ–π)
5. –°–æ–∑–¥–∞–Ω–∏–µ User + UserRole + UserPermission

LOGIN:
1. Email –∏–ª–∏ Phone + Password
2. Rate limiting (5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω—É—Ç)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (bcrypt)
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ email_verified (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
5. –°–æ–∑–¥–∞–Ω–∏–µ Session
6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT tokens:
   ‚îú‚îÄ Access token (15 –º–∏–Ω—É—Ç)
   ‚îú‚îÄ Refresh token (30 –¥–Ω–µ–π, –≤ HttpOnly Cookie)
   ‚îî‚îÄ –û–±–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç: user_id, email, role, tenant_id, permissions

LOGOUT:
1. –†–µ–≤–æ–∫–∏—Ä—É–µ–º —Å–µ—Å—Å–∏—é
2. –î–æ–±–∞–≤–ª—è–µ–º refresh token –≤ blacklist
3. –£–¥–∞–ª—è–µ–º cookie

PASSWORD RESET:
1. Email ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É —Å–±—Ä–æ—Å–∞ (30 –º–∏–Ω—É—Ç)
2. –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ
3. –í–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
4. –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å
5. –†–µ–≤–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (security)
```


***

## üìä –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ü–û–° –°–ò–°–¢–ï–ú–ê–ú–ò

```
IIKO + R-KEEPER –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø (PUSH + PULL –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥):

PUSH (–û—Ç –ü–û–° ‚Üí –ö –Ω–∞–º):
‚îú‚îÄ –ö–∞—Å—Å–∏—Ä –ø—Ä–æ–≤–æ–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –ü–û–°
‚îú‚îÄ –ü–û–° —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞–º
‚îú‚îÄ –ú—ã —Å–æ–∑–¥–∞–µ–º BallTransaction –∑–∞–ø–∏—Å—å
‚îú‚îÄ –û–±–Ω–æ–≤–ª—è–µ–º GuestCard –±–∞–ª–∞–Ω—Å
‚îî‚îÄ –õ–æ–≥–∏—Ä—É–µ–º –≤ ActivityLog

PULL (–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å):
‚îú‚îÄ –ö–∞–∂–¥—ã–π —á–∞—Å (–∏–ª–∏ —Ä–µ–∂–µ) –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º:
‚îÇ  ‚îú‚îÄ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥–æ—Å—Ç–µ–π
‚îÇ  ‚îú‚îÄ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
‚îÇ  ‚îú‚îÄ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å –Ω–∞—à–µ–π –ë–î
‚îÇ  ‚îî‚îÄ –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è
‚îî‚îÄ –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ webhook –Ω–µ –¥–æ—à–µ–ª

–î–ê–ù–ù–´–ï –í –ë–î:
‚îú‚îÄ POSIntegration (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
‚îú‚îÄ POSSync (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π)
‚îú‚îÄ POSTransaction (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑ –ü–û–°)
‚îî‚îÄ BallTransaction (–Ω–∞—à–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π)
```


***

## ü§ñ TELEGRAM –ë–û–¢ –ò MINI APP

```
TELEGRAM BOT:
‚îú‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚îú‚îÄ Admin –º–æ–∂–µ—Ç —Å–≤—è–∑–∞—Ç—å —Å Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
‚îú‚îÄ –ö–æ–º–∞–Ω–¥—ã:
‚îÇ  ‚îú‚îÄ /start ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram ID –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
‚îÇ  ‚îú‚îÄ /card ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É (QR + 6-digit –∫–æ–¥)
‚îÇ  ‚îú‚îÄ /balance ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤
‚îÇ  ‚îú‚îÄ /history ‚Üí –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
‚îÇ  ‚îú‚îÄ /settings ‚Üí —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ  ‚îî‚îÄ /support ‚Üí –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
‚îÇ
‚îî‚îÄ MINI APP (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ):
   ‚îú‚îÄ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ Telegram
   ‚îú‚îÄ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∫—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω)
   ‚îú‚îÄ QR-–∫–æ–¥ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
   ‚îú‚îÄ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
   ‚îú‚îÄ –ë–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤
   ‚îú‚îÄ –ò—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è)
   ‚îú‚îÄ –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π (–¥–∞—Ç–∞, —Å—É–º–º–∞ —á–µ–∫–∞, —á—Ç–æ –∑–∞–∫–∞–∑–∞–ª)
   ‚îú‚îÄ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
   ‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–µ–π (–¥–ª—è –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π)
   ‚îú‚îÄ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±–∞–ª–ª—ã —Å–∫–æ—Ä–æ —Å–≥–æ—Ä—è—Ç, –Ω–æ–≤—ã–µ –±–∞–ª–ª—ã, –∏ —Ç.–¥.)
   ‚îî‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–î–ê–ù–ù–´–ï –í –ë–î:
‚îú‚îÄ TelegramBot (–∫–æ–Ω—Ñ–∏–≥ –±–æ—Ç–∞)
‚îú‚îÄ TelegramUser (–ø—Ä–∏–≤—è–∑–∫–∞ telegram_id ‚Üí User)
‚îú‚îÄ TelegramSession (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –≤ Telegram)
‚îî‚îÄ TelegramMiniApp (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è mini app)
```


***

## üí∞ –¢–ê–†–ò–§–ò–ö–ê–¶–ò–Ø –ò –ü–û–î–ü–ò–°–ö–ò

```
–¢–ê–ë–õ–ò–¶–ê –¢–ê–†–ò–§–û–í:

FREE (–¢–æ–ª—å–∫–æ –¥–ª—è Owner, –±–µ–∑–ª–∏–º–∏—Ç –Ω–∞ –≤—Å—ë):
‚îú‚îÄ –¶–µ–Ω–∞: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
‚îú‚îÄ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã: ‚àû
‚îú‚îÄ –ì–æ—Å—Ç–∏: ‚àû
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: ‚úì –ü–æ–ª–Ω–∞—è
‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è: —Ç–æ–ª—å–∫–æ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ Owner

STANDARD (–î–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤):
‚îú‚îÄ –¶–µ–Ω–∞: 5000—Ä/–º–µ—Å—è—Ü (4000—Ä/–º–µ—Å—è—Ü –ø—Ä–∏ –≥–æ–¥–æ–≤–æ–π = 48000—Ä)
‚îú‚îÄ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã: 1
‚îú‚îÄ –ì–æ—Å—Ç–∏: –¥–æ 500
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: ‚úì –ü–æ–ª–Ω–∞—è
‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è: —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ

MEDIUM (–î–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö —Å–µ—Ç–µ–π):
‚îú‚îÄ –¶–µ–Ω–∞: 15000—Ä/–º–µ—Å—è—Ü (12000—Ä/–º–µ—Å—è—Ü –ø—Ä–∏ –≥–æ–¥–æ–≤–æ–π = 144000—Ä)
‚îú‚îÄ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã: 3
‚îú‚îÄ –ì–æ—Å—Ç–∏: –¥–æ 2000
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: ‚úì –ü–æ–ª–Ω–∞—è
‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è: —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ

PRO (–î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —Å–µ—Ç–µ–π):
‚îú‚îÄ –¶–µ–Ω–∞: 35000—Ä/–º–µ—Å—è—Ü (28000—Ä/–º–µ—Å—è—Ü –ø—Ä–∏ –≥–æ–¥–æ–≤–æ–π = 336000—Ä)
‚îú‚îÄ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã: 5
‚îú‚îÄ –ì–æ—Å—Ç–∏: –¥–æ 6000
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: ‚úì –ü–æ–ª–Ω–∞—è
‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è: —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ

ULTIMATE (–î–ª—è –∫—Ä—É–ø–Ω—ã—Ö —Å–µ—Ç–µ–π):
‚îú‚îÄ –¶–µ–Ω–∞: –¥–æ–≥–æ–≤–æ—Ä–Ω–∞—è (–æ—Ç 100000—Ä+/–º–µ—Å—è—Ü)
‚îú‚îÄ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã: ‚àû
‚îú‚îÄ –ì–æ—Å—Ç–∏: ‚àû
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: ‚úì –ü–æ–ª–Ω–∞—è
‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è: —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ

CUSTOM (–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è):
‚îú‚îÄ –¶–µ–Ω–∞: –∫–∞—Å—Ç–æ–º–Ω–∞—è
‚îú‚îÄ –†–µ—Å—Ç–æ—Ä–∞–Ω—ã: –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é
‚îú‚îÄ –ì–æ—Å—Ç–∏: –ø–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: ‚úì –ü–æ–ª–Ω–∞—è
‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç—Å—è: —á–µ—Ä–µ–∑ Admin panel Owner

–ú–û–î–ï–õ–¨ –ü–û–î–ü–ò–°–ö–ò:
‚îú‚îÄ –ú–µ—Å—è—á–Ω–∞—è: –ø–æ–ª–Ω–∞—è —Ü–µ–Ω–∞ –∑–∞ 1 –º–µ—Å—è—Ü
‚îú‚îÄ –ì–æ–¥–æ–≤–∞—è: -20% (—Ü–µ–Ω–∞ √ó 0.8 √ó 12 –º–µ—Å—è—Ü–µ–≤)
‚îú‚îÄ –ü–µ—Ä–∏–æ–¥ –±–∏–ª–ª–∏–Ω–≥–∞: –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü (–∏–ª–∏ –≥–æ–¥)
‚îú‚îÄ –û—Ç–º–µ–Ω–∞: –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç (–Ω–æ –ø–ª–∞—Ç—ë–∂ –∑–∞ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è)
‚îî‚îÄ –ü—Ä–æ–¥–ª–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ –æ—Ç–º–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏

–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ü–û –¢–ê–†–ò–§–£:
‚îú‚îÄ TenantLimits (—Ç–∞–±–ª–∏—Ü–∞ —Å —Ç–µ–∫—É—â–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏)
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏:
‚îÇ  ‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (max_restaurants)
‚îÇ  ‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –≥–æ—Å—Ç—è (max_guests)
‚îÇ  ‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–ø–æ–ª–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—Å–µ—Ö)
‚îî‚îÄ –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É "–õ–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω, –æ–±–Ω–æ–≤–∏—Ç–µ —Ç–∞—Ä–∏—Ñ"
```


***

## üìä –ê–ù–ê–õ–ò–¢–ò–ö–ê –ò –û–¢–ß–ï–¢–´

```
–î–õ–Ø OWNER:
‚îú‚îÄ –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚îÇ  ‚îú‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
‚îÇ  ‚îú‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
‚îÇ  ‚îú‚îÄ –î–æ—Ö–æ–¥ –ø–æ –º–µ—Å—è—Ü–∞–º (MRR)
‚îÇ  ‚îú‚îÄ –ß—ë—Ä–Ω (—Ç–µ–∫—É—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏)
‚îÇ  ‚îú‚îÄ –°—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –≥–æ—Å—Ç–µ–π –Ω–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω
‚îÇ  ‚îî‚îÄ –°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≥–æ—Å—Ç–µ–π
‚îÇ
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º:
‚îÇ  ‚îú‚îÄ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
‚îÇ  ‚îú‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ: —Å—Ç–∞—Ç—É—Å, —Ç–∞—Ä–∏—Ñ, —á–∏—Å–ª–æ –≥–æ—Å—Ç–µ–π, –¥–æ—Ö–æ–¥, –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
‚îÇ  ‚îî‚îÄ –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
‚îÇ
‚îî‚îÄ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
   ‚îú‚îÄ –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ (—É—Å–ø–µ—à–Ω—ã–µ, –Ω–µ—É–¥–∞—á–Ω—ã–µ, –æ–∂–∏–¥–∞—é—â–∏–µ)
   ‚îú‚îÄ –í–æ–∑–≤—Ä–∞—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π (chargeback, refund)
   ‚îî‚îÄ –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ 3 –º–µ—Å—è—Ü–∞

–î–õ–Ø RESTAURANT_ADMIN (—Å–µ—Ç—å):
‚îú‚îÄ –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Å–µ—Ç–∏:
‚îÇ  ‚îú‚îÄ –°—É–º–º–∞ –≤—Å–µ—Ö —á–µ–∫–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
‚îÇ  ‚îú‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â–µ–Ω–∏–π
‚îÇ  ‚îú‚îÄ –ê–∫—Ç–∏–≤–Ω—ã–µ –≥–æ—Å—Ç–∏ (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü)
‚îÇ  ‚îú‚îÄ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
‚îÇ  ‚îú‚îÄ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤ —É –≥–æ—Å—Ç–µ–π
‚îÇ  ‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (%)
‚îÇ
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É:
‚îÇ  ‚îú‚îÄ –í—ã—Ä—É—á–∫–∞ –æ—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (—Å–∫–æ–ª—å–∫–æ –¥–∞–ª–∏ –≤ –≤–∏–¥–µ —Å–∫–∏–¥–æ–∫/–±–∞–ª–ª–æ–≤)
‚îÇ  ‚îú‚îÄ ROI –æ—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚îÇ  ‚îî‚îÄ –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –≥–æ—Å—Ç—è–º
‚îÇ
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ—Å—Ç–µ–π:
‚îÇ  ‚îú‚îÄ –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è (–≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª - –µ—Å–ª–∏ –µ—Å—Ç—å)
‚îÇ  ‚îú‚îÄ –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π
‚îÇ  ‚îú‚îÄ –°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ —á–µ–∫–∞
‚îÇ  ‚îú‚îÄ –£—Ä–æ–≤–µ–Ω—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–±–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –±–∞–ª–ª–∞—Ö)
‚îÇ  ‚îú‚îÄ Segmentation (–Ω–æ–≤—ã–µ, –∞–∫—Ç–∏–≤–Ω—ã–µ, —Å–ø—è—â–∏–µ, —É—à–µ–¥—à–∏–µ)
‚îÇ  ‚îî‚îÄ Lifetime Value (LTV)
‚îÇ
‚îî‚îÄ –û—Ç—á—ë—Ç—ã:
   ‚îú‚îÄ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç (—Ç–æ–ø –≥–æ—Å—Ç–µ–π, –Ω–æ–≤—ã–µ –≥–æ—Å—Ç–∏)
   ‚îú‚îÄ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç (–≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏)
   ‚îî‚îÄ –ö–∞—Å—Ç–æ–º–Ω—ã–π –æ—Ç—á—ë—Ç (–≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–∏–æ–¥ –∏ –º–µ—Ç—Ä–∏–∫–∏)

–î–õ–Ø MANAGER (–æ–¥–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞):
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞:
‚îÇ  ‚îú‚îÄ –°—É–º–º–∞ –≤—Å–µ—Ö —á–µ–∫–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
‚îÇ  ‚îú‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â–µ–Ω–∏–π
‚îÇ  ‚îú‚îÄ –ê–∫—Ç–∏–≤–Ω—ã–µ –≥–æ—Å—Ç–∏
‚îÇ  ‚îú‚îÄ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
‚îÇ  ‚îî‚îÄ –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤
‚îÇ
‚îú‚îÄ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ—Å—Ç–µ–π (—Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞):
‚îÇ  ‚îú‚îÄ –î–µ–º–æ–≥—Ä–∞—Ñ–∏—è
‚îÇ  ‚îú‚îÄ –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π
‚îÇ  ‚îî‚îÄ Segmentation
‚îÇ
‚îî‚îÄ –û—Ç—á—ë—Ç—ã (—Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞):
   ‚îú‚îÄ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã
   ‚îî‚îÄ –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –æ—Ç—á—ë—Ç—ã

–î–õ–Ø CASHIER:
‚îú‚îÄ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ù–ï –≤–∏–¥–∏—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É
‚îî‚îÄ –ï—Å–ª–∏ Admin –¥–∞–ª –¥–æ—Å—Ç—É–ø: –≤–∏–¥–∏—Ç —Ç–æ –∂–µ —á—Ç–æ Manager

–î–õ–Ø GUEST:
‚îú‚îÄ –ú–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –≤ Telegram mini app:
‚îÇ  ‚îú‚îÄ –°–≤–æ–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤
‚îÇ  ‚îú‚îÄ –ò—Å—Ç–æ—Ä–∏—é –±–∞–ª–ª–æ–≤ (–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è)
‚îÇ  ‚îú‚îÄ –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π (–¥–∞—Ç–∞, —Å—É–º–º–∞, —á—Ç–æ –∑–∞–∫–∞–∑–∞–ª)
‚îÇ  ‚îî‚îÄ –°–≤–æ–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îî‚îÄ –ù–∏–∫–∞–∫–∏—Ö –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫
```


***

## üîç –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –ê–£–î–ò–¢ (ACTIVITY LOG)

```
–õ–û–ì–ò–†–£–Æ–¢–°–Ø:

‚úì –û–ü–ï–†–ê–¶–ò–ò –° –ë–ê–õ–õ–ê–ú–ò:
‚îú‚îÄ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—á–µ—Ä–µ–∑ –ü–û–°, –≤—Ä—É—á–Ω—É—é, –ø—Ä–æ–º–æ-–∞–∫—Ü–∏—è)
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, amount, reason, created_by, timestamp
‚îú‚îÄ –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—á–µ—Ä–µ–∑ –ü–û–°, –≤—Ä—É—á–Ω—É—é)
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, amount, reason, created_by, timestamp
‚îî‚îÄ –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–∞–º–∏
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, old_balance, new_balance, reason, created_by, timestamp

‚úì –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ü–†–ê–í –ò –†–û–õ–ï–ô:
‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, role, permissions, created_by, timestamp
‚îú‚îÄ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤ (GRANT permission)
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, permission, action=GRANT, changed_by, timestamp
‚îú‚îÄ –û—Ç–º–µ–Ω–∞ –ø—Ä–∞–≤ (REVOKE permission)
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, permission, action=REVOKE, changed_by, timestamp
‚îî‚îÄ –°–º–µ–Ω–∞ —Ä–æ–ª–∏
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, old_role, new_role, changed_by, timestamp

‚úì –í–•–û–î OWNER –í ACCOUNT:
‚îú‚îÄ Owner –∑–∞—Ö–æ–¥–∏—Ç –≤ RestaurantAdmin account
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: owner_id, restaurant_id, timestamp, ip_address, user_agent
‚îú‚îÄ Owner –∑–∞—Ö–æ–¥–∏—Ç –≤ Manager account
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: owner_id, manager_id, timestamp, ip_address, user_agent
‚îî‚îÄ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è Owner ‚Üí Admin/Manager
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: owner_id, target_user_id, timestamp

‚úì –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –°–ò–°–¢–ï–ú–ï –õ–û–Ø–õ–¨–ù–û–°–¢–ò:
‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, level_id, action, old_value, new_value, timestamp
‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, rule_id, action, old_value, new_value, timestamp
‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, promo_id, action, details, timestamp
‚îî‚îÄ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞ –∫–∞—Ä—Ç—ã
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, card_id, action=DESIGN_CHANGED, timestamp

‚úì –°–û–ó–î–ê–ù–ò–ï/–£–î–ê–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô:
‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: created_by (RestaurantAdmin), manager_id, restaurant_id, timestamp
‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Å–∏—Ä–∞
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: created_by (Manager/Admin), cashier_id, restaurant_id, timestamp
‚îú‚îÄ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: deleted_by, user_id, deletion_reason, timestamp
‚îî‚îÄ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: blocked_by, user_id, reason, timestamp

‚úì –ò–ó–ú–ï–ù–ï–ù–ò–ï –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•:
‚îú‚îÄ –ì–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (–Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ 3 –º–µ—Å—è—Ü–∞)
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, old_data, new_data, timestamp
‚îú‚îÄ Admin —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç—è
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: edited_by (Admin/Manager), guest_id, old_data, new_data, timestamp
‚îî‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –¥–µ—Ç–µ–π –∫ –∫–∞—Ä—Ç–µ –≥–æ—Å—Ç—è
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: user_id, child_id, action, timestamp

‚úì –û–ü–ï–†–ê–¶–ò–ò –° –ü–û–î–ü–ò–°–ö–ê–ú–ò:
‚îú‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: restaurant_id, tariff, subscription_start, subscription_end, timestamp
‚îú‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ (—Å–º–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞)
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: restaurant_id, old_tariff, new_tariff, timestamp
‚îú‚îÄ –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: restaurant_id, cancelled_by, reason, timestamp
‚îî‚îÄ –ü–ª–∞—Ç—ë–∂
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: subscription_id, amount, payment_status, timestamp

‚úì –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –° –ü–û–°:
‚îú‚îÄ Webhook –æ—Ç –ü–û–° –ø–æ–ª—É—á–µ–Ω
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: restaurant_id, event_type, status=SUCCESS/FAILED, timestamp
‚îú‚îÄ –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îÇ  ‚îî‚îÄ –ó–∞–ø–∏—Å—å: restaurant_id, error_message, timestamp
‚îî‚îÄ Pull —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å)
   ‚îî‚îÄ –ó–∞–ø–∏—Å—å: restaurant_id, sync_start, sync_end, records_synced, timestamp

–¢–ê–ë–õ–ò–¶–ê:
‚îú‚îÄ ActivityLog
‚îÇ  ‚îú‚îÄ id (UUID)
‚îÇ  ‚îú‚îÄ tenant_id (–¥–ª—è multi-tenant)
‚îÇ  ‚îú‚îÄ user_id (–∫—Ç–æ —Å–¥–µ–ª–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ)
‚îÇ  ‚îú‚îÄ action_type (enum: GRANT_PERMISSION, REVOKE_PERMISSION, CREATE_BALL, –∏ —Ç.–¥.)
‚îÇ  ‚îú‚îÄ entity_type (USER, GUEST, PERMISSION, LOYALTY_SYSTEM, SUBSCRIPTION, –∏ —Ç.–¥.)
‚îÇ  ‚îú‚îÄ entity_id (ID —Å—É—â–Ω–æ—Å—Ç–∏ –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞)
‚îÇ  ‚îú‚îÄ old_value (JSON, —á—Ç–æ –±—ã–ª–æ)
‚îÇ  ‚îú‚îÄ new_value (JSON, —á—Ç–æ —Å—Ç–∞–ª–æ)
‚îÇ  ‚îú‚îÄ reason (—Ç–µ–∫—Å—Ç, –ø–æ—á–µ–º—É)
‚îÇ  ‚îú‚îÄ ip_address
‚îÇ  ‚îú‚îÄ user_agent
‚îÇ  ‚îú‚îÄ created_at
‚îÇ  ‚îî‚îÄ indexes: (tenant_id, action_type), (entity_type, entity_id), (created_at)
```


***

## üóÑÔ∏è –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ë–î (30+ —Ç–∞–±–ª–∏—Ü)

```
USERS & AUTHENTICATION:
‚îú‚îÄ User (–æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
‚îú‚îÄ UserRole (–ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ —Ç–µ–Ω–∞–Ω—Ç—É + —Ä–æ–ª—å)
‚îú‚îÄ UserPermission (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞)
‚îú‚îÄ UserSession (–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏)
‚îú‚îÄ PasswordResetToken (—Ç–æ–∫–µ–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è)
‚îú‚îÄ EmailVerification (—Ç–æ–∫–µ–Ω—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email)
‚îú‚îÄ UserActivityLog (–≤–µ—Å—å –∞—É–¥–∏—Ç)
‚îî‚îÄ UserLoginAttempt (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –¥–ª—è rate limiting)

TENANTS & RESTAURANTS:
‚îú‚îÄ Tenant (–æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫–∫–∞—É–Ω—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏)
‚îú‚îÄ TenantLimits (–ª–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ—É)
‚îú‚îÄ Restaurant (–æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –≤ —Å–µ—Ç–∏)
‚îú‚îÄ RestaurantAdmin (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è RESTAURANT_ADMIN)
‚îî‚îÄ RestaurantManager (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è MANAGER)

SUBSCRIPTIONS & BILLING:
‚îú‚îÄ SubscriptionPlan (–¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã: Standard, Medium, Pro, Ultimate)
‚îú‚îÄ Subscription (—Ç–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)
‚îú‚îÄ SubscriptionHistory (–∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫)
‚îú‚îÄ BillingInfo (–ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
‚îú‚îÄ Payment (–≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏)
‚îú‚îÄ Invoice (—Å—á–µ—Ç–∞)
‚îî‚îÄ OwnerRegistrationLink (—Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)

GUESTS & LOYALTY CARDS:
‚îú‚îÄ User (—Å role = GUEST)
‚îú‚îÄ GuestProfile (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç—è)
‚îú‚îÄ GuestCard (–∫–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
‚îú‚îÄ GuestChild (–¥–µ—Ç–∏ –≥–æ—Å—Ç—è –¥–ª—è –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π)
‚îî‚îÄ GuestVisit (–∏—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π)

LOYALTY SYSTEM:
‚îú‚îÄ LoyaltySystem (–∫–æ–Ω—Ñ–∏–≥ —Å–∏—Å—Ç–µ–º—ã: —Å–∫–∏–¥–æ—á–Ω–∞—è –∏–ª–∏ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è)
‚îú‚îÄ LoyaltyLevel (—É—Ä–æ–≤–Ω–∏: –ë—Ä–æ–Ω–∑–∞, –°–µ—Ä–µ–±—Ä–æ, –ó–æ–ª–æ—Ç–æ)
‚îú‚îÄ LoyaltyRule (–ø—Ä–∞–≤–∏–ª–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –≥–æ—Å—Ç–µ–π)
‚îú‚îÄ LoyaltyPromo (–ø—Ä–æ–º–æ-–∞–∫—Ü–∏–∏)
‚îú‚îÄ BallTransaction (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏)
‚îî‚îÄ PromoBallGranted (–∫–∞–∫–∏–µ –≥–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏–ª–∏ –∫–∞–∫—É—é –ø—Ä–æ–º–æ-–∞–∫—Ü–∏—é)

POS INTEGRATION:
‚îú‚îÄ POSIntegration (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
‚îú‚îÄ POSSync (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π)
‚îî‚îÄ POSTransaction (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑ –ü–û–°)

TELEGRAM:
‚îú‚îÄ TelegramBot (–∫–æ–Ω—Ñ–∏–≥ –±–æ—Ç–∞)
‚îú‚îÄ TelegramUser (–ø—Ä–∏–≤—è–∑–∫–∞ telegram_id ‚Üí User)
‚îú‚îÄ TelegramSession (—Å–µ—Å—Å–∏–∏ –≤ Telegram)
‚îî‚îÄ TelegramMiniApp (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è mini app)

ANALYTICS (–º–æ–∂–µ—Ç –±—ã—Ç—å Redis –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã):
‚îú‚îÄ DailyAnalytics (—Å–≤–æ–¥–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º)
‚îú‚îÄ MonthlyAnalytics (—Å–≤–æ–¥–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º)
‚îî‚îÄ GuestAnalytics (–ø—Ä–æ—Ñ–∏–ª—å –∫–∞–∂–¥–æ–≥–æ –≥–æ—Å—Ç—è)
```


***

## üìÅ –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
max-loyalty/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ backend/ (NestJS)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/ (JWT, Login, Register, Reset Password)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/ (User management)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ roles/ (RBAC)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permissions/ (Dynamic permissions)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tenants/ (Multi-tenant logic)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ restaurants/ (Restaurant management)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guests/ (Guest profiles)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loyalty/ (Loyalty system)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ balls/ (Points/Balls operations)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscriptions/ (Billing)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics/ (Reports)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pos-integration/ (iiko + R-Keeper)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram/ (Bot + Mini App)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ activity-log/ (Audit trail)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ decorators/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filters/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pipes/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ frontend/ (React + Vite)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Owner/ (Owner dashboard)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RestaurantAdmin/ (Admin panel)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Manager/ (Manager dashboard)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cashier/ (POS interface)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Guest/ (Loyalty card)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Auth/ (Login, Register)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ styles/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ telegram-bot/ (Telegram Bot + Mini App)
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ mini-app/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ scenes/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ main.ts
‚îÇ       ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ       ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ shared/ (Shared types, utils)
‚îÇ   ‚îî‚îÄ‚îÄ database/ (Prisma migrations)
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```


***

## üîÑ –û–°–ù–û–í–ù–´–ï –ë–ò–ó–ù–ï–°-–ü–†–û–¶–ï–°–°–´

### **–ü–†–û–¶–ï–°–° 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É**

```
1. –ù–æ–≤—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç
2. –í—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ (Standard, Medium, Pro –∏ —Ç.–¥.)
3. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É: –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω
4. –í–≤–æ–¥–∏—Ç –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
5. –ü–ª–∞—Ç—ë–∂ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (Stripe, YooKassa –∏ —Ç.–¥.)
6. –°–æ–∑–¥–∞–µ—Ç—Å—è Tenant, Subscription, User (RestaurantAdmin)
7. Admin –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
8. Admin —Å–æ–∑–¥–∞–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∞—Ä–∏—Ñ–∞)
9. Admin —Å–æ–∑–¥–∞–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –∫–∞—Å—Å–∏—Ä–æ–≤
10. Admin –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

–¢–∞–±–ª–∏—Ü—ã:
‚îú‚îÄ Tenant
‚îú‚îÄ Subscription
‚îú‚îÄ User
‚îú‚îÄ UserRole
‚îú‚îÄ Restaurant
‚îî‚îÄ ActivityLog (–≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è)
```


### **–ü–†–û–¶–ï–°–° 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Å—Ç—è**

```
–°–ø–æ—Å–æ–± 1 (–ß–µ—Ä–µ–∑ –∫–∞—Å—Å–∏—Ä–∞):
1. –ì–æ—Å—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω
2. –ö–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç User + GuestProfile + GuestCard
4. –ü–û–° —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è (PUSH –æ—Ç –ü–û–°)
5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è QR-–∫–æ–¥ –∏ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
6. –ì–æ—Å—Ç—å –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç—É –≤ Telegram –ø–æ–∑–∂–µ

–°–ø–æ—Å–æ–± 2 (–ü–æ —Å—Å—ã–ª–∫–µ):
1. –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ
2. –í–≤–æ–¥–∏—Ç: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. –°–æ–∑–¥–∞–µ—Ç—Å—è User + GuestProfile + GuestCard
4. –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. –ü–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç—É

–°–ø–æ—Å–æ–± 3 (–ß–µ—Ä–µ–∑ Telegram):
1. –ì–æ—Å—Ç—å –ø–∏—à–µ—Ç /start –≤ –±–æ—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
2. –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Telegram ID –∏–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
3. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è mini app —Å –∫–∞—Ä—Ç–æ–π
4. –ú–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–µ–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

–¢–∞–±–ª–∏—Ü—ã:
‚îú‚îÄ User (role = GUEST)
‚îú‚îÄ GuestProfile
‚îú‚îÄ GuestCard
‚îú‚îÄ GuestChild (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ TelegramUser (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ Telegram)
‚îî‚îÄ RegistrationLink (–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
```


### **–ü–†–û–¶–ï–°–° 3: –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏**

```
–í–∞—Ä–∏–∞–Ω—Ç 1: –°–∫–∏–¥–æ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
1. –ì–æ—Å—Ç—å –ø–æ–∫—É–ø–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2000—Ä)
2. –ï–≥–æ —É—Ä–æ–≤–µ–Ω—å –°–µ—Ä–µ–±—Ä–æ = 10% —Å–∫–∏–¥–∫–∞
3. –ï–º—É –¥–∞—é—Ç —Å–∫–∏–¥–∫—É 200—Ä –Ω–∞ —ç—Ç–æ—Ç —á–µ–∫
4. –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ BallTransaction + ActivityLog

–í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
1. –ì–æ—Å—Ç—å –ø–æ–∫—É–ø–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2000—Ä)
2. –ï–≥–æ —É—Ä–æ–≤–µ–Ω—å –°–µ—Ä–µ–±—Ä–æ = 10% –±–∞–ª–ª–∞–º–∏ = 200 –±–∞–ª–ª–æ–≤
3. 200 –±–∞–ª–ª–æ–≤ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ –µ–≥–æ —Å—á–µ—Ç
4. GuestCard.balance += 200
5. –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ BallTransaction + ActivityLog

–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (Manager/Admin):
1. Manager –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É –≥–æ—Å—Ç—è
2. –í—Ä—É—á–Ω—É—é –Ω–∞—á–∏—Å–ª—è–µ—Ç/—Å–ø–∏—Å—ã–≤–∞–µ—Ç –±–∞–ª–ª—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞ –æ—Ç–∑—ã–≤: +100 –±–∞–ª–ª–æ–≤)
3. –í–≤–æ–¥–∏—Ç –ø—Ä–∏—á–∏–Ω—É (optional)
4. –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç GuestCard.balance
5. –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ BallTransaction + ActivityLog (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º who –∏ why)

–¢–∞–±–ª–∏—Ü—ã:
‚îú‚îÄ GuestCard (—Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å)
‚îú‚îÄ BallTransaction (–∏—Å—Ç–æ—Ä–∏—è)
‚îú‚îÄ POSTransaction (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ –ü–û–°)
‚îî‚îÄ ActivityLog (–∫—Ç–æ –∏ –∫–æ–≥–¥–∞)
```


### **–ü–†–û–¶–ï–°–° 4: –ü—Ä–æ–º–æ-–∞–∫—Ü–∏–∏**

```
1. Admin —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–º–æ-–∞–∫—Ü–∏—é: "–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è = +1000 –±–∞–ª–ª–æ–≤"
2. –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å):
   ‚îú‚îÄ –ö–∞–∫–∏–µ –≥–æ—Å—Ç–∏ —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è?
   ‚îî‚îÄ –û–Ω–∏ —É–∂–µ –ø–æ–ª—É—á–∏–ª–∏ —ç—Ç—É –ø—Ä–æ–º–æ –≤ —ç—Ç–æ–º –≥–æ–¥—É?
3. –ï—Å–ª–∏ –Ω–µ—Ç, –Ω–∞—á–∏—Å–ª—è–µ–º –±–∞–ª–ª—ã:
   ‚îú‚îÄ GuestCard.balance += 1000
   ‚îú‚îÄ BallTransaction —Å–æ–∑–¥–∞–µ—Ç—Å—è (reason = "Birthday Promo")
   ‚îú‚îÄ –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram: "–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –≤–∞–º +1000 –±–∞–ª–ª–æ–≤!"
   ‚îî‚îÄ –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
4. –î—Ä—É–≥–æ–π –ø—Ä–∏–º–µ—Ä: "–ù–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 30+ –¥–Ω–µ–π = +500 –±–∞–ª–ª–æ–≤"
   ‚îú‚îÄ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –∫–æ–≥–¥–∞ –±—ã–ª–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ?
   ‚îú‚îÄ –ï—Å–ª–∏ >30 –¥–Ω–µ–π, –Ω–∞—á–∏—Å–ª—è–µ–º 500 –±–∞–ª–ª–æ–≤
   ‚îî‚îÄ –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

–¢–∞–±–ª–∏—Ü—ã:
‚îú‚îÄ LoyaltyPromo (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–º–æ)
‚îú‚îÄ PromoBallGranted (–∫–∞–∫–∏–µ –≥–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏–ª–∏ –∫–∞–∫—É—é –ø—Ä–æ–º–æ)
‚îú‚îÄ BallTransaction (–∏—Å—Ç–æ—Ä–∏—è)
‚îî‚îÄ GuestVisit (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
```


### **–ü–†–û–¶–ï–°–° 5: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ü–û–° (iiko + R-Keeper)**

```
PUSH (–û—Ç –ü–û–° ‚Üí –ö –Ω–∞–º):
1. –ö–∞—Å—Å–∏—Ä –ø—Ä–æ–≤–æ–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –ü–û–°
2. –ü–û–° —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook:
   POST /webhooks/pos/transaction
   {
     "restaurant_id": "123",
     "guest_phone": "+71234567890",
     "check_amount": 2000,
     "timestamp": "2024-01-29T12:00:00Z"
   }
3. –ú—ã –ø–æ–ª—É—á–∞–µ–º webhook:
   ‚îú‚îÄ –ò—â–µ–º –≥–æ—Å—Ç—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
   ‚îú‚îÄ –ù–∞—Ö–æ–¥–∏–º –µ–≥–æ —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
   ‚îú‚îÄ –í—ã—á–∏—Å–ª—è–µ–º –±–∞–ª–ª—ã/—Å–∫–∏–¥–∫—É (–µ—Å–ª–∏ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è/—Å–∫–∏–¥–æ—á–Ω–∞—è)
   ‚îú‚îÄ –û–±–Ω–æ–≤–ª—è–µ–º GuestCard.balance
   ‚îú‚îÄ –°–æ–∑–¥–∞–µ–º BallTransaction
   ‚îú‚îÄ –°–æ–∑–¥–∞–µ–º POSTransaction (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ü–û–°-—Å–∏—Å—Ç–µ–º–µ –æ—Ç–≤–µ—Ç (success/fail)

PULL (–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å):
1. –ö–∞–∂–¥—ã–π —á–∞—Å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É –ü–û–°:
   GET /iiko/api/guests?since=last_sync_time
2. –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥–æ—Å—Ç–µ–π –∏ –æ–ø–µ—Ä–∞—Ü–∏–π
3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å –Ω–∞—à–µ–π –ë–î:
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ–º: –µ—Å—Ç—å –ª–∏ —É–∂–µ –≤ –Ω–∞—à–µ–π –ë–î?
   ‚îú‚îÄ –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º
   ‚îú‚îÄ –ï—Å–ª–∏ –µ—Å—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ–º
   ‚îî‚îÄ –õ–æ–≥–∏—Ä—É–µ–º –≤—Å–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è
4. –≠—Ç–æ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ webhook –Ω–µ –¥–æ—à–µ–ª

–¢–∞–±–ª–∏—Ü—ã:
‚îú‚îÄ POSIntegration (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
‚îú‚îÄ POSTransaction (–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
‚îú‚îÄ POSSync (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π)
‚îú‚îÄ BallTransaction (–Ω–∞—à–µ –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ)
‚îî‚îÄ ActivityLog (–≤—Å–µ –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã)
```


***

## üéØ –ò–¢–û–ì–û–í–ê–Ø –ú–ê–¢–†–ò–¶–ê –†–û–õ–ï–ô –ò –ü–†–ê–í

```
                          Owner   Admin   Manager  Cashier  Guest
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
create:guest              ‚úì       ‚úì       ‚úì        ‚úì        ‚úó
read:guest (all)          ‚úì       ‚úì       own_rest own_rest ‚úó
read:guest (basic)        ‚úì       ‚úì       ‚úì        ‚úì        self
read:guest:analytics      ‚úì       ‚úì       own_rest ‚úó*       ‚úó
create:restaurant         ‚úì       ‚úì       ‚úó        ‚úó        ‚úó
create:manager            ‚úó       ‚úì       ‚úó*       ‚úó        ‚úó
create:cashier            ‚úó       ‚úì       ‚úì        ‚úó        ‚úó
create:admin              ‚úì       ‚úì*      ‚úó        ‚úó        ‚úó
manage:balls_manual       ‚úì       ‚úì       ‚úì*       ‚úó*       ‚úó
manage:balls_pos          ‚úì       ‚úì       ‚úì        ‚úì        ‚úó
read:analytics            ‚úì       all     own_rest ‚úó*       ‚úó
manage:loyalty_system     ‚úì       ‚úì       ‚úó        ‚úó        ‚úó
manage:loyalty_design     ‚úì       ‚úì       ‚úó        ‚úó        ‚úó
manage:loyalty_promo      ‚úì       ‚úì       ‚úó        ‚úó        ‚úó
manage:restaurants        ‚úì       ‚úì       ‚úó        ‚úó        ‚úó
manage:users              ‚úì       ‚úì       ‚úó        ‚úó        ‚úó
manage:permissions        ‚úì       ‚úì       ‚úó        ‚úó        ‚úó
impersonate               ‚úì       ‚úó       ‚úó        ‚úó        ‚úó
view:card                 ‚úó       ‚úó       ‚úó        ‚úó        own
edit:profile              ‚úì       ‚úì       ‚úì        ‚úì        own (—Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞)
edit:children             ‚úó       ‚úó       ‚úó        ‚úó        own

* = –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–æ
own_rest = —Ç–æ–ª—å–∫–æ —Å–≤–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω (–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–æ –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö)
own = —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
self = —Ç–æ–ª—å–∫–æ —Å–µ–±—è
‚úó = –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚úì = —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```


***

## üé¨ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò

### **–ß–¢–û –£–ñ–ï –ì–û–¢–û–í–û:**

‚úÖ AUTH FLOW (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è, session management)
‚úÖ RBAC –°–ò–°–¢–ï–ú–ê (—Ä–æ–ª–∏, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞, guards, decorators)
‚úÖ –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

### **–ß–¢–û –ù–£–ñ–ù–û –î–ï–¢–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨:**

1. **Guests \& Loyalty Cards** (–¥–µ—Ç–∞–ª—å–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≥–æ—Å—Ç–µ–π)
2. **Balls \& Transactions** (–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏, –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è)
3. **Accounts \& Subscriptions** (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏, —Ç–∞—Ä–∏—Ñ—ã, –±–∏–ª–ª–∏–Ω–≥)
4. **POS Integration** (–¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å iiko –∏ R-Keeper)
5. **Telegram Bot** (–±–æ—Ç, –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞)
6. **Analytics** (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ç—á–µ—Ç—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
7. **Database Schema** (–ø–æ–ª–Ω–∞—è Prisma —Å—Ö–µ–º–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏)
8. **API Specification** (OpenAPI/Swagger –¥–ª—è –≤—Å–µ—Ö endpoints)

***

## üìù –í–´–í–û–î

–ú—ã –≤—ã—Å—Ç—Ä–æ–∏–ª–∏ **–ø–æ–ª–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏** —Å:

‚úÖ **6 —Ä–æ–ª–µ–π** (Owner ‚Üí Admin ‚Üí Manager ‚Üí Cashier ‚Üí Guest)
‚úÖ **6 —Ç–∞—Ä–∏—Ñ–æ–≤** (Free ‚Üí Custom —Å –≥–∏–±–∫–æ–π —Å–∫–∏–¥–∫–æ–π)
‚úÖ **2 —Ç–∏–ø–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏** (–°–∫–∏–¥–æ—á–Ω–∞—è + –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è)
‚úÖ **3 —Å–ø–æ—Å–æ–±–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** –≥–æ—Å—Ç–µ–π (–ö–∞—Å—Å–∞, –°—Å—ã–ª–∫–∞, Telegram)
‚úÖ **–ú–Ω–æ–≥–æ—Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–µ —Å–µ—Ç–∏** (1-5+ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –Ω–∞ —Å–µ—Ç–∏)
‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∞** (–∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
‚úÖ **–ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç** (–≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è)
‚úÖ **–ü–û–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** (iiko + R-Keeper)
‚úÖ **Telegram –±–æ—Ç + mini app**

–¢–µ–ø–µ—Ä—å –≥–æ—Ç–æ–≤ –∫ –Ω–∞—Å–ª–∞–∏–≤–∞–Ω–∏—é –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —ç—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É! üöÄ

–ö–∞–∫–æ–π –±–ª–æ–∫ –Ω–∞—á–Ω–µ–º –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–º?

---

# üìã –î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø GUESTS \& LOYALTY CARDS

–Ø —Å–æ–∑–¥–∞–º **–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –±–ª–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤** –ø–æ –≥–æ—Å—Ç—è–º –∏ –∫–∞—Ä—Ç–∞–º –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏. –í–æ—Ç 20+ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:

***

## üßë‚Äçü§ù‚Äçüßë –ë–õ–û–ö 1: –°–¢–†–£–ö–¢–£–†–ê –ì–û–°–¢–Ø –ò –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï

### –í–æ–ø—Ä–æ—Å—ã –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –≥–æ—Å—Ç—è:

**1Ô∏è‚É£ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–û–õ–Ø –ü–†–ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò:**

```
–°–µ–π—á–∞—Å —É –Ω–∞—Å –µ—Å—Ç—å:
- –ò–º—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í–æ–ø—Ä–æ—Å: –ö–∞–∫–∏–µ –µ—â—ë –ø–æ–ª—è –Ω—É–∂–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏?
- Email? (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π)
- –ü–æ–ª? (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
- –ê–¥—Ä–µ—Å? (–≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º)
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏? (–¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- –°–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏?
- –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π?
- –Ø–∑—ã–∫–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ? (—Ä—É—Å—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ç.–¥.)

–ò–ª–∏ —Ç–æ–ª—å–∫–æ: –∏–º—è + —Ç–µ–ª–µ—Ñ–æ–Ω + –î–†?
```

**2Ô∏è‚É£ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–§–ò–õ–Ø:**

```
–°–µ–π—á–∞—Å: –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ 3 –º–µ—Å—è—Ü–∞.

–í–æ–ø—Ä–æ—Å A: –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ 3 –º–µ—Å—è—Ü–∞?
- –≠—Ç–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞?
- –ò–ª–∏ –¥—Ä—É–≥–∞—è –ø—Ä–∏—á–∏–Ω–∞?

–í–æ–ø—Ä–æ—Å B: –ö–∞–∫–∏–µ –ø–æ–ª—è –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å?
- –ò–º—è? (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)
- –î–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è? (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)
- Email? (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Å –ø–µ—Ä–µ–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)
- –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞? (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å? —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä!)
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ? (–∞–¥—Ä–µ—Å, –ø–æ–ª, –∏ —Ç.–¥.)

–í–æ–ø—Ä–æ—Å C: –ö–∞–∫–∏–µ –ø–æ–ª—è –ù–ï–õ–¨–ó–Ø –º–µ–Ω—è—Ç—å?
- –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)?
- –ò–ª–∏ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å?
```

**3Ô∏è‚É£ –ù–û–ú–ï–† –¢–ï–õ–ï–§–û–ù–ê –ö–ê–ö –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†:**

```
–°–µ–π—á–∞—Å: –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –ü–û–°.

–í–æ–ø—Ä–æ—Å A: –ï—Å–ª–∏ –≥–æ—Å—Ç—å –º–µ–Ω—è–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
- –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å?
- –ù—É–∂–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ä–æ–≥–æ –Ω–æ–º–µ—Ä–∞?
- –ù—É–∂–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞?
- –ë–∞–ª–ª—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä?
- –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è?

–í–æ–ø—Ä–æ—Å B: –ß—Ç–æ –µ—Å–ª–∏ –≥–æ—Å—Ç—å –∑–∞–±—ã–ª –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞?
- –ú–æ–∂–µ—Ç –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ email?
- –ú–æ–∂–µ—Ç –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ Telegram ID?
- –ò–ª–∏ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É?

–í–æ–ø—Ä–æ—Å C: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤:
- –ß—Ç–æ –µ—Å–ª–∏ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —á–µ–ª–æ–≤–µ–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å –æ–¥–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º?
- –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å?
- –ò–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ?
```

**4Ô∏è‚É£ –î–ï–¢–ò –ì–û–°–¢–Ø (–î–ï–¢–ê–õ–ò):**

```
–°–µ–π—á–∞—Å: –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–µ–π –¥–ª—è –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è.

–í–æ–ø—Ä–æ—Å A: –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏—Ç—å –æ —Ä–µ–±–µ–Ω–∫–µ?
- –ò–º—è?
- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è?
- –ü–æ–ª?
- –í–æ–∑—Ä–∞—Å—Ç?
- –§–æ—Ç–æ?

–í–æ–ø—Ä–æ—Å B: –°–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å?
- –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ?
- –ú–∞–∫—Å–∏–º—É–º 5-10?

–í–æ–ø—Ä–æ—Å C: –ï—Å–ª–∏ —Ä–µ–±–µ–Ω–∫—É –∏—Å–ø–æ–ª–Ω–∏–ª–æ—Å—å 18 –ª–µ—Ç:
- –û–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –≥–æ—Å—Ç–µ–º?
- –ú–æ–∂–µ—Ç –ª–∏ –æ–Ω –æ—Ç–¥–µ–ª–∏—Ç—å—Å—è –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è?
- –ë–∞–ª–ª—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è?

–í–æ–ø—Ä–æ—Å D: –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è:
- –ú–æ–∂–Ω–æ –ª–∏ —É–¥–∞–ª–∏—Ç—å?
- –ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–∞–ª–∞—Å—å?
```


***

## üé´ –ë–õ–û–ö 2: –ö–ê–†–¢–ê –õ–û–Ø–õ–¨–ù–û–°–¢–ò (LOYALTY CARD)

### –í–æ–ø—Ä–æ—Å—ã –ø–æ –∫–∞—Ä—Ç–µ:

**5Ô∏è‚É£ QR-–ö–û–î –ò 6-–ó–ù–ê–ß–ù–´–ô –ö–û–î:**

```
–°–µ–π—á–∞—Å: –æ–±–∞ –∫–æ–¥–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

–í–æ–ø—Ä–æ—Å A: –ó–∞—á–µ–º –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (QR + 6-digit)?
- QR —É–¥–æ–±–Ω–µ–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- 6-digit —É–¥–æ–±–Ω–µ–µ –¥–ª—è –≤–≤–æ–¥–∞ –≤—Ä—É—á–Ω—É—é
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω–∏–º–∞—é?

–í–æ–ø—Ä–æ—Å B: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–æ–≤?
- –ï—Å–ª–∏ –∫–∞—Å—Å–∏—Ä —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR:
  ‚îî‚îÄ QR –∫–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É?
  ‚îî‚îÄ 6-digit –∫–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É?
  ‚îî‚îÄ –û–±–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è?
  ‚îî‚îÄ –ò–ª–∏ –Ω–æ–≤—ã–µ –∫–æ–¥—ã —Ç–æ–ª—å–∫–æ –≤ mini app?

–í–æ–ø—Ä–æ—Å C: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª QR –∫–æ–¥:
  ‚îî‚îÄ –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥?
  ‚îî‚îÄ –ò–ª–∏ —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è invalid?

–í–æ–ø—Ä–æ—Å D: –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–æ–¥–æ–≤:
- –ö–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏?
- –°–∫–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã—Ö –∫–æ–¥–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—å? (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 10, –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100?)
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ª–∏ –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–æ–≤?
```

**6Ô∏è‚É£ –£–†–û–í–ù–ò –õ–û–Ø–õ–¨–ù–û–°–¢–ò –ò –ü–ï–†–ï–•–û–î–´:**

```
–°–µ–π—á–∞—Å: –ë—Ä–æ–Ω–∑–∞ ‚Üí –°–µ—Ä–µ–±—Ä–æ ‚Üí –ó–æ–ª–æ—Ç–æ.

–í–æ–ø—Ä–æ—Å A: –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å?
- –ü–æ —Å—É–º–º–µ –≤—Å–µ—Ö —á–µ–∫–æ–≤ (lifetime)?
  ‚îî‚îÄ –ù–∞–ø—Ä–∏–º–µ—Ä: –ë—Ä–æ–Ω–∑–∞ 0-10000—Ä, –°–µ—Ä–µ–±—Ä–æ 10000-50000—Ä, –ó–æ–ª–æ—Ç–æ 50000—Ä+
- –ü–æ —Å—É–º–º–µ —á–µ–∫–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥ (—Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü/–∫–≤–∞—Ä—Ç–∞–ª)?
- –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ—Å–µ—â–µ–Ω–∏–π?
- –ü–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–º –±–∞–ª–ª–∞–º?
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ (—Å—É–º–º–∞ + –ø–æ—Å–µ—â–µ–Ω–∏—è)?

–í–æ–ø—Ä–æ—Å B: –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏:
- –ï—Å–ª–∏ –≥–æ—Å—Ç—å –±—ã–ª –Ω–∞ —É—Ä–æ–≤–Ω–µ –°–µ—Ä–µ–±—Ä–æ, –ø–æ—Ç–æ–º –ø–æ—Ç—Ä–∞—Ç–∏–ª –º–µ–Ω—å—à–µ –∏ –æ–ø—É—Å—Ç–∏–ª—Å—è –≤ –ë—Ä–æ–Ω–∑—É:
  ‚îî‚îÄ –ë–∞–ª–ª—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è?
  ‚îî‚îÄ –°–æ–∫—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è?
  ‚îî‚îÄ –ò–ª–∏ –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –±—ã–ª–æ?

–í–æ–ø—Ä–æ—Å C: –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:
- –ï—Å–ª–∏ –≥–æ—Å—Ç—å –ø—Ä–æ—à–µ–ª –ø–æ—Ä–æ–≥–æ–≤—É—é —Å—É–º–º—É –∏ –ø–æ–¥–Ω—è–ª—Å—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å:
  ‚îî‚îÄ –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?
  ‚îî‚îÄ –ö–æ–≥–¥–∞? (—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —á–µ–∫–∞? –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è? —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é?)
  ‚îî‚îÄ –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?

–í–æ–ø—Ä–æ—Å D: "–ó–æ–ª–æ—Ç–æ–π" –≥–æ—Å—Ç—å - —á—Ç–æ –¥–∞–ª—å—à–µ?
- –ú–∞–∫—Å–∏–º—É–º –ó–æ–ª–æ—Ç–æ?
- –ò–ª–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–ª–∞—Ç–∏–Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å?
```

**7Ô∏è‚É£ –°–¢–ê–¢–£–° –ö–ê–†–¢–´ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ):**

```
–í–æ–ø—Ä–æ—Å: –ö–∞–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã –º–æ–∂–µ—Ç –±—ã—Ç—å —É –∫–∞—Ä—Ç—ã?
- ACTIVE (–∞–∫—Ç–∏–≤–Ω–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç)
- FROZEN (–∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞, –≥–æ—Å—Ç—å –ø—Ä–æ—Å–∏—Ç –ø–∞—É–∑—É)
- BLOCKED (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è)
- INACTIVE (–Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ 180+ –¥–Ω–µ–π)
- EXPIRED (–∏—Å—Ç–µ–∫–ª–∞, —Å—Ç–∞—Ä–∞—è –∫–∞—Ä—Ç–∞)
- DELETED (—É–¥–∞–ª–µ–Ω–∞)

–í–æ–ø—Ä–æ—Å A: FROZEN:
- –ö—Ç–æ –º–æ–∂–µ—Ç –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å –∫–∞—Ä—Ç—É?
  ‚îî‚îÄ Admin? Manager? –°–∞–º –≥–æ—Å—Ç—å?
- –ù–∞ —Å–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å?
  ‚îî‚îÄ –ù–∞ –Ω–µ–¥–µ–ª—é? –º–µ—Å—è—Ü? –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ?
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–∞–ª–ª–∞–º–∏?
  ‚îî‚îÄ –û–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è? –ú–æ–≥—É—Ç –ª–∏ —Å–≥–æ—Ä–∞—Ç—å?
- –ú–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å?

–í–æ–ø—Ä–æ—Å B: BLOCKED:
- –ó–∞ —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è?
  ‚îî‚îÄ –ó–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ?
  ‚îî‚îÄ –ó–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª?
  ‚îî‚îÄ –ó–∞ —Ä–µ–∫–ª–∞–º–∞—Ü–∏—é?
- –ö—Ç–æ –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å? (—Ç–æ–ª—å–∫–æ Admin?)
- –ú–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å?
- –ë–∞–ª–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–µ?

–í–æ–ø—Ä–æ—Å C: INACTIVE:
- –ï—Å–ª–∏ –≥–æ—Å—Ç—å –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª 180+ –¥–Ω–µ–π:
  ‚îî‚îÄ –ö–∞—Ä—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è INACTIVE?
  ‚îî‚îÄ –ë–∞–ª–ª—ã —Å–≥–æ—Ä–∞—é—Ç?
  ‚îî‚îÄ –ë–∞–ª–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è?
- –ú–æ–∂–Ω–æ –ª–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∏–∑ INACTIVE –≤ ACTIVE?

–í–æ–ø—Ä–æ—Å D: DELETED:
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ?
  ‚îî‚îÄ –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–≤ –ë–î –æ—Å—Ç–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –≤–∏–¥–Ω–∞)?
  ‚îî‚îÄ –ñ–µ—Å—Ç–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç—Å—è)?
- –ö—Ç–æ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å? (—Ç–æ–ª—å–∫–æ Admin? Owner? –°–∞–º –≥–æ—Å—Ç—å?)
- –ï—Å–ª–∏ –≥–æ—Å—Ç—å —É–¥–∞–ª–∏–ª –∫–∞—Ä—Ç—É, –º–æ–∂–µ—Ç –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?
- –ë–∞–ª–ª—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ä—Ç—ã?
```


***

## üí∞ –ë–õ–û–ö 3: –ë–ê–õ–õ–´ –ò –°–ì–û–†–ê–ù–ò–ï

### –í–æ–ø—Ä–æ—Å—ã –ø–æ –±–∞–ª–∞–º:

**8Ô∏è‚É£ –°–ì–û–†–ê–ù–ò–ï –ë–ê–õ–õ–û–í (EXPIRATION):**

```
–í–æ–ø—Ä–æ—Å A: –ö–æ–≥–¥–∞ —Å–≥–æ—Ä–∞—é—Ç –±–∞–ª–ª—ã?
- –ß–µ—Ä–µ–∑ N –¥–Ω–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 180 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è)?
- –ß–µ—Ä–µ–∑ N –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω)?
- –û–Ω–∏ –≤–æ–æ–±—â–µ –Ω–µ —Å–≥–æ—Ä–∞—é—Ç?

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ —É –≥–æ—Å—Ç—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ä—Ü–∏–π –±–∞–ª–ª–æ–≤ (–Ω–∞—á–∏—Å–ª–µ–Ω—ã –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è):
- –°–≥–æ—Ä–∞–µ—Ç –≤ –ø–æ—Ä—è–¥–∫–µ FIFO (–ø–µ—Ä–≤—ã–º–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –ø–µ—Ä–≤—ã–º–∏ —É—Ö–æ–¥—è—Ç)?
- –ò–ª–∏ –≤—Å–µ —Å–≥–æ—Ä–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?
- –ò–ª–∏ –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å?

–í–æ–ø—Ä–æ—Å C: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–≥–æ—Ä–∞–Ω–∏–∏:
- –ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å –≥–æ—Å—Ç—è?
  ‚îî‚îÄ –ó–∞ –Ω–µ–¥–µ–ª—é?
  ‚îî‚îÄ –ó–∞ –¥–µ–Ω—å?
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ Telegram?
- –ú–æ–∂–µ—Ç –ª–∏ –≥–æ—Å—Ç—å –ø—Ä–æ–¥–ª–∏—Ç—å —Å–≥–æ—Ä–∞–Ω–∏–µ?

–í–æ–ø—Ä–æ—Å D: –ï—Å–ª–∏ –±–∞–ª–ª—ã –≤–æ—Ç-–≤–æ—Ç —Å–≥–æ—Ä—É—Ç:
- –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?
- –ò–ª–∏ —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é?
- –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–∑–∏—Ç–µ —Å–≥–æ—Ä–∞—é—â–∏–µ –±–∞–ª–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?
```

**9Ô∏è‚É£ –ú–ò–ù–ò–ú–ê–õ–¨–ù–ê–Ø –°–£–ú–ú–ê –î–õ–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –ë–ê–õ–õ–û–í:**

```
–í–æ–ø—Ä–æ—Å: –ö–∞–∫–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –±–∞–ª–ª–æ–≤ –Ω—É–∂–Ω–∞ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è?
- –ù–∞–ø—Ä–∏–º–µ—Ä, –º–∏–Ω–∏–º—É–º 100 –±–∞–ª–ª–æ–≤ (–∏–Ω–∞—á–µ –Ω–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å)?
- –ò–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 1 –±–∞–ª–ª?
- –ú–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å —Ä–∞–∑–Ω–∞—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π?
  ‚îî‚îÄ –ë—Ä–æ–Ω–∑–∞: 100 –±–∞–ª–ª–æ–≤
  ‚îî‚îÄ –°–µ—Ä–µ–±—Ä–æ: 50 –±–∞–ª–ª–æ–≤
  ‚îî‚îÄ –ó–æ–ª–æ—Ç–æ: 1 –±–∞–ª–ª (–∏–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ—Ç –º–∏–Ω–∏–º—É–º–∞)
```

**üîü –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –ë–ê–õ–ê–ù–° –ë–ê–õ–õ–û–í:**

```
–í–æ–ø—Ä–æ—Å A: –ú–æ–∂–µ—Ç –ª–∏ —É –≥–æ—Å—Ç—è –±—ã—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤?
- –ò–ª–∏ –µ—Å—Ç—å –º–∞–∫—Å–∏–º—É–º? (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100000 –±–∞–ª–ª–æ–≤)

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ –≥–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–Ω—É–ª –º–∞–∫—Å–∏–º—É–º–∞:
- –ù–æ–≤—ã–µ –±–∞–ª–ª—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è?
- –ò–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –±–∞–ª–ª—ã?
- Admin –º–æ–∂–µ—Ç –¥–∞—Ç—å override?
```

**1Ô∏è‚É£1Ô∏è‚É£ –†–£–ß–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–õ–õ–ê–ú–ò:**

```
–í–æ–ø—Ä–æ—Å A: Manager –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –Ω–∞—á–∏—Å–ª—è—Ç—å/—Å–ø–∏—Å—ã–≤–∞—Ç—å –±–∞–ª–ª—ã.

–ö–æ–≥–¥–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ?
- –ì–æ—Å—Ç—å –≤ —á–µ–∫ –Ω–µ –≤–æ—à–µ–ª, –Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã–ª –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–ª—ã?
- –ì–æ—Å—Ç—å –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ –æ—à–∏–±–∫—É, –ø—Ä–æ—Å–∏—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é?
- –ü—Ä–æ–º–æ (–∑–∞ –æ—Ç–∑—ã–≤, –∑–∞ —Ä–µ–∫–ª–∞–º—É, –∏ —Ç.–¥.)?

–í–æ–ø—Ä–æ—Å B: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?
- –ú–∞–∫—Å–∏–º—É–º —Å–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –∑–∞ —Ä–∞–∑? (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000 –±–∞–ª–ª–æ–≤)
- –ú–æ–∂–Ω–æ –ª–∏ —É—Ä–µ–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å –≤ –º–∏–Ω—É—Å?
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ Admin –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º?

–í–æ–ø—Ä–æ—Å C: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–∞ (reason)?
- –ú–æ–∂–Ω–æ –ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ?
- –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏—á–∏–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å? (enum: "Complaint", "Review", "Promo", "Error" –∏ —Ç.–¥.)

–í–æ–ø—Ä–æ—Å D: –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- –ï—Å–ª–∏ Manager –æ—à–∏–±—Å—è –∏ –Ω–∞—á–∏—Å–ª–∏–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
  ‚îî‚îÄ –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é?
  ‚îî‚îÄ –ö–∞–∫ —ç—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è?
```


***

## üéÅ –ë–õ–û–ö 4: –°–ï–ì–ú–ï–ù–¢–ê–¶–ò–Ø –ò –ü–†–ê–í–ò–õ–ê –õ–û–Ø–õ–¨–ù–û–°–¢–ò

### –í–æ–ø—Ä–æ—Å—ã –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:

**1Ô∏è‚É£2Ô∏è‚É£ –í–ê–†–ò–ê–ù–¢–´ –°–ï–ì–ú–ï–ù–¢–ê–¶–ò–ò:**

```
–°–µ–π—á–∞—Å: Admin –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤.

–í–æ–ø—Ä–æ—Å: –ö–∞–∫–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å?

–í–∞—Ä–∏–∞–Ω—Ç 1 - –ü–æ —Å—É–º–º–µ —á–µ–∫–∞:
‚îî‚îÄ –î–æ 1000—Ä: 3% –±–∞–ª–ª–∞–º–∏
‚îî‚îÄ 1000-5000—Ä: 5% –±–∞–ª–ª–∞–º–∏
‚îî‚îÄ 5000—Ä+: 10% –±–∞–ª–ª–∞–º–∏

–í–∞—Ä–∏–∞–Ω—Ç 2 - –ü–æ VIP —Å—Ç–∞—Ç—É—Å—É:
‚îî‚îÄ –û–±—ã—á–Ω—ã–π –≥–æ—Å—Ç—å: 5% –±–∞–ª–ª–∞–º–∏
‚îî‚îÄ VIP –≥–æ—Å—Ç—å (–≤—Ä—É—á–Ω—É—é –æ—Ç–º–µ—á–µ–Ω Admin): 15% –±–∞–ª–ª–∞–º–∏

–í–∞—Ä–∏–∞–Ω—Ç 3 - –ü–æ –¥–Ω—é –Ω–µ–¥–µ–ª–∏:
‚îî‚îÄ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–ß–µ—Ç–≤–µ—Ä–≥: 5% –±–∞–ª–ª–∞–º–∏
‚îî‚îÄ –ü—è—Ç–Ω–∏—Ü–∞-–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 10% –±–∞–ª–ª–∞–º–∏

–í–∞—Ä–∏–∞–Ω—Ç 4 - –ü–æ –≤—Ä–µ–º–µ–Ω–∏:
‚îî‚îÄ Lunch (11:00-15:00): 10% –±–∞–ª–ª–∞–º–∏
‚îî‚îÄ Dinner (18:00-23:00): 5% –±–∞–ª–ª–∞–º–∏

–í–∞—Ä–∏–∞–Ω—Ç 5 - –ü–æ –±–ª—é–¥—É/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
‚îî‚îÄ –î–µ—Å–µ—Ä—Ç—ã: +500 –±–∞–ª–ª–æ–≤ –∑–∞ –ª—é–±–æ–π –∑–∞–∫–∞–∑
‚îî‚îÄ –ê–ª–∫–æ–≥–æ–ª—å: -50% –±–∞–ª–ª–æ–≤ (–Ω–µ –ø–æ–æ—â—Ä—è–µ–º)
‚îî‚îÄ –ù–∞–ø–∏—Ç–∫–∏: +5% –±–∞–ª–ª–∞–º–∏

–í–∞—Ä–∏–∞–Ω—Ç 6 - –ü–æ –∏—Å—Ç–æ—Ä–∏–∏:
‚îî‚îÄ –ù–æ–≤—ã–π –≥–æ—Å—Ç—å (–ø–µ—Ä–≤—ã–π —á–µ–∫): +1000 –±–∞–ª–ª–æ–≤ (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å)
‚îî‚îÄ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π (10+ —á–µ–∫–æ–≤): +10% –±–∞–ª–ª–∞–º–∏

–ö–∞–∫–∏–µ –∏–∑ —ç—Ç–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º?
–ò–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é?
```

**1Ô∏è‚É£3Ô∏è‚É£ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –°–ï–ì–ú–ï–ù–¢–ê–¶–ò–ò:**

```
–í–æ–ø—Ä–æ—Å: –ö–∞–∫ —Å–µ–≥–º–µ–Ω—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –≥–æ—Å—Ç—é?

–°—Ü–µ–Ω–∞—Ä–∏–π: Admin —Å–æ–∑–¥–∞–ª –¥–≤–∞ –ø—Ä–∞–≤–∏–ª–∞:
‚îú‚îÄ Rule 1: –í—Å–µ –≥–æ—Å—Ç–∏ ‚Üí 5% –±–∞–ª–ª–∞–º–∏
‚îî‚îÄ Rule 2: –ì–æ—Å—Ç–∏ —Å —Å—É–º–º–æ–π —á–µ–∫–∞ > 5000—Ä ‚Üí 10% –±–∞–ª–ª–∞–º–∏

–ì–æ—Å—Ç—å –ø–æ–∫—É–ø–∞–µ—Ç –Ω–∞ 6000—Ä.

–í–æ–ø—Ä–æ—Å A: –ö–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?
- 5% (–±–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ)?
- 10% (–±–æ–ª–µ–µ –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ)?
- –û–±–∞ —Å—Ä–∞–∑—É (5% + 10% = 15%)?

–í–æ–ø—Ä–æ—Å B: –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∞–≤–∏–ª:
- –ï—Å—Ç—å –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤?
- –ú–æ–∂–Ω–æ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤–∞–∂–Ω–µ–µ?
- –ò–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º–æ–µ –≤—ã–≥–æ–¥–Ω–æ–µ –¥–ª—è –≥–æ—Å—Ç—è?
```

**1Ô∏è‚É£4Ô∏è‚É£ –ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø –ò–ó –ü–†–ê–í–ò–õ:**

```
–í–æ–ø—Ä–æ—Å: –ú–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥–æ—Å—Ç—è?

–°—Ü–µ–Ω–∞—Ä–∏–π: Admin —Ö–æ—á–µ—Ç:
‚îú‚îÄ –î–ª—è –≤—Å–µ—Ö –≥–æ—Å—Ç–µ–π: 5% –±–∞–ª–ª–∞–º–∏
‚îî‚îÄ –ù–æ –¥–ª—è –¥—Ä—É–≥–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–≥–æ—Å—Ç—å 123): 20% –±–∞–ª–ª–∞–º–∏

–≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ? –ò –∫–∞–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è?
- Admin –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –≥–æ—Å—Ç—è?
- –ò–ª–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π VIP —Å—Ç–∞—Ç—É—Å?
```


***

## üì± –ë–õ–û–ö 5: –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ò –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ö–ê–ù–ê–õ–ê–ú–ò

### –í–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

**1Ô∏è‚É£5Ô∏è‚É£ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ß–ï–†–ï–ó –ö–ê–°–°–ò–†–ê - –î–ï–¢–ê–õ–ò:**

```
–°—Ü–µ–Ω–∞—Ä–∏–π: –û—Ñ–∏—Ü–∏–∞–Ω—Ç –±–µ—Ä—ë—Ç –Ω–æ–º–µ—Ä —É –≥–æ—Å—Ç—è.

–í–æ–ø—Ä–æ—Å A: –ö–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- –ì–¥–µ —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å? (–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è –∫–∞—Å—Å–∏—Ä–∞ –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ?)
- –ò–ª–∏ –ø—Ä—è–º–æ –≤ –ü–û–° —Å–∏—Å—Ç–µ–º–µ (iiko/R-Keeper)?
- –ò–ª–∏ –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞?

–í–æ–ø—Ä–æ—Å B: –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
1. –ö–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç: –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –î–†
2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –≥–æ—Å—Ç—è –≤ –Ω–∞—à–µ–π –ë–î
3. –ü–û–° —Å–∏—Å—Ç–µ–º–∞ —É–∑–Ω–∞–µ—Ç –æ–± —ç—Ç–æ–º (–∫–∞–∫?)
   ‚îî‚îÄ –ú—ã –ø—É—à–∏–º –¥–∞–Ω–Ω—ã–µ –≤ –ü–û–°? (PUSH)
   ‚îî‚îÄ –ò–ª–∏ –ü–û–° –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç? (PULL)
4. –ü–û–° –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É (QR + 6-digit –∫–æ–¥)?
5. –ü–µ—á–∞—Ç–∞–µ—Ç –ª–∏ –∫–∞—Ä—Ç—É –Ω–∞ —á–µ–∫–µ?

–í–æ–ø—Ä–æ—Å C: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:
- –ï—Å–ª–∏ –≥–æ—Å—Ç—å –¥–∞–ª –Ω–æ–º–µ—Ä 79991234567:
  ‚îî‚îÄ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω?
  ‚îî‚îÄ –ï—Å–ª–∏ –¥–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–≥–æ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É
  ‚îî‚îÄ –ï—Å–ª–∏ –Ω–µ—Ç: —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é
- –≠—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏?

–í–æ–ø—Ä–æ—Å D: –ß—Ç–æ –µ—Å–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?
- –ö–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–æ–ø–µ—á–∞—Ç–∫–∞ –≤ –Ω–æ–º–µ—Ä–µ)?
- –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏?
- –ò–ª–∏ —Ç–æ–ª—å–∫–æ –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å?
```

**1Ô∏è‚É£6Ô∏è‚É£ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ü–û –°–°–´–õ–ö–ï - –î–ï–¢–ê–õ–ò:**

```
–í–æ–ø—Ä–æ—Å A: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Å—ã–ª–∫–∞?
- Admin —Å–æ–∑–¥–∞–µ—Ç —Å—Å—ã–ª–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä:
  https://loyalty.max.ru/register?restaurant_id=123&token=xyz789
- –û–¥–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤—Å–µ—Ö? –ò–ª–∏ —Ä–∞–∑–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥–æ—Å—Ç–µ–π?
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É —Å—Å—ã–ª–∫—É?
  ‚îî‚îÄ –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ?
  ‚îî‚îÄ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100 —Ä–∞–∑)?
  ‚îî‚îÄ –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 1 —Ä–∞–∑ –∏ —É–¥–∞–ª—è–µ—Ç—Å—è)?

–í–æ–ø—Ä–æ—Å B: –ì–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ, –≤–∏–¥–∏—Ç —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
- –ò–º—è + –¢–µ–ª–µ—Ñ–æ–Ω + –î–† (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)?
- –ú–æ–∂–µ—Ç –ª–∏ –æ–Ω —Å–æ–∑–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å –∏–ª–∏ –ø–∞—Ä–æ–ª—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π?
- Email —Ç—Ä–µ–±—É–µ—Ç—Å—è?

–í–æ–ø—Ä–æ—Å C: –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
- –ì–æ—Å—Ç—å –ø–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç—É (QR + 6-digit)?
- –ú–æ–∂–µ—Ç –ª–∏ —Å–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç—É –∫–∞–∫ PNG/PDF?
- –ú–æ–∂–µ—Ç –ª–∏ —Å–∫–∞—á–∞—Ç—å –≤ Telegram?

–í–æ–ø—Ä–æ—Å D: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:
- –õ–æ–≥–∏—Ä—É–µ–º –ª–∏, —á—Ç–æ –≥–æ—Å—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è –∏–º–µ–Ω–Ω–æ –ø–æ —Å—Å—ã–ª–∫–µ?
- –ö–∞–∫–æ–π —Å—Å—ã–ª–∫–µ? (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö —Å—Å—ã–ª–æ–∫)
- –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª –≥–æ—Å—Ç—å)?
```

**1Ô∏è‚É£7Ô∏è‚É£ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ß–ï–†–ï–ó TELEGRAM - –î–ï–¢–ê–õ–ò:**

```
–í–æ–ø—Ä–æ—Å A: –ë–æ—Ç—É –Ω–∞–ø–∏—Å–∞–ª /start:
- –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –µ—Å—Ç—å –ª–∏ —ç—Ç–æ—Ç telegram_id –≤ –Ω–∞—à–µ–π –ë–î?
  ‚îî‚îÄ –ï—Å–ª–∏ –µ—Å—Ç—å: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ–≥–æ –∫–∞—Ä—Ç—É
  ‚îî‚îÄ –ï—Å–ª–∏ –Ω–µ—Ç: –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

–í–æ–ø—Ä–æ—Å B: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram ID:
- –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –æ—Ç Telegram:
  ‚îî‚îÄ telegram_id (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  ‚îî‚îÄ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (username)
  ‚îî‚îÄ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –ø—Ä–æ—Ñ–∏–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  ‚îî‚îÄ –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–ª —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)

- –ö–∞–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?
  ‚îî‚îÄ Telegram ID –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä?
  ‚îî‚îÄ –ò–º—è –∏–∑ Telegram –ø—Ä–æ—Ñ–∏–ª—è –∫–∞–∫ –∏–º—è –≥–æ—Å—Ç—è?
  ‚îî‚îÄ –§–æ—Ç–æ –∏–∑ Telegram –∫–∞–∫ –∞–≤–∞—Ç–∞—Ä –≥–æ—Å—Ç—è?

–í–æ–ø—Ä–æ—Å C: –ï—Å–ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ Telegram:
- –ì–æ—Å—Ç—å –¥–æ–ª–∂–µ–Ω –≤–≤–æ–¥–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≤—Ä—É—á–Ω—É—é?
- –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞?

–í–æ–ø—Ä–æ—Å D: Mini app —Ñ—É–Ω–∫—Ü–∏–∏:
- –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è mini app —Å –∫–∞—Ä—Ç–æ–π
- –ú–æ–∂–µ—Ç –ª–∏ –≥–æ—Å—Ç—å –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∫–∞—Ä—Ç—É?
- –ò–ª–∏ –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞?
```


***

## üåç –ë–õ–û–ö 6: –ì–û–°–¢–¨ –í –°–ï–¢–ò –†–ï–°–¢–û–†–ê–ù–û–í

### –í–æ–ø—Ä–æ—Å—ã –ø–æ –º–Ω–æ–≥–æ—Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ—Å—Ç–∏:

**1Ô∏è‚É£8Ô∏è‚É£ –ï–î–ò–ù–ê–Ø –ö–ê–†–¢–ê vs –û–¢–î–ï–õ–¨–ù–´–ï –ö–ê–†–¢–´:**

```
–°—Ü–µ–Ω–∞—Ä–∏–π: –†–µ—Å—Ç–æ—Ä–∞–Ω–Ω–∞—è —Å–µ—Ç—å –∏–∑ 3 –º–µ—Å—Ç.

–í–∞—Ä–∏–∞–Ω—Ç A: –ï–î–ò–ù–ê–Ø –ö–ê–†–¢–ê –¥–ª—è –≤—Å–µ–π —Å–µ—Ç–∏
‚îú‚îÄ –ì–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
‚îú‚îÄ –í–∏–¥–∏—Ç –æ–¥–Ω—É –∫–∞—Ä—Ç—É –≤ Telegram
‚îú‚îÄ –ë–∞–ª–ª—ã –∫–æ–ø—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
‚îú‚îÄ –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–ª–ª—ã –≤ –ª—é–±–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ —Å–µ—Ç–∏
‚îî‚îÄ –ü—Ä–∏–º–µ—Ä: –Ø–Ω–¥–µ–∫—Å —Ç–∞–∫—Å–∏ (–±–∞–ª–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤–µ–∑–¥–µ)

–í–∞—Ä–∏–∞–Ω—Ç B: –û–¢–î–ï–õ–¨–ù–´–ï –ö–ê–†–¢–´ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
‚îú‚îÄ –ì–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
‚îú‚îÄ –í–∏–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç –≤ Telegram (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω)
‚îú‚îÄ –ë–∞–ª–ª—ã –∫–æ–ø—è—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
‚îú‚îÄ –ë–∞–ª–ª—ã –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –º–µ–∂–¥—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º–∏
‚îî‚îÄ –ü—Ä–∏–º–µ—Ä: –†–∞–∑–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤

–í–æ–ø—Ä–æ—Å A: –ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
- –í—ã–±–∏—Ä–∞–µ—Ç Admin –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏?
- –ú–æ–∂–Ω–æ –ª–∏ –º–µ–Ω—è—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è?

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ –ï–î–ò–ù–ê–Ø –ö–ê–†–¢–ê:
- –ö–∞–∫ –≥–æ—Å—Ç –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –±–∞–ª–ª—ã?
  ‚îî‚îÄ –û–±—â–∏–π –±–∞–ª–∞–Ω—Å?
  ‚îî‚îÄ –ü–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º (–±–∞–ª–∞–Ω—Å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –ê, –±–∞–ª–∞–Ω—Å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –ë)?
- –ï—Å–ª–∏ —É—Ä–æ–≤–Ω–∏ —Ä–∞–∑–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö:
  ‚îî‚îÄ –ö–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≥–æ—Å—Ç—é?
  ‚îî‚îÄ –°–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π?
  ‚îî‚îÄ –°—Ä–µ–¥–Ω–∏–π?

–í–æ–ø—Ä–æ—Å C: –ï—Å–ª–∏ –û–¢–î–ï–õ–¨–ù–´–ï –ö–ê–†–¢–´:
- –ö–∞–∫ –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç –∏—Ö –≤ Telegram?
  ‚îî‚îÄ –í–∫–ª–∞–¥–∫–∏ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω 1, —Ä–µ—Å—Ç–æ—Ä–∞–Ω 2, —Ä–µ—Å—Ç–æ—Ä–∞–Ω 3)?
  ‚îî‚îÄ –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞?
- –ú–æ–∂–µ—Ç –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–ª–ª—ã –æ–¥–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–º?
  ‚îî‚îÄ –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±–º–µ–Ω—è—Ç—å –±–∞–ª–ª—ã –∏–∑ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –ê –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ë?

–í–æ–ø—Ä–æ—Å D: –ï—Å–ª–∏ –≤ —Å–µ—Ç–∏ –æ–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –≤—Å–µ—Ö:
- –ù–æ Admin —Ö–æ—á–µ—Ç —Ä–∞–∑–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞:
  ‚îî‚îÄ –í–æ–∑–º–æ–∂–Ω–æ –ª–∏? (–æ–¥–Ω–∞ –ª–æ–≥–∏–∫–∞, —Ä–∞–∑–Ω—ã–µ –≤–∏–∑—É–∞–ª—ã)
```

**1Ô∏è‚É£9Ô∏è‚É£ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –û–î–ù–û–ì–û –ì–û–°–¢–Ø –í –†–ê–ó–ù–´–• –†–ï–°–¢–û–†–ê–ù–ê–•:**

```
–°—Ü–µ–Ω–∞—Ä–∏–π: –ì–æ—Å—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ê, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è.
–ü–æ—Ç–æ–º –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω –ë —Ç–æ–π –∂–µ —Å–µ—Ç–∏.

–í–æ–ø—Ä–æ—Å A: –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–µ—Ç –ª–∏, —á—Ç–æ —ç—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –≥–æ—Å—Ç—å?
- –ü–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞?
- –ü–æ Telegram ID?
- –ü–æ email?

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —É–∑–Ω–∞–ª–∞:
- –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –ë?
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–∞—Ä—Ç–∞?
- –ë–∞–ª–ª—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è?

–í–æ–ø—Ä–æ—Å C: –ï—Å–ª–∏ –≥–æ—Å—Ç—å –¥–∞–ª —Ä–∞–∑–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö:
- –≠—Ç–æ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Å—Ç—è –≤ —Å–∏—Å—Ç–µ–º–µ?
- –ò–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∏—Ö –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å?
```

**2Ô∏è‚É£0Ô∏è‚É£ –õ–ò–ú–ò–¢–´ –ü–û –ì–û–°–¢–Ø–ú –í –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –û–¢ –¢–ê–†–ò–§–ê:**

```
–°–µ–π—á–∞—Å:
- STANDARD: –¥–æ 500 –≥–æ—Å—Ç–µ–π
- MEDIUM: –¥–æ 2000 –≥–æ—Å—Ç–µ–π
- PRO: –¥–æ 6000 –≥–æ—Å—Ç–µ–π
- ULTIMATE: ‚àû –≥–æ—Å—Ç–µ–π

–í–æ–ø—Ä–æ—Å A: –ö–∞–∫ —Å—á–∏—Ç–∞—é—Ç—Å—è –≥–æ—Å—Ç–∏?
- –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç?
- –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤?
- –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É User –∑–∞–ø–∏—Å–µ–π —Å role = GUEST?

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ –≥–æ—Å—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –¥–≤—É—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö —Å–µ—Ç–∏:
- –≠—Ç–æ 1 –≥–æ—Å—Ç—å –∏–ª–∏ 2 –≥–æ—Å—Ç—è?
- –°—á–∏—Ç–∞—é—Ç—Å—è –ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞?

–í–æ–ø—Ä–æ—Å C: –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç:
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?
  ‚îî‚îÄ –ù–æ–≤—ã–µ –≥–æ—Å—Ç–∏ –Ω–µ –º–æ–≥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è?
  ‚îî‚îÄ –ò–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥–æ—Å—Ç–µ–π?
  ‚îî‚îÄ –ò–ª–∏ —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "–ª–∏–º–∏—Ç –ø–æ—á—Ç–∏ –∏—Å—á–µ—Ä–ø–∞–Ω"?
- Admin –º–æ–∂–µ—Ç —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –º–Ω–æ–≥–æ –≥–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç?
```


***

## üîó –ë–õ–û–ö 7: –°–í–Ø–ó–¨ –ú–ï–ñ–î–£ –ì–û–°–¢–ï–ú –ò –†–ï–°–¢–û–†–ê–ù–û–ú

### –í–æ–ø—Ä–æ—Å—ã –ø–æ —Å–≤—è–∑—è–º:

**2Ô∏è‚É£1Ô∏è‚É£ –ú–û–ñ–ï–¢ –õ–ò –ì–û–°–¢–¨ –ë–´–¢–¨ –ü–†–ò–í–Ø–ó–ê–ù –ö –ù–ï–°–ö–û–õ–¨–ö–ò–ú –†–ï–°–¢–û–†–ê–ù–ê–ú?**

```
–í–æ–ø—Ä–æ—Å A: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:
- –¢–∞–±–ª–∏—Ü–∞ User (–æ—Å–Ω–æ–≤–Ω–∞—è, –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –Ω–∞ –≥–æ—Å—Ç—è)
- –¢–∞–±–ª–∏—Ü–∞ GuestCard (–æ–¥–Ω–∞ –Ω–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω? –∏–ª–∏ –æ–¥–Ω–∞ –≤—Å–µ–≥–æ?)

–í–∞—Ä–∏–∞–Ω—Ç A: GuestCard —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –æ–¥–Ω–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É
‚îú‚îÄ User ‚Üí –º–Ω–æ–≥–∏–µ GuestCard
‚îú‚îÄ GuestCard ‚Üí –æ–¥–∏–Ω Restaurant
‚îî‚îÄ –ï—Å–ª–∏ –≥–æ—Å—Ç—å –≤ –¥–≤—É—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö: –¥–≤–µ GuestCard

–í–∞—Ä–∏–∞–Ω—Ç B: GuestCard –æ–¥–Ω–∞ –Ω–∞ –≥–æ—Å—Ç—è (–≤—Å—è —Å–µ—Ç—å)
‚îú‚îÄ User ‚Üí –æ–¥–Ω–∞ GuestCard
‚îî‚îÄ GuestCard ‚Üí –≤—Å—è —Å–µ—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤

–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ –≥–æ—Å—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö —Ä–∞–∑–Ω—ã—Ö —Ç–µ–Ω–∞–Ω—Ç–æ–≤:
- –≠—Ç–æ –æ–¥–∏–Ω User –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö?
- –ò–ª–∏ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö User (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç)?
```

**2Ô∏è‚É£2Ô∏è‚É£ –ò–°–¢–û–†–ò–Ø –ü–û–°–ï–©–ï–ù–ò–ô –ì–û–°–¢–Ø:**

```
–í–æ–ø—Ä–æ—Å A: –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–µ—â–µ–Ω–∏–∏?
- –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ GuestVisit?
- –ò–ª–∏ —á–∞—Å—Ç—å BallTransaction?

–í–æ–ø—Ä–æ—Å B: –ö–∞–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å?
- –î–∞—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏—è
- –°—É–º–º–∞ —á–µ–∫–∞
- –í—Ä–µ–º—è (—Å –∫–∞–∫–æ–π –ø–æ –∫–∞–∫—É—é)
- –ß—Ç–æ –∑–∞–∫–∞–∑–∞–ª (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ–Ω—é)
- –ö–∞—Å—Å–∏—Ä (–∫–∞–∫–æ–π –∫–∞—Å—Å–∏—Ä –ø—Ä–æ–≤–æ–¥–∏–ª)
- –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–Ω–∞–ª–∏—á–Ω—ã–µ, –∫–∞—Ä—Ç–∞, –∏ —Ç.–¥.)

–í–æ–ø—Ä–æ—Å C: –ï—Å–ª–∏ –≥–æ—Å—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å:
- –í—Å–µ –ø–æ—Å–µ—â–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ?
- –ò–ª–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ?

–í–æ–ø—Ä–æ—Å D: –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç –≤ Telegram:
- –í—Å—é –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–µ—â–µ–Ω–∏–π?
- –ò–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π?
- –ò–ª–∏ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥?
```


***

## üõ°Ô∏è –ë–õ–û–ö 8: –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ü–†–ò–í–ê–¢–ù–û–°–¢–¨

### –í–æ–ø—Ä–æ—Å—ã –ø–æ –∑–∞—â–∏—Ç–µ –¥–∞–Ω–Ω—ã—Ö:

**2Ô∏è‚É£3Ô∏è‚É£ –®–ò–§–†–û–í–ê–ù–ò–ï –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•:**

```
–í–æ–ø—Ä–æ—Å: –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ —à–∏—Ñ—Ä–æ–≤–∞—Ç—å?
- –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞?
- Email?
- –§–ò–û?
- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è?
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π?
- –ò—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤?

–ò–ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–Ω–æ –∑–∞—â–∏—â–µ–Ω—ã –¥–æ—Å—Ç—É–ø–æ–º –Ω–∞ —É—Ä–æ–≤–Ω–µ API)?
```

**2Ô∏è‚É£4Ô∏è‚É£ –î–û–°–¢–£–ü ADMIN –ö –î–ê–ù–ù–´–ú –ì–û–°–¢–Ø:**

```
–í–æ–ø—Ä–æ—Å A: Manager –≤–∏–¥–∏—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≥–æ—Å—Ç—è:
- –í –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä)?
- –ó–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (79XX XXX XX 90)?
- –ò–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ –≤–∏–¥–∏—Ç?

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ gost –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö:
- –ú–æ–∂–µ—Ç –ª–∏ Admin –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –µ–º—É?
- –ò–ª–∏ –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ?
- –≠—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏?

–í–æ–ø—Ä–æ—Å C: GDPR/–ü–æ–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏:
- –ì–æ—Å—Ç—å –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö?
- –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —É–¥–∞–ª–∏—Ç—å –≤—Å—ë (–∑–∞–±—ã–≤—á–∏–≤–æ—Å—Ç—å)?
- –ò–ª–∏ —Ç–æ–ª—å–∫–æ –∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å?
```


***

## üí° –ë–õ–û–ö 9: –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–õ–£–ß–ê–ò

### –í–æ–ø—Ä–æ—Å—ã –ø–æ –æ—Å–æ–±—ã–º —Å–∏—Ç—É–∞—Ü–∏—è–º:

**2Ô∏è‚É£5Ô∏è‚É£ –ß–Å–†–ù–´–ô –°–ü–ò–°–û–ö / –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–ï –ì–û–°–¢–ò:**

```
–í–æ–ø—Ä–æ—Å A: –ú–æ–∂–µ—Ç –ª–∏ –≥–æ—Å—Ç—å –±—ã—Ç—å –≤ —á—ë—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ?
- –ó–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ?
- –ó–∞ –Ω–µ–æ–ø–ª–∞—Ç—É? (–Ω–æ —É –≤–∞—Å –∂–µ –ø–æ—Å—Ç–æ–ø–ª–∞—Ç–∞ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ)
- –ó–∞ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è?

–í–æ–ø—Ä–æ—Å B: –ï—Å–ª–∏ –≥–æ—Å—Ç—å –≤ —á—ë—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ:
- –ö–∞—Ä—Ç–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è?
- –ú–æ–∂–µ—Ç –ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω (–Ω–æ –±–µ–∑ —Å–∫–∏–¥–æ–∫)?
- –ò–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç—Å—è?

–í–æ–ø—Ä–æ—Å C: –ö—Ç–æ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫?
- –¢–æ–ª—å–∫–æ Admin?
- –ò–ª–∏ Manager —Ç–æ–∂–µ?
```

**2Ô∏è‚É£6Ô∏è‚É£ –ü–ï–†–ï–í–û–î –ë–ê–õ–õ–û–í –ú–ï–ñ–î–£ –ì–û–°–¢–Ø–ú–ò:**

```
–í–æ–ø—Ä–æ—Å: –ú–æ–∂–µ—Ç –ª–∏ –≥–æ—Å—Ç—å –ø–æ–¥–∞—Ä–∏—Ç—å –±–∞–ª–ª—ã –¥—Ä—É–≥–æ–º—É –≥–æ—Å—Ç—é?
- –ù–∞–ø—Ä–∏–º–µ—Ä, —É –æ–¥–Ω–æ–≥–æ 5000 –±–∞–ª–ª–æ–≤, –æ–Ω —Ö–æ—á–µ—Ç –ø–æ–¥–∞—Ä–∏—Ç—å 1000 –¥—Ä—É–≥—É?
- –≠—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è?
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (SMS, email)?
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ª–∏ –∫–∞–∫ –æ–ø–µ—Ä–∞—Ü–∏—è?
```

**2Ô∏è‚É£7Ô∏è‚É£ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ë–ê–õ–õ–û–í –¢–†–ï–¢–¨–ò–ú –õ–ò–¶–û–ú:**

```
–í–æ–ø—Ä–æ—Å: –ß—Ç–æ –µ—Å–ª–∏ –≥–æ—Å—Ç—å —Ä–∞–∑—Ä–µ—à–∏–ª –∂–µ–Ω–µ/–¥—Ä—É–≥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –±–∞–ª–ª—ã?
- –°–∏—Å—Ç–µ–º–∞ —ç—Ç–æ –∑–Ω–∞–µ—Ç?
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ —Å–æ–≥–ª–∞—Å–∏–µ?
- –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞/QR –∫–æ–¥?
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ª–∏ –∫—Ç–æ –∏–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –±–∞–ª–ª—ã?
```


***

–í–æ—Ç **27 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤**!

üìù **–û—Ç–≤–µ—Ç—å –ø–æ –ø–æ—Ä—è–¥–∫—É**, –∏ —è —Å–æ–∑–¥–∞–º –ø–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

- Entities (User, GuestProfile, GuestCard, BallTransaction, GuestVisit –∏ —Ç.–¥.)
- Services (GuestService, LoyaltyCardService, BallService –∏ —Ç.–¥.)
- Controllers (–≥–æ—Å—Ç–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- –ü–æ–ª–Ω—ã–π flow –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

–ì–æ—Ç–æ–≤? üöÄ

--- –û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
    1. –ú–∞–π–ª (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ü–æ–ª (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) 
–°–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–µ–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) 
–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) 

    2. –ê - –î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞
B - –í—Å–µ —ç—Ç–∏ –ø–æ–ª—è
C - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å
—á–µ—Ä–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

    3. –ê - –ù—É–∂–Ω–∞ –≤–µ—Ä–µ—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞, –±–∞–ª–ª—ã, —É—Ä–æ–≤–µ–Ω—å –∏ —Ç–¥. –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä, –≤—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
 B - –ú–æ–∂–µ—Ç –≤–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ –º–∞–π–ª. –ù–æ —ç—Ç–æ –≤—Ä—è–¥-–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –≤ –º–∏–Ω–∏ –∞–ø–ø —Ç–µ–ª–µ–≥—Ä–∞–º–º–∞ –≤–∏—Å–∏—Ç –µ–≥–æ –∫–∞—Ä—Ç–∞, –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –¥–∞–Ω–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ —Ç–µ–ª–µ–≥—Ä–∞–º–∞ –Ω–∏–∫–æ–≥–¥–∞, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. 
C - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ. –î–ª—è —Å–µ—Ç–∏ - –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç—ã –æ–¥–Ω–∏ –Ω–∞ –≤—Å—é —Å–µ—Ç—å (–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è), –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ —Å–µ—Ç–∏ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö —Å–µ—Ç–∏). 

–ï—â–µ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —á—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —á—Ç–æ –º—ã —Å–æ–∑–¥–∞–µ–º –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ –º–Ω–æ–≥–∏—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –∏ –º–Ω–æ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤. –ò —É –≥–æ—Å—Ç–µ–π –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–æ–∑–Ω–∏–∫–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è–º–∏ –Ω–∏ –≤ –æ–¥–Ω–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ –∑–∞—Ä–µ–≥–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –Ω–∞ –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Max_loyalty. 

    4. A - –ò–º—è, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
B - –ú–∞–∫—Å–∏–º—É–º 3
C - –ù–µ –º–æ–∂–µ—Ç –æ—Ç–¥–µ–ª–∏—Ç—å—Å—è, –æ—Å—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å
D - –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
–í–∞–∂–Ω–æ, –±–∞–ª–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ —Ä–µ–±–µ–Ω–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å –∫–∞—Ä—Ç—ã —Ä–æ–¥–∏—Ç–µ–ª—è. –£–∫–∞–∑–∞–Ω–∏–µ –¥–µ—Ç–µ–π –Ω—É–∂–Ω–æ –ª–∏—à—å –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–º–æ –∞–∫—Ü–∏–π –∏ –∏–Ω–∞–ª–∏—Ç–∏–∫–∏. 

    5. A - –í–µ—Ä–Ω–æ
B - –û–±–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ, –Ω–æ –Ω–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –≤–≤–µ–¥–µ–Ω–∏—è 6 –∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ –∫–∞—Å—Å–µ, –∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–∞—Ä—Ç–æ–π (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ, —Å–ø–∏—Å–∞–Ω–∏–µ). 
C - –°—Ç–∞—Ä—ã–π –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ invalid
D - –ö–æ–¥—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

    6. A - –ü–æ —Å—É–º–º–µ –≤—Å–µ—Ö —á–µ–∫–æ–≤
B - –û–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞ –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –Ω–µ –≤–æ–∑–º–æ–∂–Ω–æ. –ï—Å–ª–∏ –¥–æ—à–µ–ª —É—Å–ª–æ–≤–Ω–æ, –¥–æ silver, —Ç–æ –Ω–∞ bronze —É–∂–µ –Ω–µ –æ–ø—É—Å—Ç–∏—à—å—Å—è. –¢–æ–ª—å–∫–æ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è. –ò–º–µ—é—â–∏–µ—Å—è –±–∞–ª–ª—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è. 
C - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
D - –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —É—Ä–æ–≤–Ω–µ–π —Å–æ —Å–≤–æ–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏. –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ admin –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ - –µ—Å–ª–∏ —Å–µ—Ç—å).

    7. Active, blocked, deleted. 
A - –ó–∞–º–æ—Ä–æ–∑–æ–∫ –Ω–µ—Ç
B - –ó–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª. –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Admin –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä, –µ—Å–ª–∏ —É –Ω–µ–≥–æ –Ω–µ –∑–∞–±—Ä–∞–ª —ç—Ç–æ –ø—Ä–∞–≤–æ admin. –ú–æ–∂–Ω–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å. –ë–∞–ª–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è. 
C - –±–∞–ª–ª—ã —Å–≥–æ—Ä–∞—é—Ç. –ü–µ—Ä–∏–æ–¥ –∑–∞ –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è Admin –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—â–µ —á–µ–º "—Ä–∞–∑ –≤ 90 –¥–Ω–µ–π". 
inactive - —Å—Ç–∞—Ç—É—Å–∞ –∫–∞—Ä—Ç—ã –Ω–µ—Ç. –¢–æ–ª—å–∫–æ Active, blocked, deleted
D - –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ. –ú–æ–≥—É—Ç —É–¥–∞–ª–∏—Ç—å Owner, Admin, –º–µ–Ω–µ–¥–∂–µ—Ä, –≥–æ—Å—Ç—å. –ü—Ä–∏ –≤–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–ª—ã –Ω–µ –≤–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è. –¢–æ–ª—å–∫–æ —É—Ä–æ–≤–µ–Ω—å –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≥–æ—Å—Ç—å. 

    8. A - —á–µ—Ä–µ–∑ N –¥–Ω–µ–π –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ü–µ—Ä–∏–æ–¥ –∑–∞ –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è Admin –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—â–µ —á–µ–º "—Ä–∞–∑ –≤ 90 –¥–Ω–µ–π". 
B - –í—Å–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. 
C - –ó–∞ –Ω–µ–¥–µ–ª—é –∏ –∑–∞ –¥–µ–Ω—å. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–∏ –∏ mail(–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω). –ü—Ä–æ–¥–ª–∏—Ç—å —Å–≥–æ—Ä–∞–Ω–∏–µ –Ω–µ–ª—å–∑—è. 
D - –ò –≤—Ä—É—á–Ω—É—é –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. 

    9. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—É—é —Å—É–º–º—É –±–∞–ª–ª–æ–≤ –Ω–∞ –ª—é–±–æ–º —É—Ä–æ–≤–Ω–µ, –Ω–æ: –ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤ –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –Ω–∏–∂–µ 1 –±–∞–ª–ª–∞. –°–ø–∏—Å–∞—Ç—å –±–∞–ª–ª–∞–º–∏ –º–æ–∂–Ω–æ N% –æ—Ç —Å—É–º–º—ã —á–µ–∫–∞, —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è Admin –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏. 
    10.A - –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ. 
B - –ú–∞–∫—Å–∏–º—É–º –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω. 
11. A - –ó–∞ –ª—é–±—É—é —Å–∏—Ç—É–∞—Ü–∏—é. –í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã. 
B - –ú–∞–∫—Å–∏–º—É–º –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω. –í –º–∏–Ω—É—Å —É—Ä–µ–∑–∞—Ç—å –Ω–µ–ª—å–∑—è. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. 
C - –ü—Ä–∏—á–∏–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞. –û—Å—Ç–∞–≤–∏—Ç—å "–ø—É—Å—Ç–æ" –Ω–µ–ª—å–∑—è. –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏—á–∏–Ω –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è. 
D - –ú–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ "–æ—à–∏–±–æ—á–Ω–æ–µ —Ä—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ". 

12. –õ—é–±—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ –ø–æ —Å–≤–æ–µ–º—É –Ω–∞–∑—ã–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å). –¢–∞–∫–∂–µ –Ω–∞ —Å–∏–≥–º–µ–Ω—Ç—ã  –∞—É–¥–∏—Ç–æ—Ä–∏–π, –∫–∞–∫ –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ —Ç–µ—Ö, –∫–æ–≥–æ –Ω–µ –±—ã–ª–æ 3 –∏ –±–æ–ª–µ–µ –º–µ—Å—è—Ü–µ–≤, –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –≥–æ—Å—Ç–µ–π (1 –∏ –±–æ–ª–µ–µ —Ä–∞–∑ –∑–∞ N –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π, –Ω–∞ –≥–æ—Å—Ç–µ–π —Å –¥–µ—Ç—å–º–∏ –∏ —Ç–¥.) 

13. A - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–æ–ª–µ–µ –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ. 
B - –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º–æ–µ –≤—ã–≥–æ–¥–Ω–æ–µ –¥–ª—è –≥–æ—Å—Ç—è. 


14. –î–∞, –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è, —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ. Admin –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –≥–æ—Å—Ç—è. 

15. A - –ø—Ä—è–º–æ –≤ –ü–û–° —Å–∏—Å—Ç–µ–º–µ (iiko/R-Keeper). 
B - –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
1. –ö–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç: –∏–º—è (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), —Ç–µ–ª–µ—Ñ–æ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –î–† (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) 
2. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –≥–æ—Å—Ç—è –≤ –Ω–∞—à–µ–π –ë–î - –≤–µ—Ä–Ω–æ. 
3. –ü–û–° —Å–∏—Å—Ç–µ–º–∞ —É–∑–Ω–∞–µ—Ç –æ–± —ç—Ç–æ–º (–∫–∞–∫?) - –≤—ã–±–µ—Ä–∏ –ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Å–∞–º. 
4. –ü–û–° –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É (QR + 6-digit –∫–æ–¥)? - –ù–µ—Ç, –ü–û–° —Ç–∞–∫–æ–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç. –ü–æ—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç—è, –æ–±—â—É—é —Å—É–º–º—É –±–∞–ª–ª–æ–≤, –±–∞–ª–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è(–µ—Å–ª–∏ –∫–∞—Ä—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —É–∂–µ –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É —á–µ–∫—É, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è). –í –¥–∞–ª—å–Ω–µ–π—à–µ–º —ç—Ç–æ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –∫–∞—Å—Å–µ –≥–æ—Å—Ç—å –º–æ–∂–µ—Ç –ª–∏–±–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞—Ä—Ç–æ–π (—Ç–æ–ª—å–∫–æ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞), –ª–∏–±–æ –ø—Ä–æ–π—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏ —É–≤–∏–¥–µ—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç—É, –≥–¥–µ –∏ –±—É–¥–µ—Ç –∏ qr –∏ 6 –∑–Ω–∞—á–Ω—ã–π –∫–æ–¥. 
    5. –ü–µ—á–∞—Ç–∞–µ—Ç –ª–∏ –∫–∞—Ä—Ç—É –Ω–∞ —á–µ–∫–µ? - –ù–∞ —á–µ–∫–µ –ø–µ—á–∞—Ç–∞–µ—Ç—Å—è —Å—É–º–º–∞ —Å —É—á–µ—Ç–æ–º —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤, –∏–ª–∏ —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–∫–∏ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è). –í–∞–∂–Ω–æ - –ï—Å–ª–∏ —É —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, 2 —é—Ä.–ª–∏—Ü–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —á–µ–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤ —á–µ–∫–µ –∏–¥–µ—Ç —Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —Å—É–º–º—É –∫ –æ–ø–ª–∞—Ç–µ –ø–æ –∞–ª–∫–æ–≥–æ–ª—é –∏ —Å—É–º–º—É –∫ –æ–ø–ª–∞—Ç–µ –ø–æ –∫—É—Ö–Ω–µ, —Ç–æ —Å—É–º–º–∞ —Å —É—á–µ—Ç–æ–º —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤/—Å–∫–∏–¥–∫–∏ –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–∞–∫–∂–µ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π —ç—Ç–∏—Ö –±–∞–ª–ª–æ–≤ –Ω–∞ —ç—Ç–∏ —é—Ä.–ª–∏—Ü–∞ (–±–∞—Ä, –∫—É—Ö–Ω—è)). 

C - –î–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. 

D - –ú–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏. 

16. A - –û–¥–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤—Å–µ—Ö –≥–æ—Å—Ç–µ–π. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
B - –∏–º—è (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), —Ç–µ–ª–µ—Ñ–æ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ), –î–† (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). –ü–∞—Ä–æ–ª—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, mail (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). 
C - –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Å—Ç—å –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "–í–∞—à–∞ –∫–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –Ω–∞–∑–æ–≤–∏—Ç–µ –µ–≥–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—É".
D - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω—É–∂–Ω–æ, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –Ω—É–∂–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏. –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –ø–æ –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ —Å—Å—ã–ª–∫–µ. 

17. A - –≤–µ—Ä–Ω–æ
B - –ò—Å–ø–æ–ª—å–∑—É–µ–º: —Ç–µ–ª–µ–≥—Ä–∞–º id (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä), –ò–º—è(–∫–∞–∫ –∏–º—è –≥–æ—Å—Ç—è), –§–æ—Ç–æ(–∫–∞–∫ –∞–≤–∞—Ç–∞—Ä –≥–æ—Å—Ç—è), –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä).
C- –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è —Å —Ç–µ–ª–µ–≥—Ä–∞–º id - –ø—Ä–æ—Å–∏–º —É–∫–∞–∑–∞—Ç—å –µ–≥–æ –≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, —Å –≤–µ—Ä–µ—Ñ–∏–∫–∞—Ü–∏–µ–π. 
D - –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∫–∞—Ä—Ç—É, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –¥–ª—è –Ω–µ–≥–æ, –ú–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å "—Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è" –æ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ - –µ—Å–ª–∏ admin  –∏—Ö –Ω–∞—Å—Ç—Ä–æ–∏–ª –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≥–æ—Å—Ç—è–º, –∏–ª–∏ –≤—Å–µ–º –≥–æ—Å—Ç—è–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏.

18. A - –î–∞, –≤—ã–±–∏—Ä–∞–µ—Ç Admin –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏, –∏ –º–æ–∂–Ω–æ –ª–∏ –º–µ–Ω—è—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è. 
B - –û–±—â–∏–µ –±–∞–ª–ª—ã, –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É(–æ–±—â—É—é) –∫–∞—Ä—Ç—É, —Å –æ–±—â–∏–º —É—Ä–æ–≤–Ω–µ–º –∏ —Ç–¥. 
C - –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞. 
–ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∞–ª–ª—ã –æ–¥–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –≤ –¥—Ä—É–≥–æ–º, –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ Admin –¥–∞–ª —Ç–∞–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è Admin –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.  
D - –í–æ–∑–º–æ–∂–Ω–æ. 

19. A - –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–µ—Ç —á—Ç–æ —ç—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –≥–æ—Å—Ç—å. –ü–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –º–∞–π–ª, —Ç–µ–ª–µ–≥—Ä–∞–º id. 
B - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è. 
C - –≠—Ç–æ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –≥–æ—Å—Ç—è –≤ —Å–∏—Å—Ç–µ–º–µ. 

20. –í–∞–∂–Ω–æ - —Ç–∞—Ä–∏—Ñ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –≥–æ—Å—Ç–µ–π "–≥–ª–æ–±–∞–ª—å–Ω–æ" (–ø—Ä–∏–º–µ—Ä: —Ç–∞—Ä–∏—Ñ medium –¥–æ 2000 –≥–æ—Å—Ç–µ–π. 2000 –≥–æ—Å—Ç–µ–π –Ω–∞ –≤—Å–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã —Å–µ—Ç–∏(–µ—Å–ª–∏ —Å–µ—Ç—å), –∞ –Ω–µ –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å–µ—Ç–∏ –ø–æ 2000 –≥–æ—Å—Ç–µ–π. 

 A - –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç. 
B - –≠—Ç–æ –æ–¥–∏–Ω –≥–æ—Å—Ç—å. –°—á–∏—Ç–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ. 
C - –ù–æ–≤—ã–µ –≥–æ—Å—Ç–∏ –Ω–µ –º–æ–≥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è. –ó–∞—Ä–∞–Ω–µ–µ Admin –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á—Ç–æ –ª–∏–º–∏—Ç –ø–æ—á—Ç–∏ –∏—Å—á–µ—Ä–ø–∞–Ω. Admin –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Å–∫–æ–ª—å–∫–æ –≥–æ—Å—Ç–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç. 

21. A - –í—ã–±–µ—Ä–∏ –Ω–∞–∏–ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. 

22. A - –í—ã–±–µ—Ä–∏ –Ω–∞–∏–ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. 
B - –í—Å–µ —ç—Ç–æ –Ω—É–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å. "–ß—Ç–æ –∑–∞–∫–∞–∑–∞–ª" –¥–æ–ª–∂–Ω–æ –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å—Å—è —Å —á–µ–∫–∞ –∏–∑ pos —Å–∏—Å—Ç–µ–º—ã. 
C - –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ. 
D - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π. 

23. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, –∑–∞—â–∏—â–µ–Ω—ã –¥–æ—Å—Ç—É–ø–æ–º –Ω–∞ —É—Ä–æ–≤–Ω–µ API. 

24. A - –í –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ. 
B - –í—Å–µ —Ä–∞–≤–Ω–æ –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–Ω–∏—Ç—å. 
C - –ú–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ. –°–∏—Å—Ç–µ–º–∞ –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ. 

25. A - –ì–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ. 
B - –ö–∞—Ä—Ç–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è. –ú–æ–∂–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω. 
C - Admin –∏ –º–µ–Ω–µ–¥–∂–µ—Ä(–µ—Å–ª–∏ admin –Ω–µ –∑–∞–±—Ä–∞–ª —É –Ω–µ–≥–æ —Ç–∞–∫—É—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å). 

26. –î–∞, –¥–∞—Ä–∏—Ç—å –±–∞–ª–ª—ã –º–æ–∂–Ω–æ. –≠—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –Ω–æ —Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç–µ Admin. –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ Sms, –¥–µ–π—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è. 

27. –°–∏—Å—Ç–µ–º–µ –≤—Å–µ —Ä–∞–≤–Ω–æ. –ü—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

# üéØ –ü–û–õ–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø GUESTS \& LOYALTY CARDS

–û—Ç–ª–∏—á–Ω–æ! –Ø –ø–æ–ª—É—á–∏–ª –≤—Å–µ –æ—Ç–≤–µ—Ç—ã. –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—é **–ø–æ–ª–Ω—É—é –±–æ–µ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é** –º–æ–¥—É–ª—è Guests \& Loyalty Cards —Å —É—á—ë—Ç–æ–º –≤—Å–µ—Ö –¥–µ—Ç–∞–ª–µ–π.

***

## üìä –ê–ù–ê–õ–ò–ó –û–¢–í–ï–¢–û–í - –ö–õ–Æ–ß–ï–í–´–ï –†–ï–®–ï–ù–ò–Ø

### üîë –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:

```
‚úÖ MULTI-TENANT ISOLATION:
‚îú‚îÄ –ì–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–µ–Ω–∞–Ω—Ç–∞—Ö (—Ä–∞–∑–Ω—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã)
‚îú‚îÄ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É (–æ—Å–Ω–æ–≤–Ω–æ–π) + email + telegram_id
‚îú‚îÄ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–µ–Ω–∞–Ω—Ç–∞
‚îî‚îÄ –û–¥–∏–Ω –≥–æ—Å—Ç—å = –æ–¥–∏–Ω User, –Ω–æ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ GuestCard (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç –∏–ª–∏ –æ–¥–Ω—É –Ω–∞ –≤—Å—é —Å–µ—Ç—å)

‚úÖ LOYALTY CARD MODES:
‚îú‚îÄ UNIFIED (–µ–¥–∏–Ω–∞—è –∫–∞—Ä—Ç–∞ –Ω–∞ –≤—Å—é —Å–µ—Ç—å - –æ–¥–∏–Ω GuestCard)
‚îú‚îÄ SEPARATE (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω - –º–Ω–æ–≥–æ GuestCard)
‚îî‚îÄ –í—ã–±–∏—Ä–∞–µ—Ç—Å—è Admin –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å

‚úÖ BALL EXPIRATION:
‚îú‚îÄ –ü–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–º–∏–Ω–∏–º—É–º 90 –¥–Ω–µ–π)
‚îú‚îÄ –í—Å–µ –±–∞–ª–ª—ã —Å–≥–æ—Ä–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
‚îú‚îÄ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –∑–∞ –Ω–µ–¥–µ–ª—é + –∑–∞ –¥–µ–Ω—å (Telegram + Email)
‚îî‚îÄ –ù–µ–ª—å–∑—è –ø—Ä–æ–¥–ª–∏—Ç—å

‚úÖ LOYALTY LEVELS:
‚îú‚îÄ –¢–æ–ª—å–∫–æ –ø–æ–≤—ã—à–µ–Ω–∏–µ (bronze ‚Üí silver ‚Üí gold ‚Üí ...)
‚îú‚îÄ –ü–æ —Å—É–º–º–µ –≤—Å–µ—Ö —á–µ–∫–æ–≤ (lifetime)
‚îú‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
‚îî‚îÄ –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

‚úÖ CARD STATUS:
‚îú‚îÄ ACTIVE (—Ä–∞–±–æ—Ç–∞–µ—Ç)
‚îú‚îÄ BLOCKED (–∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è, –±–∞–ª–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è)
‚îú‚îÄ DELETED (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –±–∞–ª–ª—ã –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è)
‚îî‚îÄ –ù–µ—Ç FROZEN –∏ INACTIVE —Å—Ç–∞—Ç—É—Å–æ–≤

‚úÖ QR + 6-DIGIT CODES:
‚îú‚îÄ –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–Ω–µ —Å—Ä–∞–∑—É, –∞ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è)
‚îú‚îÄ –°—Ç–∞—Ä—ã–µ –∫–æ–¥—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è invalid
‚îú‚îÄ –ù–µ —Ö—Ä–∞–Ω—è—Ç—Å—è, –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
‚îî‚îÄ –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ

‚úÖ PHONE NUMBER CHANGE:
‚îú‚îÄ –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞
‚îú‚îÄ –ë–∞–ª–ª—ã –∏ —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è
‚îú‚îÄ –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
‚îî‚îÄ –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ email –µ—Å–ª–∏ –∑–∞–±—ã–ª –Ω–æ–º–µ—Ä

‚úÖ CHILDREN:
‚îú‚îÄ –ú–∞–∫—Å–∏–º—É–º 3 —Ä–µ–±–µ–Ω–∫–∞
‚îú‚îÄ –ë–∞–ª–ª—ã –Ω–∞ –¥–µ—Ç–µ–π –∏–¥—É—Ç –Ω–∞ –∫–∞—Ä—Ç—É —Ä–æ–¥–∏—Ç–µ–ª—è
‚îú‚îÄ –ù–µ –º–æ–≥—É—Ç –æ—Ç–¥–µ–ª–∏—Ç—å—Å—è
‚îî‚îÄ –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å

‚úÖ POS INTEGRATION:
‚îú‚îÄ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ –≤ –ü–û–° (iiko/R-Keeper)
‚îú‚îÄ –ü–û–° –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç—è + –±–∞–ª–ª—ã
‚îú‚îÄ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
‚îî‚îÄ –ü–µ—á–∞—Ç—å —á–µ–∫–∞ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —é—Ä.–ª–∏—Ü–∞–º

‚úÖ REGISTRATION SOURCES:
‚îú‚îÄ POS (–∫–∞—Å—Å–∏—Ä –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ)
‚îú‚îÄ Link (–æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤—Å–µ—Ö, –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
‚îú‚îÄ Telegram (—á–µ—Ä–µ–∑ –±–æ—Ç + –º–∏–Ω–∏-–∞–ø–ø)
‚îî‚îÄ –í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

‚úÖ SEGMENTATION:
‚îú‚îÄ –õ—é–±—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–ø–æ —Å—É–º–º–µ, –¥–Ω—é –Ω–µ–¥–µ–ª–∏, –≤—Ä–µ–º–µ–Ω–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–ª—é–¥, –∏—Å—Ç–æ—Ä–∏–∏)
‚îú‚îÄ –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º–æ–µ –≤—ã–≥–æ–¥–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –≥–æ—Å—Ç—è
‚îú‚îÄ Admin –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥–æ—Å—Ç—è
‚îî‚îÄ –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª

‚úÖ TARIFF LIMITS:
‚îú‚îÄ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã (2000 –≥–æ—Å—Ç–µ–π –Ω–∞ –í–°–Æ —Å–µ—Ç—å, –Ω–µ –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω)
‚îú‚îÄ –°—á–∏—Ç–∞—é—Ç—Å—è –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –∫–∞—Ä—Ç–∞–º
‚îú‚îÄ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Admin –∫–æ–≥–¥–∞ –ª–∏–º–∏—Ç –±–ª–∏–∑–æ–∫
‚îî‚îÄ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏

‚úÖ BALL TRANSFER:
‚îú‚îÄ –ú–æ–∂–Ω–æ –¥–∞—Ä–∏—Ç—å –±–∞–ª–ª—ã –¥—Ä—É–≥–∏–º –≥–æ—Å—Ç—è–º
‚îú‚îÄ –¢—Ä–µ–±—É–µ—Ç—Å—è SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ –§—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞ Admin
‚îî‚îÄ –í—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

‚úÖ GDPR COMPLIANCE:
‚îú‚îÄ –ì–æ—Å—Ç—å –º–æ–∂–µ—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ –î–∞–Ω–Ω—ã–µ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ API)
‚îî‚îÄ Admin –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
```


***

## üóÑÔ∏è DATABASE SCHEMA - ENTITIES

–°–æ–∑–¥–∞—é –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –¥–ª—è –≥–æ—Å—Ç–µ–π –∏ –∫–∞—Ä—Ç –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:

```prisma
// ============================================
// GUEST & LOYALTY CARD ENTITIES
// ============================================

// –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–∑ Auth –±–ª–æ–∫–∞)
model User {
  id                String    @id @default(uuid())
  email             String?   @unique
  phone             String    @unique // –û—Å–Ω–æ–≤–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
  telegram_id       String?   @unique
  password_hash     String?   // –ú–æ–∂–µ—Ç –±—ã—Ç—å NULL –¥–ª—è –≥–æ—Å—Ç–µ–π
  role              UserRole  @default(GUEST)
  email_verified    Boolean   @default(false)
  phone_verified    Boolean   @default(false)
  is_blocked        Boolean   @default(false)
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  deleted_at        DateTime? // –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
  
  // –°–≤—è–∑–∏
  guest_profile     GuestProfile?
  guest_cards       GuestCard[]
  user_roles        UserRole[]
  sessions          UserSession[]
  activity_logs     ActivityLog[]
  
  @@index([phone])
  @@index([email])
  @@index([telegram_id])
  @@index([deleted_at])
}

// –ü—Ä–æ—Ñ–∏–ª—å –≥–æ—Å—Ç—è (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
model GuestProfile {
  id                       String    @id @default(uuid())
  user_id                  String    @unique
  user                     User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
  first_name               String
  
  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  last_name                String?
  middle_name              String?
  gender                   Gender?   // MALE, FEMALE, OTHER
  birth_date               DateTime?
  avatar_url               String?   // –§–æ—Ç–æ –∏–∑ Telegram –∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ
  
  // –°–æ–≥–ª–∞—Å–∏—è
  privacy_policy_accepted  Boolean   @default(false)
  marketing_accepted       Boolean   @default(false) // –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É
  
  // –ê–¥—Ä–µ—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  city                     String?
  address                  String?
  
  // Telegram –¥–∞–Ω–Ω—ã–µ
  telegram_username        String?
  telegram_photo_url       String?
  
  // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞)
  last_profile_update      DateTime  @default(now())
  
  // –î–µ—Ç–∏
  children                 GuestChild[]
  
  created_at               DateTime  @default(now())
  updated_at               DateTime  @updatedAt
  
  @@index([user_id])
  @@index([birth_date])
}

// –î–µ—Ç–∏ –≥–æ—Å—Ç—è (–¥–ª—è –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–π –Ω–∞ –î–†)
model GuestChild {
  id              String       @id @default(uuid())
  guest_profile_id String
  guest_profile   GuestProfile @relation(fields: [guest_profile_id], references: [id], onDelete: Cascade)
  
  name            String       // –ò–º—è —Ä–µ–±–µ–Ω–∫–∞
  birth_date      DateTime     // –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
  
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt
  deleted_at      DateTime?    // –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
  
  @@index([guest_profile_id])
  @@index([birth_date])
  @@index([deleted_at])
}

// –ö–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –≥–æ—Å—Ç—è
model GuestCard {
  id                    String          @id @default(uuid())
  
  // –°–≤—è–∑—å —Å –≥–æ—Å—Ç–µ–º
  user_id               String
  user                  User            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  // –°–≤—è–∑—å —Å —Ç–µ–Ω–∞–Ω—Ç–æ–º/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º
  tenant_id             String
  tenant                Tenant          @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  
  restaurant_id         String?         // –ï—Å–ª–∏ SEPARATE mode - –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ä–µ—Å—Ç–æ—Ä–∞–Ω—É
  restaurant            Restaurant?     @relation(fields: [restaurant_id], references: [id], onDelete: SetNull)
  
  // –ö–æ–¥—ã (–Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å—Ç–∞—Ä—ã–µ, —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ)
  qr_code               String          @unique // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π QR –∫–æ–¥
  code_6_digit          String          @unique // 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
  
  // –ë–∞–ª–ª—ã –∏ —É—Ä–æ–≤–µ–Ω—å
  balance               Int             @default(0) // –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤
  lifetime_spent        Decimal         @default(0) @db.Decimal(10, 2) // –í—Å—è —Å—É–º–º–∞ —á–µ–∫–æ–≤ (–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è)
  total_visits          Int             @default(0) // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–µ—â–µ–Ω–∏–π
  
  // –£—Ä–æ–≤–µ–Ω—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
  loyalty_level_id      String?
  loyalty_level         LoyaltyLevel?   @relation(fields: [loyalty_level_id], references: [id], onDelete: SetNull)
  
  // –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç—ã
  status                CardStatus      @default(ACTIVE) // ACTIVE, BLOCKED, DELETED
  block_reason          String?         // –ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  blocked_by_user_id    String?         // –ö—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª
  blocked_at            DateTime?
  
  // –ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ
  last_visit_at         DateTime?
  
  // –ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  registration_source   RegistrationSource // POS, LINK, TELEGRAM
  registration_link_id  String?         // ID —Å—Å—ã–ª–∫–∏ –µ—Å–ª–∏ —á–µ—Ä–µ–∑ LINK
  registration_link     RegistrationLink? @relation(fields: [registration_link_id], references: [id], onDelete: SetNull)
  
  // –°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤
  last_activity_at      DateTime        @default(now()) // –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –æ—Ç—Å—á–µ—Ç–∞ —Å–≥–æ—Ä–∞–Ω–∏—è
  balls_expire_at       DateTime?       // –ö–æ–≥–¥–∞ —Å–≥–æ—Ä—è—Ç –±–∞–ª–ª—ã
  
  created_at            DateTime        @default(now())
  updated_at            DateTime        @updatedAt
  deleted_at            DateTime?       // –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
  
  // –°–≤—è–∑–∏
  ball_transactions     BallTransaction[]
  guest_visits          GuestVisit[]
  promo_grants          PromoBallGranted[]
  ball_transfers_sent   BallTransfer[]  @relation("BallTransferSender")
  ball_transfers_received BallTransfer[] @relation("BallTransferReceiver")
  
  @@unique([user_id, tenant_id, restaurant_id]) // –û–¥–∏–Ω –≥–æ—Å—Ç—å = –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç/—Ä–µ—Å—Ç–æ—Ä–∞–Ω
  @@index([tenant_id])
  @@index([restaurant_id])
  @@index([qr_code])
  @@index([code_6_digit])
  @@index([status])
  @@index([last_visit_at])
  @@index([deleted_at])
}

// –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏ (–∏—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –∏ —Å–ø–∏—Å–∞–Ω–∏–π)
model BallTransaction {
  id                String              @id @default(uuid())
  
  // –°–≤—è–∑—å —Å –∫–∞—Ä—Ç–æ–π
  guest_card_id     String
  guest_card        GuestCard           @relation(fields: [guest_card_id], references: [id], onDelete: Cascade)
  
  // –°–≤—è–∑—å —Å —Ç–µ–Ω–∞–Ω—Ç–æ–º
  tenant_id         String
  tenant            Tenant              @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  
  restaurant_id     String?
  restaurant        Restaurant?         @relation(fields: [restaurant_id], references: [id], onDelete: SetNull)
  
  // –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
  type              BallTransactionType // EARN, REDEEM, MANUAL_ADD, MANUAL_SUBTRACT, PROMO, EXPIRE, TRANSFER_SENT, TRANSFER_RECEIVED
  
  // –°—É–º–º–∞
  amount            Int                 // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ (+/-)
  balance_before    Int                 // –ë–∞–ª–∞–Ω—Å –¥–æ –æ–ø–µ—Ä–∞—Ü–∏–∏
  balance_after     Int                 // –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  
  // –î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
  description       String              // –û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  reason            String?             // –ü—Ä–∏—á–∏–Ω–∞ (–¥–ª—è —Ä—É—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞)
  
  // –°–≤—è–∑—å —Å —á–µ–∫–æ–º (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ –ü–û–°)
  check_amount      Decimal?            @db.Decimal(10, 2) // –°—É–º–º–∞ —á–µ–∫–∞
  pos_transaction_id String?            // ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –ü–û–°
  pos_transaction   POSTransaction?     @relation(fields: [pos_transaction_id], references: [id], onDelete: SetNull)
  
  // –°–≤—è–∑—å —Å –ø—Ä–æ–º–æ-–∞–∫—Ü–∏–µ–π
  promo_id          String?
  promo             LoyaltyPromo?       @relation(fields: [promo_id], references: [id], onDelete: SetNull)
  
  // –ö—Ç–æ —Å–æ–≤–µ—Ä—à–∏–ª –æ–ø–µ—Ä–∞—Ü–∏—é
  created_by_user_id String?            // NULL –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  created_by        User?               @relation(fields: [created_by_user_id], references: [id], onDelete: SetNull)
  
  // –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
  is_cancelled      Boolean             @default(false)
  cancelled_at      DateTime?
  cancelled_by_user_id String?
  cancellation_reason String?
  
  created_at        DateTime            @default(now())
  
  @@index([guest_card_id])
  @@index([tenant_id])
  @@index([restaurant_id])
  @@index([type])
  @@index([created_at])
  @@index([pos_transaction_id])
}

// –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π –≥–æ—Å—Ç—è
model GuestVisit {
  id                String       @id @default(uuid())
  
  // –°–≤—è–∑—å —Å –∫–∞—Ä—Ç–æ–π
  guest_card_id     String
  guest_card        GuestCard    @relation(fields: [guest_card_id], references: [id], onDelete: Cascade)
  
  // –°–≤—è–∑—å —Å —Ç–µ–Ω–∞–Ω—Ç–æ–º/—Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º
  tenant_id         String
  tenant            Tenant       @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  
  restaurant_id     String
  restaurant        Restaurant   @relation(fields: [restaurant_id], references: [id], onDelete: Cascade)
  
  // –î–µ—Ç–∞–ª–∏ –ø–æ—Å–µ—â–µ–Ω–∏—è
  visit_date        DateTime     @default(now())
  check_amount      Decimal      @db.Decimal(10, 2) // –°—É–º–º–∞ —á–µ–∫–∞
  
  // –î–µ—Ç–∞–ª–∏ —á–µ–∫–∞ (–∏–∑ –ü–û–°)
  items_ordered     Json?        // –ß—Ç–æ –∑–∞–∫–∞–∑–∞–ª (–∏–∑ –ü–û–° —Å–∏—Å—Ç–µ–º—ã)
  payment_method    String?      // –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–Ω–∞–ª–∏—á–Ω—ã–µ, –∫–∞—Ä—Ç–∞)
  
  // –ö–∞—Å—Å–∏—Ä
  cashier_user_id   String?
  cashier           User?        @relation(fields: [cashier_user_id], references: [id], onDelete: SetNull)
  
  // –°–≤—è–∑—å —Å –ü–û–°
  pos_transaction_id String?     @unique
  pos_transaction   POSTransaction? @relation(fields: [pos_transaction_id], references: [id], onDelete: SetNull)
  
  created_at        DateTime     @default(now())
  
  @@index([guest_card_id])
  @@index([tenant_id])
  @@index([restaurant_id])
  @@index([visit_date])
}

// –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤ –º–µ–∂–¥—É –≥–æ—Å—Ç—è–º–∏
model BallTransfer {
  id                  String    @id @default(uuid())
  
  // –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
  sender_card_id      String
  sender_card         GuestCard @relation("BallTransferSender", fields: [sender_card_id], references: [id], onDelete: Cascade)
  
  // –ü–æ–ª—É—á–∞—Ç–µ–ª—å
  receiver_card_id    String
  receiver_card       GuestCard @relation("BallTransferReceiver", fields: [receiver_card_id], references: [id], onDelete: Cascade)
  
  // –°—É–º–º–∞
  amount              Int       // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤
  
  // SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
  verification_code   String?   // –ö–æ–¥ –∏–∑ SMS
  is_verified         Boolean   @default(false)
  verified_at         DateTime?
  
  // –°—Ç–∞—Ç—É—Å
  status              TransferStatus @default(PENDING) // PENDING, VERIFIED, COMPLETED, CANCELLED
  
  tenant_id           String
  tenant              Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  
  created_at          DateTime  @default(now())
  completed_at        DateTime?
  
  @@index([sender_card_id])
  @@index([receiver_card_id])
  @@index([tenant_id])
  @@index([status])
}

// –°—Å—ã–ª–∫–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–ø–æ —Å—Å—ã–ª–∫–µ)
model RegistrationLink {
  id                String      @id @default(uuid())
  
  tenant_id         String
  tenant            Tenant      @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  
  restaurant_id     String?     // –ï—Å–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
  restaurant        Restaurant? @relation(fields: [restaurant_id], references: [id], onDelete: SetNull)
  
  // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
  token             String      @unique // xyz789
  
  // URL (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
  url               String      // https://loyalty.max.ru/register?restaurant_id=123&token=xyz789
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  total_uses        Int         @default(0) // –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏
  
  // –ö—Ç–æ —Å–æ–∑–¥–∞–ª
  created_by_user_id String
  created_by        User        @relation(fields: [created_by_user_id], references: [id], onDelete: Cascade)
  
  is_active         Boolean     @default(true) // –ú–æ–∂–Ω–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
  
  created_at        DateTime    @default(now())
  updated_at        DateTime    @updatedAt
  
  // –°–≤—è–∑–∏
  guest_cards       GuestCard[]
  
  @@index([tenant_id])
  @@index([restaurant_id])
  @@index([token])
  @@index([is_active])
}

// ============================================
// ENUMS
// ============================================

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum CardStatus {
  ACTIVE
  BLOCKED
  DELETED
}

enum RegistrationSource {
  POS      // –ß–µ—Ä–µ–∑ –∫–∞—Å—Å–∏—Ä–∞ –≤ –ü–û–°
  LINK     // –ü–æ —Å—Å—ã–ª–∫–µ
  TELEGRAM // –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç
}

enum BallTransactionType {
  EARN               // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ (–æ—Ç —á–µ–∫–∞)
  REDEEM             // –°–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞ —á–µ–∫)
  MANUAL_ADD         // –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
  MANUAL_SUBTRACT    // –†—É—á–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ
  PROMO              // –ü—Ä–æ–º–æ-–∞–∫—Ü–∏—è
  EXPIRE             // –°–≥–æ—Ä–∞–Ω–∏–µ
  TRANSFER_SENT      // –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–ª–ª–æ–≤ –¥—Ä—É–≥–æ–º—É –≥–æ—Å—Ç—é
  TRANSFER_RECEIVED  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –≥–æ—Å—Ç—è
}

enum TransferStatus {
  PENDING    // –û–∂–∏–¥–∞–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ SMS
  VERIFIED   // –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ
  COMPLETED  // –ó–∞–≤–µ—Ä—à–µ–Ω–æ
  CANCELLED  // –û—Ç–º–µ–Ω–µ–Ω–æ
}
```


***

## üéØ DTOs (Data Transfer Objects)

```typescript
// ============================================
// GUEST DTOs
// ============================================

import { IsString, IsEmail, IsOptional, IsBoolean, IsEnum, IsDateString, IsPhoneNumber, MaxLength, MinLength } from 'class-validator';

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Å—Ç—è (–æ–±—â–∏–π DTO)
export class CreateGuestDto {
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  first_name: string;

  @IsOptional()
  @IsString()
  @MaxLength(50)
  last_name?: string;

  @IsPhoneNumber('RU') // –ò–ª–∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
  phone: string;

  @IsOptional()
  @IsDateString()
  birth_date?: string;

  @IsOptional()
  @IsEmail()
  email?: string;

  @IsOptional()
  @IsEnum(Gender)
  gender?: Gender;

  @IsBoolean()
  privacy_policy_accepted: boolean; // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

  @IsOptional()
  @IsBoolean()
  marketing_accepted?: boolean; // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

  @IsOptional()
  @IsString()
  city?: string;

  @IsOptional()
  @IsString()
  address?: string;

  // Telegram –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram)
  @IsOptional()
  @IsString()
  telegram_id?: string;

  @IsOptional()
  @IsString()
  telegram_username?: string;

  @IsOptional()
  @IsString()
  telegram_photo_url?: string;

  // –ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  @IsEnum(RegistrationSource)
  registration_source: RegistrationSource;

  @IsOptional()
  @IsString()
  registration_link_id?: string; // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ LINK

  // Tenant –∏ Restaurant
  @IsString()
  tenant_id: string;

  @IsOptional()
  @IsString()
  restaurant_id?: string; // –ï—Å–ª–∏ SEPARATE mode
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≥–æ—Å—Ç—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞)
export class UpdateGuestProfileDto {
  @IsOptional()
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  first_name?: string;

  @IsOptional()
  @IsString()
  @MaxLength(50)
  last_name?: string;

  @IsOptional()
  @IsDateString()
  birth_date?: string;

  @IsOptional()
  @IsEmail()
  email?: string;

  @IsOptional()
  @IsEnum(Gender)
  gender?: Gender;

  @IsOptional()
  @IsBoolean()
  marketing_accepted?: boolean;

  @IsOptional()
  @IsString()
  city?: string;

  @IsOptional()
  @IsString()
  address?: string;
}

// –°–º–µ–Ω–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ç—Ä–µ–±—É–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏)
export class ChangePhoneDto {
  @IsPhoneNumber('RU')
  new_phone: string;

  @IsString()
  @MinLength(6)
  @MaxLength(6)
  verification_code: string; // –ö–æ–¥ –∏–∑ SMS
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞
export class AddChildDto {
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  name: string;

  @IsDateString()
  birth_date: string;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞
export class UpdateChildDto {
  @IsOptional()
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  name?: string;

  @IsOptional()
  @IsDateString()
  birth_date?: string;
}

// ============================================
// LOYALTY CARD DTOs
// ============================================

// –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤
export class ManualBallOperationDto {
  @IsString()
  guest_card_id: string;

  @IsInt()
  @Min(1)
  amount: number; // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ (—Å–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —Ç–∏–ø—É)

  @IsEnum(BallTransactionType)
  type: BallTransactionType.MANUAL_ADD | BallTransactionType.MANUAL_SUBTRACT;

  @IsString()
  @MinLength(5)
  @MaxLength(500)
  reason: string; // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞

  @IsOptional()
  @IsString()
  description?: string;
}

// –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏
export class CancelBallTransactionDto {
  @IsString()
  transaction_id: string;

  @IsString()
  @MinLength(5)
  @MaxLength(500)
  cancellation_reason: string;
}

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã
export class BlockGuestCardDto {
  @IsString()
  guest_card_id: string;

  @IsString()
  @MinLength(5)
  @MaxLength(500)
  block_reason: string;
}

// –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã
export class UnblockGuestCardDto {
  @IsString()
  guest_card_id: string;
}

// –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤ –¥—Ä—É–≥–æ–º—É –≥–æ—Å—Ç—é
export class TransferBallsDto {
  @IsString()
  sender_card_id: string;

  @IsString()
  receiver_card_id: string;

  @IsInt()
  @Min(1)
  amount: number;
}

// –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –±–∞–ª–ª–æ–≤
export class VerifyBallTransferDto {
  @IsString()
  transfer_id: string;

  @IsString()
  @MinLength(6)
  @MaxLength(6)
  verification_code: string; // –ö–æ–¥ –∏–∑ SMS
}

// ============================================
// QUERY DTOs (–¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
// ============================================

export class GetGuestsQueryDto {
  @IsOptional()
  @IsString()
  tenant_id?: string;

  @IsOptional()
  @IsString()
  restaurant_id?: string;

  @IsOptional()
  @IsEnum(CardStatus)
  status?: CardStatus;

  @IsOptional()
  @IsString()
  search?: string; // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É, email

  @IsOptional()
  @IsInt()
  @Min(1)
  page?: number;

  @IsOptional()
  @IsInt()
  @Min(1)
  @Max(100)
  limit?: number;

  @IsOptional()
  @IsString()
  sort_by?: string; // 'created_at', 'lifetime_spent', 'balance', 'last_visit_at'

  @IsOptional()
  @IsEnum(['asc', 'desc'])
  sort_order?: 'asc' | 'desc';
}
```


***

–°–µ–π—á–∞—Å —Å–æ–∑–¥–∞–º **Services** —Å –ø–æ–ª–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π! –ü—Ä–æ–¥–æ–ª–∂–∞—é? üöÄ

---

# –ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è —Ç—ã –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª —Å–æ–∑–¥–∞–Ω–∏–µ DTOs, –µ—Å–ª–∏ —è –ø—Ä–∞–≤ - –ø—Ä–æ–¥—É–±–ª–∏—Ä—É–π –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –µ—Å–ª–∏ –∑–∞–∫–æ–Ω—á–∏–ª - –ø—Ä–æ–¥–æ–ª–∂–∞–π

–¢—ã –ø—Ä–∞–≤! üëç –Ø –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª DTOs. –í–æ—Ç **–ü–û–õ–ù–ê–Ø –≤–µ—Ä—Å–∏—è** –≤—Å–µ—Ö DTOs –¥–ª—è –º–æ–¥—É–ª—è Guests \& Loyalty Cards:

***

## üéØ –ü–û–õ–ù–´–ï DTOs (Data Transfer Objects)

```typescript
// ============================================
// apps/backend/src/modules/guests/dto/
// ============================================

import {
  IsString,
  IsEmail,
  IsOptional,
  IsBoolean,
  IsEnum,
  IsDateString,
  IsPhoneNumber,
  MaxLength,
  MinLength,
  IsInt,
  Min,
  Max,
  IsUUID,
  IsNumber,
  IsArray,
  ValidateNested,
} from 'class-validator';
import { Type } from 'class-transformer';
import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';

// ============================================
// ENUMS (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ DTOs)
// ============================================

export enum Gender {
  MALE = 'MALE',
  FEMALE = 'FEMALE',
  OTHER = 'OTHER',
}

export enum CardStatus {
  ACTIVE = 'ACTIVE',
  BLOCKED = 'BLOCKED',
  DELETED = 'DELETED',
}

export enum RegistrationSource {
  POS = 'POS',
  LINK = 'LINK',
  TELEGRAM = 'TELEGRAM',
}

export enum BallTransactionType {
  EARN = 'EARN',
  REDEEM = 'REDEEM',
  MANUAL_ADD = 'MANUAL_ADD',
  MANUAL_SUBTRACT = 'MANUAL_SUBTRACT',
  PROMO = 'PROMO',
  EXPIRE = 'EXPIRE',
  TRANSFER_SENT = 'TRANSFER_SENT',
  TRANSFER_RECEIVED = 'TRANSFER_RECEIVED',
}

export enum TransferStatus {
  PENDING = 'PENDING',
  VERIFIED = 'VERIFIED',
  COMPLETED = 'COMPLETED',
  CANCELLED = 'CANCELLED',
}

// ============================================
// GUEST REGISTRATION DTOs
// ============================================

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Å—Ç—è (–æ–±—â–∏–π DTO –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)
export class CreateGuestDto {
  @ApiProperty({ description: '–ò–º—è –≥–æ—Å—Ç—è', example: '–ò–≤–∞–Ω' })
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  first_name: string;

  @ApiPropertyOptional({ description: '–§–∞–º–∏–ª–∏—è –≥–æ—Å—Ç—è', example: '–ò–≤–∞–Ω–æ–≤' })
  @IsOptional()
  @IsString()
  @MaxLength(50)
  last_name?: string;

  @ApiPropertyOptional({ description: '–û—Ç—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç—è', example: '–ò–≤–∞–Ω–æ–≤–∏—á' })
  @IsOptional()
  @IsString()
  @MaxLength(50)
  middle_name?: string;

  @ApiProperty({ description: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', example: '+79991234567' })
  @IsPhoneNumber('RU')
  phone: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', example: '1990-01-15' })
  @IsOptional()
  @IsDateString()
  birth_date?: string;

  @ApiPropertyOptional({ description: 'Email', example: 'ivan@example.com' })
  @IsOptional()
  @IsEmail()
  email?: string;

  @ApiPropertyOptional({ description: '–ü–æ–ª', enum: Gender })
  @IsOptional()
  @IsEnum(Gender)
  gender?: Gender;

  @ApiProperty({ description: '–°–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏' })
  @IsBoolean()
  privacy_policy_accepted: boolean;

  @ApiPropertyOptional({ description: '–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É' })
  @IsOptional()
  @IsBoolean()
  marketing_accepted?: boolean;

  @ApiPropertyOptional({ description: '–ì–æ—Ä–æ–¥', example: '–ú–æ—Å–∫–≤–∞' })
  @IsOptional()
  @IsString()
  city?: string;

  @ApiPropertyOptional({ description: '–ê–¥—Ä–µ—Å', example: '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1' })
  @IsOptional()
  @IsString()
  address?: string;

  @ApiPropertyOptional({ description: 'Telegram ID' })
  @IsOptional()
  @IsString()
  telegram_id?: string;

  @ApiPropertyOptional({ description: 'Telegram username' })
  @IsOptional()
  @IsString()
  telegram_username?: string;

  @ApiPropertyOptional({ description: 'Telegram —Ñ–æ—Ç–æ URL' })
  @IsOptional()
  @IsString()
  telegram_photo_url?: string;

  @ApiProperty({ description: '–ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', enum: RegistrationSource })
  @IsEnum(RegistrationSource)
  registration_source: RegistrationSource;

  @ApiPropertyOptional({ description: 'ID —Å—Å—ã–ª–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ —á–µ—Ä–µ–∑ LINK)' })
  @IsOptional()
  @IsUUID()
  registration_link_id?: string;

  @ApiProperty({ description: 'ID —Ç–µ–Ω–∞–Ω—Ç–∞ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏)' })
  @IsUUID()
  tenant_id: string;

  @ApiPropertyOptional({ description: 'ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–µ—Å–ª–∏ SEPARATE mode)' })
  @IsOptional()
  @IsUUID()
  restaurant_id?: string;
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ü–û–° (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –∫–∞—Å—Å–∏—Ä–∞)
export class CreateGuestPOSDto {
  @ApiProperty({ description: '–ò–º—è –≥–æ—Å—Ç—è', example: '–ò–≤–∞–Ω' })
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  first_name: string;

  @ApiProperty({ description: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', example: '+79991234567' })
  @IsPhoneNumber('RU')
  phone: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', example: '1990-01-15' })
  @IsOptional()
  @IsDateString()
  birth_date?: string;

  @ApiProperty({ description: 'ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–∏–∑ –ü–û–°)' })
  @IsUUID()
  restaurant_id: string;

  // Tenant ID –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (JWT token)
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ
export class CreateGuestLinkDto {
  @ApiProperty({ description: '–ò–º—è –≥–æ—Å—Ç—è', example: '–ò–≤–∞–Ω' })
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  first_name: string;

  @ApiProperty({ description: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', example: '+79991234567' })
  @IsPhoneNumber('RU')
  phone: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', example: '1990-01-15' })
  @IsOptional()
  @IsDateString()
  birth_date?: string;

  @ApiPropertyOptional({ description: 'Email', example: 'ivan@example.com' })
  @IsOptional()
  @IsEmail()
  email?: string;

  @ApiProperty({ description: '–°–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏' })
  @IsBoolean()
  privacy_policy_accepted: boolean;

  @ApiPropertyOptional({ description: '–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É' })
  @IsOptional()
  @IsBoolean()
  marketing_accepted?: boolean;

  @ApiProperty({ description: '–¢–æ–∫–µ–Ω —Å—Å—ã–ª–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏' })
  @IsString()
  registration_token: string;
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
export class CreateGuestTelegramDto {
  @ApiProperty({ description: 'Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' })
  @IsString()
  telegram_id: string;

  @ApiPropertyOptional({ description: '–ò–º—è –∏–∑ Telegram' })
  @IsOptional()
  @IsString()
  first_name?: string;

  @ApiPropertyOptional({ description: 'Username –∏–∑ Telegram' })
  @IsOptional()
  @IsString()
  telegram_username?: string;

  @ApiPropertyOptional({ description: '–§–æ—Ç–æ –∏–∑ Telegram' })
  @IsOptional()
  @IsString()
  telegram_photo_url?: string;

  @ApiProperty({ description: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–µ—Å–ª–∏ –Ω–µ –∏–∑ Telegram, –Ω—É–∂–µ–Ω –≤—Ä—É—á–Ω—É—é)' })
  @IsPhoneNumber('RU')
  phone: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', example: '1990-01-15' })
  @IsOptional()
  @IsDateString()
  birth_date?: string;

  @ApiProperty({ description: '–°–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏' })
  @IsBoolean()
  privacy_policy_accepted: boolean;

  @ApiPropertyOptional({ description: '–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É' })
  @IsOptional()
  @IsBoolean()
  marketing_accepted?: boolean;

  @ApiProperty({ description: 'ID —Ç–µ–Ω–∞–Ω—Ç–∞ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞/—Å–µ—Ç–∏)' })
  @IsUUID()
  tenant_id: string;

  @ApiPropertyOptional({ description: 'ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞' })
  @IsOptional()
  @IsUUID()
  restaurant_id?: string;
}

// ============================================
// GUEST PROFILE UPDATE DTOs
// ============================================

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≥–æ—Å—Ç—è (—Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞)
export class UpdateGuestProfileDto {
  @ApiPropertyOptional({ description: '–ò–º—è –≥–æ—Å—Ç—è' })
  @IsOptional()
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  first_name?: string;

  @ApiPropertyOptional({ description: '–§–∞–º–∏–ª–∏—è –≥–æ—Å—Ç—è' })
  @IsOptional()
  @IsString()
  @MaxLength(50)
  last_name?: string;

  @ApiPropertyOptional({ description: '–û—Ç—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç—è' })
  @IsOptional()
  @IsString()
  @MaxLength(50)
  middle_name?: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è' })
  @IsOptional()
  @IsDateString()
  birth_date?: string;

  @ApiPropertyOptional({ description: 'Email' })
  @IsOptional()
  @IsEmail()
  email?: string;

  @ApiPropertyOptional({ description: '–ü–æ–ª', enum: Gender })
  @IsOptional()
  @IsEnum(Gender)
  gender?: Gender;

  @ApiPropertyOptional({ description: '–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É' })
  @IsOptional()
  @IsBoolean()
  marketing_accepted?: boolean;

  @ApiPropertyOptional({ description: '–ì–æ—Ä–æ–¥' })
  @IsOptional()
  @IsString()
  city?: string;

  @ApiPropertyOptional({ description: '–ê–¥—Ä–µ—Å' })
  @IsOptional()
  @IsString()
  address?: string;
}

// –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–º–µ–Ω—É –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—à–∞–≥ 1 - –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS)
export class RequestPhoneChangeDto {
  @ApiProperty({ description: '–ù–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞' })
  @IsPhoneNumber('RU')
  new_phone: string;
}

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–º–µ–Ω—ã –Ω–æ–º–µ—Ä–∞ (—à–∞–≥ 2 - –≤–≤–æ–¥ –∫–æ–¥–∞)
export class ConfirmPhoneChangeDto {
  @ApiProperty({ description: '–ù–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞' })
  @IsPhoneNumber('RU')
  new_phone: string;

  @ApiProperty({ description: '–ö–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ SMS', example: '123456' })
  @IsString()
  @MinLength(6)
  @MaxLength(6)
  verification_code: string;
}

// ============================================
// CHILDREN DTOs
// ============================================

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞
export class AddChildDto {
  @ApiProperty({ description: '–ò–º—è —Ä–µ–±–µ–Ω–∫–∞', example: '–ê–Ω–Ω–∞' })
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  name: string;

  @ApiProperty({ description: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è —Ä–µ–±–µ–Ω–∫–∞', example: '2015-05-20' })
  @IsDateString()
  birth_date: string;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞
export class UpdateChildDto {
  @ApiPropertyOptional({ description: '–ò–º—è —Ä–µ–±–µ–Ω–∫–∞' })
  @IsOptional()
  @IsString()
  @MinLength(2)
  @MaxLength(50)
  name?: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è —Ä–µ–±–µ–Ω–∫–∞' })
  @IsOptional()
  @IsDateString()
  birth_date?: string;
}

// ============================================
// LOYALTY CARD DTOs
// ============================================

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ QR –∫–æ–¥—É
export class GetCardByQRDto {
  @ApiProperty({ description: 'QR –∫–æ–¥ –∫–∞—Ä—Ç—ã' })
  @IsString()
  qr_code: string;
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ 6-–∑–Ω–∞—á–Ω–æ–º—É –∫–æ–¥—É
export class GetCardBy6DigitDto {
  @ApiProperty({ description: '6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∫–∞—Ä—Ç—ã', example: '123456' })
  @IsString()
  @MinLength(6)
  @MaxLength(6)
  code_6_digit: string;
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
export class GetCardByPhoneDto {
  @ApiProperty({ description: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', example: '+79991234567' })
  @IsPhoneNumber('RU')
  phone: string;

  @ApiPropertyOptional({ description: 'ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∫–∞—Ä—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)' })
  @IsOptional()
  @IsUUID()
  restaurant_id?: string;
}

// ============================================
// BALL TRANSACTION DTOs
// ============================================

// –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—á–µ—Ä–µ–∑ –ü–û–° –∏–ª–∏ –≤—Ä—É—á–Ω—É—é)
export class EarnBallsDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è' })
  @IsUUID()
  guest_card_id: string;

  @ApiProperty({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è', example: 100 })
  @IsInt()
  @Min(1)
  amount: number;

  @ApiPropertyOptional({ description: '–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏' })
  @IsOptional()
  @IsString()
  description?: string;

  @ApiPropertyOptional({ description: 'ID –ü–û–° —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏' })
  @IsOptional()
  @IsString()
  pos_transaction_id?: string;

  @ApiPropertyOptional({ description: '–°—É–º–º–∞ —á–µ–∫–∞', example: 2000.50 })
  @IsOptional()
  @IsNumber()
  @Min(0)
  check_amount?: number;
}

// –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (–Ω–∞ —á–µ–∫)
export class RedeemBallsDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è' })
  @IsUUID()
  guest_card_id: string;

  @ApiProperty({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è', example: 100 })
  @IsInt()
  @Min(1)
  amount: number;

  @ApiPropertyOptional({ description: '–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏' })
  @IsOptional()
  @IsString()
  description?: string;

  @ApiPropertyOptional({ description: 'ID –ü–û–° —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏' })
  @IsOptional()
  @IsString()
  pos_transaction_id?: string;

  @ApiPropertyOptional({ description: '–°—É–º–º–∞ —á–µ–∫–∞', example: 2000.50 })
  @IsOptional()
  @IsNumber()
  @Min(0)
  check_amount?: number;
}

// –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—Ç–æ–ª—å–∫–æ Manager/Admin)
export class ManualAddBallsDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è' })
  @IsUUID()
  guest_card_id: string;

  @ApiProperty({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è', example: 500 })
  @IsInt()
  @Min(1)
  amount: number;

  @ApiProperty({ description: '–ü—Ä–∏—á–∏–Ω–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞)', example: '–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –∑–∞ –∂–∞–ª–æ–±—É' })
  @IsString()
  @MinLength(5)
  @MaxLength(500)
  reason: string;

  @ApiPropertyOptional({ description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ' })
  @IsOptional()
  @IsString()
  description?: string;
}

// –†—É—á–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—Ç–æ–ª—å–∫–æ Manager/Admin)
export class ManualSubtractBallsDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è' })
  @IsUUID()
  guest_card_id: string;

  @ApiProperty({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è', example: 200 })
  @IsInt()
  @Min(1)
  amount: number;

  @ApiProperty({ description: '–ü—Ä–∏—á–∏–Ω–∞ —Å–ø–∏—Å–∞–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞)', example: '–û—à–∏–±–æ—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ' })
  @IsString()
  @MinLength(5)
  @MaxLength(500)
  reason: string;

  @ApiPropertyOptional({ description: '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ' })
  @IsOptional()
  @IsString()
  description?: string;
}

// –û—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏
export class CancelBallTransactionDto {
  @ApiProperty({ description: 'ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã' })
  @IsUUID()
  transaction_id: string;

  @ApiProperty({ description: '–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã', example: '–û—à–∏–±–∫–∞ –∫–∞—Å—Å–∏—Ä–∞' })
  @IsString()
  @MinLength(5)
  @MaxLength(500)
  cancellation_reason: string;
}

// ============================================
// CARD MANAGEMENT DTOs
// ============================================

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã
export class BlockGuestCardDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏' })
  @IsUUID()
  guest_card_id: string;

  @ApiProperty({ description: '–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', example: '–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª' })
  @IsString()
  @MinLength(5)
  @MaxLength(500)
  block_reason: string;
}

// –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã
export class UnblockGuestCardDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏' })
  @IsUUID()
  guest_card_id: string;
}

// –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
export class DeleteGuestCardDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è' })
  @IsUUID()
  guest_card_id: string;

  @ApiPropertyOptional({ description: '–ü—Ä–∏—á–∏–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è' })
  @IsOptional()
  @IsString()
  deletion_reason?: string;
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã (–ø–æ—Å–ª–µ –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è)
export class RestoreGuestCardDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è' })
  @IsUUID()
  guest_card_id: string;
}

// ============================================
// BALL TRANSFER DTOs
// ============================================

// –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –±–∞–ª–ª–æ–≤ (—à–∞–≥ 1 - –∑–∞–ø—Ä–æ—Å)
export class InitiateBallTransferDto {
  @ApiProperty({ description: 'ID –∫–∞—Ä—Ç—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è' })
  @IsUUID()
  sender_card_id: string;

  @ApiProperty({ description: '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è', example: '+79991234567' })
  @IsPhoneNumber('RU')
  receiver_phone: string;

  @ApiProperty({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞', example: 1000 })
  @IsInt()
  @Min(1)
  amount: number;
}

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –±–∞–ª–ª–æ–≤ (—à–∞–≥ 2 - –≤–≤–æ–¥ SMS –∫–æ–¥–∞)
export class ConfirmBallTransferDto {
  @ApiProperty({ description: 'ID –ø–µ—Ä–µ–≤–æ–¥–∞' })
  @IsUUID()
  transfer_id: string;

  @ApiProperty({ description: '–ö–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ SMS', example: '123456' })
  @IsString()
  @MinLength(6)
  @MaxLength(6)
  verification_code: string;
}

// –û—Ç–º–µ–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –±–∞–ª–ª–æ–≤
export class CancelBallTransferDto {
  @ApiProperty({ description: 'ID –ø–µ—Ä–µ–≤–æ–¥–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã' })
  @IsUUID()
  transfer_id: string;
}

// ============================================
// REGISTRATION LINK DTOs
// ============================================

// –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
export class CreateRegistrationLinkDto {
  @ApiPropertyOptional({ description: 'ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–µ—Å–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞)' })
  @IsOptional()
  @IsUUID()
  restaurant_id?: string;

  // Tenant ID –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (JWT token)
}

// –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏
export class DeactivateRegistrationLinkDto {
  @ApiProperty({ description: 'ID —Å—Å—ã–ª–∫–∏ –¥–ª—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏' })
  @IsUUID()
  link_id: string;
}

// ============================================
// QUERY DTOs (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è)
// ============================================

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≥–æ—Å—Ç–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
export class GetGuestsQueryDto {
  @ApiPropertyOptional({ description: 'ID —Ç–µ–Ω–∞–Ω—Ç–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏' })
  @IsOptional()
  @IsUUID()
  tenant_id?: string;

  @ApiPropertyOptional({ description: 'ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏' })
  @IsOptional()
  @IsUUID()
  restaurant_id?: string;

  @ApiPropertyOptional({ description: '–°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç—ã', enum: CardStatus })
  @IsOptional()
  @IsEnum(CardStatus)
  status?: CardStatus;

  @ApiPropertyOptional({ description: '–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É, email', example: '–ò–≤–∞–Ω' })
  @IsOptional()
  @IsString()
  search?: string;

  @ApiPropertyOptional({ description: '–ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã', example: 1 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  page?: number = 1;

  @ApiPropertyOptional({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ', example: 20 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  @Max(100)
  limit?: number = 20;

  @ApiPropertyOptional({ description: '–ü–æ–ª–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏', example: 'created_at' })
  @IsOptional()
  @IsString()
  sort_by?: string = 'created_at';

  @ApiPropertyOptional({ description: '–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏', enum: ['asc', 'desc'] })
  @IsOptional()
  @IsEnum(['asc', 'desc'])
  sort_order?: 'asc' | 'desc' = 'desc';

  @ApiPropertyOptional({ description: '–§–∏–ª—å—Ç—Ä –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', enum: RegistrationSource })
  @IsOptional()
  @IsEnum(RegistrationSource)
  registration_source?: RegistrationSource;

  @ApiPropertyOptional({ description: '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤', example: 100 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(0)
  min_balance?: number;

  @ApiPropertyOptional({ description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤', example: 10000 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(0)
  max_balance?: number;

  @ApiPropertyOptional({ description: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Ç—Ä–∞—Ç (lifetime)', example: 5000 })
  @IsOptional()
  @Type(() => Number)
  @IsNumber()
  @Min(0)
  min_lifetime_spent?: number;

  @ApiPropertyOptional({ description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Ç—Ä–∞—Ç (lifetime)', example: 100000 })
  @IsOptional()
  @Type(() => Number)
  @IsNumber()
  @Min(0)
  max_lifetime_spent?: number;

  @ApiPropertyOptional({ description: 'ID —É—Ä–æ–≤–Ω—è –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏' })
  @IsOptional()
  @IsUUID()
  loyalty_level_id?: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è (–æ—Ç)', example: '2024-01-01' })
  @IsOptional()
  @IsDateString()
  last_visit_from?: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è (–¥–æ)', example: '2024-12-31' })
  @IsOptional()
  @IsDateString()
  last_visit_to?: string;
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –±–∞–ª–ª–∞–º–∏ (–∏—Å—Ç–æ—Ä–∏—è)
export class GetBallTransactionsQueryDto {
  @ApiPropertyOptional({ description: 'ID –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è' })
  @IsOptional()
  @IsUUID()
  guest_card_id?: string;

  @ApiPropertyOptional({ description: '–¢–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏', enum: BallTransactionType })
  @IsOptional()
  @IsEnum(BallTransactionType)
  type?: BallTransactionType;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ –æ—Ç', example: '2024-01-01' })
  @IsOptional()
  @IsDateString()
  date_from?: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ –¥–æ', example: '2024-12-31' })
  @IsOptional()
  @IsDateString()
  date_to?: string;

  @ApiPropertyOptional({ description: '–ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã', example: 1 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  page?: number = 1;

  @ApiPropertyOptional({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ', example: 50 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  @Max(100)
  limit?: number = 50;
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π
export class GetGuestVisitsQueryDto {
  @ApiPropertyOptional({ description: 'ID –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è' })
  @IsOptional()
  @IsUUID()
  guest_card_id?: string;

  @ApiPropertyOptional({ description: 'ID —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞' })
  @IsOptional()
  @IsUUID()
  restaurant_id?: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ –æ—Ç', example: '2024-01-01' })
  @IsOptional()
  @IsDateString()
  date_from?: string;

  @ApiPropertyOptional({ description: '–î–∞—Ç–∞ –¥–æ', example: '2024-12-31' })
  @IsOptional()
  @IsDateString()
  date_to?: string;

  @ApiPropertyOptional({ description: '–ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã', example: 1 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  page?: number = 1;

  @ApiPropertyOptional({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ', example: 30 })
  @IsOptional()
  @Type(() => Number)
  @IsInt()
  @Min(1)
  @Max(100)
  limit?: number = 30;
}

// ============================================
// RESPONSE DTOs (–¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤)
// ============================================

// –û—Ç–≤–µ—Ç —Å –∫–∞—Ä—Ç–æ–π –≥–æ—Å—Ç—è
export class GuestCardResponseDto {
  @ApiProperty()
  id: string;

  @ApiProperty()
  qr_code: string;

  @ApiProperty()
  code_6_digit: string;

  @ApiProperty()
  balance: number;

  @ApiProperty()
  lifetime_spent: number;

  @ApiProperty()
  total_visits: number;

  @ApiProperty({ enum: CardStatus })
  status: CardStatus;

  @ApiPropertyOptional()
  loyalty_level?: {
    id: string;
    name: string;
    earn_percentage: number;
  };

  @ApiPropertyOptional()
  last_visit_at?: Date;

  @ApiPropertyOptional()
  balls_expire_at?: Date;

  @ApiProperty()
  created_at: Date;
}

// –û—Ç–≤–µ—Ç —Å–æ —Å–ø–∏—Å–∫–æ–º –≥–æ—Å—Ç–µ–π (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
export class GuestsListResponseDto {
  @ApiProperty({ type: [GuestCardResponseDto] })
  data: GuestCardResponseDto[];

  @ApiProperty()
  total: number;

  @ApiProperty()
  page: number;

  @ApiProperty()
  limit: number;

  @ApiProperty()
  total_pages: number;
}

// –û—Ç–≤–µ—Ç —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –±–∞–ª–ª–æ–≤
export class BallTransactionResponseDto {
  @ApiProperty()
  id: string;

  @ApiProperty({ enum: BallTransactionType })
  type: BallTransactionType;

  @ApiProperty()
  amount: number;

  @ApiProperty()
  balance_before: number;

  @ApiProperty()
  balance_after: number;

  @ApiProperty()
  description: string;

  @ApiPropertyOptional()
  reason?: string;

  @ApiPropertyOptional()
  check_amount?: number;

  @ApiProperty()
  created_at: Date;

  @ApiPropertyOptional()
  created_by?: {
    id: string;
    name: string;
  };
}

// –û—Ç–≤–µ—Ç —Å –ø–æ—Å–µ—â–µ–Ω–∏–µ–º
export class GuestVisitResponseDto {
  @ApiProperty()
  id: string;

  @ApiProperty()
  visit_date: Date;

  @ApiProperty()
  check_amount: number;

  @ApiPropertyOptional()
  items_ordered?: any;

  @ApiPropertyOptional()
  payment_method?: string;

  @ApiProperty()
  restaurant: {
    id: string;
    name: string;
  };
}

// –û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
export class GuestRegistrationResponseDto {
  @ApiProperty()
  success: boolean;

  @ApiProperty()
  message: string;

  @ApiProperty()
  guest_card: GuestCardResponseDto;

  @ApiPropertyOptional()
  telegram_bot_link?: string; // –°—Å—ã–ª–∫–∞ –Ω–∞ Telegram –±–æ—Ç–∞ (–µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —á–µ—Ä–µ–∑ Telegram)
}
```


***

‚úÖ **–ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø DTOs –ì–û–¢–û–í–ê!**

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–¥–æ–ª–∂–∞—é —Å **Services** (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)? üöÄ

---

# –ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è —Ç—ã –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª —Å–æ–∑–¥–∞–Ω–∏–µ DTOs, –µ—Å–ª–∏ —è –ø—Ä–∞–≤ - –ø—Ä–æ–¥–æ–ª–∂–∏ —Å –º–µ—Å—Ç–∞ –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –µ—Å–ª–∏ –∑–∞–∫–æ–Ω—á–∏–ª - –ø—Ä–æ–¥–æ–ª–∂–∞–π

–¢—ã –ø—Ä–∞–≤! ‚úÖ DTOs **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–ö–û–ù–ß–ï–ù–´**.

–ü–æ—Å–ª–µ–¥–Ω–∏–π DTO –±—ã–ª `GuestRegistrationResponseDto` - —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ñ–∏–Ω–∞–ª –±–ª–æ–∫–∞ DTOs.

***

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–¥–æ–ª–∂–∞—é —Å **SERVICES** (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)! üöÄ

***

## üîß SERVICES - –ü–û–õ–ù–ê–Ø –ë–ò–ó–ù–ï–°-–õ–û–ì–ò–ö–ê

```typescript
// ============================================
// apps/backend/src/modules/guests/services/guest.service.ts
// ============================================

import { Injectable, BadRequestException, NotFoundException, ForbiddenException } from '@nestjs/common';
import { PrismaService } from '@/database/prisma.service';
import { ActivityLogService } from '@/modules/activity-log/activity-log.service';
import { LoyaltyService } from '@/modules/loyalty/loyalty.service';
import { NotificationService } from '@/modules/notifications/notification.service';
import { 
  CreateGuestDto, 
  CreateGuestPOSDto, 
  CreateGuestLinkDto, 
  CreateGuestTelegramDto,
  UpdateGuestProfileDto,
  RequestPhoneChangeDto,
  ConfirmPhoneChangeDto,
  AddChildDto,
  UpdateChildDto,
  GetGuestsQueryDto,
} from '../dto';
import { CardStatus, RegistrationSource } from '@prisma/client';
import * as crypto from 'crypto';

@Injectable()
export class GuestService {
  constructor(
    private prisma: PrismaService,
    private activityLogService: ActivityLogService,
    private loyaltyService: LoyaltyService,
    private notificationService: NotificationService,
  ) {}

  // ============================================
  // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ì–û–°–¢–Ø
  // ============================================

  /**
   * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Å—Ç—è
   */
  async createGuest(dto: CreateGuestDto, createdByUserId?: string) {
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã —Ç–∞—Ä–∏—Ñ–∞
    await this.checkGuestLimit(dto.tenant_id);

    // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    await this.checkPhoneDuplication(dto.phone, dto.tenant_id, dto.restaurant_id);

    // 3. –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
    return this.prisma.$transaction(async (tx) => {
      // 3.1 –°–æ–∑–¥–∞–µ–º User –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
      let user = await tx.user.findUnique({
        where: { phone: dto.phone },
      });

      if (!user) {
        user = await tx.user.create({
          data: {
            phone: dto.phone,
            email: dto.email,
            telegram_id: dto.telegram_id,
            role: 'GUEST',
            phone_verified: true, // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ –ü–û–° - —Å—á–∏—Ç–∞–µ–º –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º
          },
        });
      }

      // 3.2 –°–æ–∑–¥–∞–µ–º GuestProfile
      const guestProfile = await tx.guestProfile.upsert({
        where: { user_id: user.id },
        create: {
          user_id: user.id,
          first_name: dto.first_name,
          last_name: dto.last_name,
          middle_name: dto.middle_name,
          gender: dto.gender,
          birth_date: dto.birth_date ? new Date(dto.birth_date) : null,
          city: dto.city,
          address: dto.address,
          telegram_username: dto.telegram_username,
          telegram_photo_url: dto.telegram_photo_url,
          privacy_policy_accepted: dto.privacy_policy_accepted,
          marketing_accepted: dto.marketing_accepted || false,
        },
        update: {
          // –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å —É–∂–µ –µ—Å—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–µ–µ
          telegram_username: dto.telegram_username,
          telegram_photo_url: dto.telegram_photo_url,
        },
      });

      // 3.3 –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
      const loyaltySystem = await this.loyaltyService.getLoyaltySystemByTenant(
        dto.tenant_id,
        dto.restaurant_id,
        tx,
      );

      if (!loyaltySystem) {
        throw new BadRequestException('Loyalty system not configured for this restaurant');
      }

      // 3.4 –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (–ø–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–∑ —Å–∏—Å—Ç–µ–º—ã)
      const initialLevel = await tx.loyaltyLevel.findFirst({
        where: {
          loyalty_system_id: loyaltySystem.id,
        },
        orderBy: {
          threshold_amount: 'asc', // –°–∞–º—ã–π –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ = –Ω–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
        },
      });

      // 3.5 –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –∏ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
      const qrCode = this.generateQRCode();
      const code6Digit = this.generate6DigitCode();

      // 3.6 –í—ã—á–∏—Å–ª—è–µ–º –¥–∞—Ç—É —Å–≥–æ—Ä–∞–Ω–∏—è –±–∞–ª–ª–æ–≤ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã)
      const ballsExpireAt = this.calculateBallExpiration(loyaltySystem);

      // 3.7 –°–æ–∑–¥–∞–µ–º GuestCard
      const guestCard = await tx.guestCard.create({
        data: {
          user_id: user.id,
          tenant_id: dto.tenant_id,
          restaurant_id: dto.restaurant_id,
          qr_code: qrCode,
          code_6_digit: code6Digit,
          balance: 0,
          lifetime_spent: 0,
          total_visits: 0,
          loyalty_level_id: initialLevel?.id,
          status: CardStatus.ACTIVE,
          registration_source: dto.registration_source,
          registration_link_id: dto.registration_link_id,
          last_activity_at: new Date(),
          balls_expire_at: ballsExpireAt,
        },
        include: {
          loyalty_level: true,
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      // 3.8 –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ (–µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ)
      if (dto.registration_link_id) {
        await tx.registrationLink.update({
          where: { id: dto.registration_link_id },
          data: {
            total_uses: { increment: 1 },
          },
        });
      }

      // 3.9 –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Å—Ç—è
      await this.activityLogService.log({
        tenant_id: dto.tenant_id,
        user_id: createdByUserId || user.id,
        action_type: 'CREATE_GUEST',
        entity_type: 'GUEST_CARD',
        entity_id: guestCard.id,
        new_value: { guest_card_id: guestCard.id, phone: dto.phone },
        description: `Guest registered via ${dto.registration_source}`,
      }, tx);

      // 3.10 –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.notificationService.sendWelcomeNotification(user, guestCard, loyaltySystem);

      return guestCard;
    });
  }

  /**
   * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ü–û–° (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
   */
  async createGuestPOS(dto: CreateGuestPOSDto, tenantId: string, cashierUserId: string) {
    const createDto: CreateGuestDto = {
      first_name: dto.first_name,
      phone: dto.phone,
      birth_date: dto.birth_date,
      privacy_policy_accepted: true, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞–µ–º –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ü–û–°
      registration_source: RegistrationSource.POS,
      tenant_id: tenantId,
      restaurant_id: dto.restaurant_id,
    };

    return this.createGuest(createDto, cashierUserId);
  }

  /**
   * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ
   */
  async createGuestByLink(dto: CreateGuestLinkDto) {
    // 1. –ù–∞—Ö–æ–¥–∏–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Å—ã–ª–∫—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    const registrationLink = await this.prisma.registrationLink.findUnique({
      where: { token: dto.registration_token },
    });

    if (!registrationLink) {
      throw new NotFoundException('Registration link not found');
    }

    if (!registrationLink.is_active) {
      throw new BadRequestException('Registration link is inactive');
    }

    // 2. –°–æ–∑–¥–∞–µ–º –≥–æ—Å—Ç—è
    const createDto: CreateGuestDto = {
      first_name: dto.first_name,
      phone: dto.phone,
      birth_date: dto.birth_date,
      email: dto.email,
      privacy_policy_accepted: dto.privacy_policy_accepted,
      marketing_accepted: dto.marketing_accepted,
      registration_source: RegistrationSource.LINK,
      registration_link_id: registrationLink.id,
      tenant_id: registrationLink.tenant_id,
      restaurant_id: registrationLink.restaurant_id,
    };

    return this.createGuest(createDto);
  }

  /**
   * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
   */
  async createGuestTelegram(dto: CreateGuestTelegramDto) {
    const createDto: CreateGuestDto = {
      first_name: dto.first_name || 'Guest', // –ï—Å–ª–∏ –∏–º—è –Ω–µ –ø—Ä–∏—à–ª–æ –∏–∑ Telegram
      phone: dto.phone,
      birth_date: dto.birth_date,
      telegram_id: dto.telegram_id,
      telegram_username: dto.telegram_username,
      telegram_photo_url: dto.telegram_photo_url,
      privacy_policy_accepted: dto.privacy_policy_accepted,
      marketing_accepted: dto.marketing_accepted,
      registration_source: RegistrationSource.TELEGRAM,
      tenant_id: dto.tenant_id,
      restaurant_id: dto.restaurant_id,
    };

    return this.createGuest(createDto);
  }

  // ============================================
  // –ü–†–û–í–ï–†–ö–ò –ò –í–ê–õ–ò–î–ê–¶–ò–Ø
  // ============================================

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –≥–æ—Å—Ç–µ–π –ø–æ —Ç–∞—Ä–∏—Ñ—É
   */
  private async checkGuestLimit(tenantId: string) {
    const tenant = await this.prisma.tenant.findUnique({
      where: { id: tenantId },
      include: {
        subscription: true,
        tenant_limits: true,
      },
    });

    if (!tenant || !tenant.tenant_limits) {
      throw new NotFoundException('Tenant or limits not found');
    }

    const { max_guests } = tenant.tenant_limits;

    // –ï—Å–ª–∏ –±–µ–∑–ª–∏–º–∏—Ç (null –∏–ª–∏ -1)
    if (max_guests === null || max_guests === -1) {
      return;
    }

    // –°—á–∏—Ç–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç—ã
    const activeGuestsCount = await this.prisma.guestCard.count({
      where: {
        tenant_id: tenantId,
        status: CardStatus.ACTIVE,
        deleted_at: null,
      },
    });

    if (activeGuestsCount >= max_guests) {
      throw new ForbiddenException(`Guest limit reached (${max_guests}). Please upgrade your plan.`);
    }

    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –±–ª–∏–∑–∫–æ –∫ –ª–∏–º–∏—Ç—É (90%)
    const threshold = max_guests * 0.9;
    if (activeGuestsCount >= threshold) {
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Admin
      await this.notificationService.sendLimitWarning(tenantId, activeGuestsCount, max_guests);
    }
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   */
  private async checkPhoneDuplication(phone: string, tenantId: string, restaurantId?: string) {
    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
    const loyaltySystem = await this.prisma.loyaltySystem.findFirst({
      where: { tenant_id: tenantId },
    });

    if (!loyaltySystem) {
      return; // –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
    }

    // –ï—Å–ª–∏ UNIFIED mode (–µ–¥–∏–Ω–∞—è –∫–∞—Ä—Ç–∞ –Ω–∞ –≤—Å—é —Å–µ—Ç—å)
    if (loyaltySystem.mode === 'UNIFIED') {
      const existingCard = await this.prisma.guestCard.findFirst({
        where: {
          user: { phone },
          tenant_id: tenantId,
          deleted_at: null,
        },
      });

      if (existingCard) {
        throw new BadRequestException('Guest with this phone number already exists in this network');
      }
    }

    // –ï—Å–ª–∏ SEPARATE mode (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω)
    if (loyaltySystem.mode === 'SEPARATE' && restaurantId) {
      const existingCard = await this.prisma.guestCard.findFirst({
        where: {
          user: { phone },
          tenant_id: tenantId,
          restaurant_id: restaurantId,
          deleted_at: null,
        },
      });

      if (existingCard) {
        throw new BadRequestException('Guest with this phone number already exists in this restaurant');
      }
    }
  }

  // ============================================
  // –ü–û–õ–£–ß–ï–ù–ò–ï –ì–û–°–¢–ï–ô
  // ============================================

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≥–æ—Å—Ç–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
   */
  async getGuests(query: GetGuestsQueryDto, tenantId: string) {
    const {
      restaurant_id,
      status,
      search,
      page = 1,
      limit = 20,
      sort_by = 'created_at',
      sort_order = 'desc',
      registration_source,
      min_balance,
      max_balance,
      min_lifetime_spent,
      max_lifetime_spent,
      loyalty_level_id,
      last_visit_from,
      last_visit_to,
    } = query;

    const skip = (page - 1) * limit;

    // –°—Ç—Ä–æ–∏–º where —É—Å–ª–æ–≤–∏–µ
    const where: any = {
      tenant_id: tenantId,
      deleted_at: null,
    };

    if (restaurant_id) {
      where.restaurant_id = restaurant_id;
    }

    if (status) {
      where.status = status;
    }

    if (registration_source) {
      where.registration_source = registration_source;
    }

    if (loyalty_level_id) {
      where.loyalty_level_id = loyalty_level_id;
    }

    // –§–∏–ª—å—Ç—Ä –ø–æ –±–∞–ª–∞–Ω—Å—É
    if (min_balance !== undefined || max_balance !== undefined) {
      where.balance = {};
      if (min_balance !== undefined) where.balance.gte = min_balance;
      if (max_balance !== undefined) where.balance.lte = max_balance;
    }

    // –§–∏–ª—å—Ç—Ä –ø–æ lifetime_spent
    if (min_lifetime_spent !== undefined || max_lifetime_spent !== undefined) {
      where.lifetime_spent = {};
      if (min_lifetime_spent !== undefined) where.lifetime_spent.gte = min_lifetime_spent;
      if (max_lifetime_spent !== undefined) where.lifetime_spent.lte = max_lifetime_spent;
    }

    // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –ø–æ—Å–µ—â–µ–Ω–∏—é
    if (last_visit_from || last_visit_to) {
      where.last_visit_at = {};
      if (last_visit_from) where.last_visit_at.gte = new Date(last_visit_from);
      if (last_visit_to) where.last_visit_at.lte = new Date(last_visit_to);
    }

    // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É, email
    if (search) {
      where.OR = [
        {
          user: {
            guest_profile: {
              first_name: { contains: search, mode: 'insensitive' },
            },
          },
        },
        {
          user: {
            guest_profile: {
              last_name: { contains: search, mode: 'insensitive' },
            },
          },
        },
        {
          user: {
            phone: { contains: search },
          },
        },
        {
          user: {
            email: { contains: search, mode: 'insensitive' },
          },
        },
      ];
    }

    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const [guests, total] = await Promise.all([
      this.prisma.guestCard.findMany({
        where,
        skip,
        take: limit,
        orderBy: { [sort_by]: sort_order },
        include: {
          user: {
            include: {
              guest_profile: {
                include: {
                  children: {
                    where: { deleted_at: null },
                  },
                },
              },
            },
          },
          loyalty_level: true,
          restaurant: {
            select: {
              id: true,
              name: true,
            },
          },
        },
      }),
      this.prisma.guestCard.count({ where }),
    ]);

    return {
      data: guests,
      total,
      page,
      limit,
      total_pages: Math.ceil(total / limit),
    };
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–æ—Å—Ç—è –ø–æ ID
   */
  async getGuestById(guestCardId: string, tenantId: string) {
    const guestCard = await this.prisma.guestCard.findFirst({
      where: {
        id: guestCardId,
        tenant_id: tenantId,
        deleted_at: null,
      },
      include: {
        user: {
          include: {
            guest_profile: {
              include: {
                children: {
                  where: { deleted_at: null },
                },
              },
            },
          },
        },
        loyalty_level: true,
        restaurant: true,
      },
    });

    if (!guestCard) {
      throw new NotFoundException('Guest not found');
    }

    return guestCard;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ QR –∫–æ–¥—É
   */
  async getGuestByQRCode(qrCode: string) {
    const guestCard = await this.prisma.guestCard.findUnique({
      where: { qr_code: qrCode },
      include: {
        user: {
          include: {
            guest_profile: {
              include: {
                children: {
                  where: { deleted_at: null },
                },
              },
            },
          },
        },
        loyalty_level: true,
        restaurant: true,
      },
    });

    if (!guestCard || guestCard.deleted_at) {
      throw new NotFoundException('Guest card not found');
    }

    if (guestCard.status !== CardStatus.ACTIVE) {
      throw new BadRequestException(`Card is ${guestCard.status.toLowerCase()}`);
    }

    return guestCard;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ 6-–∑–Ω–∞—á–Ω–æ–º—É –∫–æ–¥—É
   */
  async getGuestBy6DigitCode(code6Digit: string) {
    const guestCard = await this.prisma.guestCard.findUnique({
      where: { code_6_digit: code6Digit },
      include: {
        user: {
          include: {
            guest_profile: {
              include: {
                children: {
                  where: { deleted_at: null },
                },
              },
            },
          },
        },
        loyalty_level: true,
        restaurant: true,
      },
    });

    if (!guestCard || guestCard.deleted_at) {
      throw new NotFoundException('Guest card not found');
    }

    if (guestCard.status !== CardStatus.ACTIVE) {
      throw new BadRequestException(`Card is ${guestCard.status.toLowerCase()}`);
    }

    return guestCard;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   */
  async getGuestByPhone(phone: string, tenantId: string, restaurantId?: string) {
    const where: any = {
      user: { phone },
      tenant_id: tenantId,
      deleted_at: null,
    };

    if (restaurantId) {
      where.restaurant_id = restaurantId;
    }

    const guestCard = await this.prisma.guestCard.findFirst({
      where,
      include: {
        user: {
          include: {
            guest_profile: {
              include: {
                children: {
                  where: { deleted_at: null },
                },
              },
            },
          },
        },
        loyalty_level: true,
        restaurant: true,
      },
    });

    if (!guestCard) {
      throw new NotFoundException('Guest not found');
    }

    if (guestCard.status !== CardStatus.ACTIVE) {
      throw new BadRequestException(`Card is ${guestCard.status.toLowerCase()}`);
    }

    return guestCard;
  }

  // ============================================
  // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–§–ò–õ–Ø
  // ============================================

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≥–æ—Å—Ç—è (—Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞)
   */
  async updateGuestProfile(userId: string, dto: UpdateGuestProfileDto) {
    const guestProfile = await this.prisma.guestProfile.findUnique({
      where: { user_id: userId },
    });

    if (!guestProfile) {
      throw new NotFoundException('Guest profile not found');
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞
    const threeMonthsAgo = new Date();
    threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);

    if (guestProfile.last_profile_update > threeMonthsAgo) {
      const nextUpdateDate = new Date(guestProfile.last_profile_update);
      nextUpdateDate.setMonth(nextUpdateDate.getMonth() + 3);

      throw new ForbiddenException(
        `Profile can be updated only once every 3 months. Next update available: ${nextUpdateDate.toLocaleDateString()}`,
      );
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
    const updated = await this.prisma.guestProfile.update({
      where: { user_id: userId },
      data: {
        ...dto,
        birth_date: dto.birth_date ? new Date(dto.birth_date) : undefined,
        last_profile_update: new Date(),
      },
    });

    // –õ–æ–≥–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ
    await this.activityLogService.log({
      user_id: userId,
      action_type: 'UPDATE_GUEST_PROFILE',
      entity_type: 'GUEST_PROFILE',
      entity_id: guestProfile.id,
      old_value: guestProfile,
      new_value: updated,
      description: 'Guest updated their profile',
    });

    return updated;
  }

  /**
   * –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–º–µ–Ω—É –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—à–∞–≥ 1 - –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS)
   */
  async requestPhoneChange(userId: string, dto: RequestPhoneChangeDto) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä –Ω–µ –∑–∞–Ω—è—Ç
    const existingUser = await this.prisma.user.findUnique({
      where: { phone: dto.new_phone },
    });

    if (existingUser && existingUser.id !== userId) {
      throw new BadRequestException('This phone number is already registered');
    }

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
    const verificationCode = this.generate6DigitCode();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ Redis (TTL 10 –º–∏–Ω—É—Ç)
    await this.notificationService.savePhoneVerificationCode(
      userId,
      dto.new_phone,
      verificationCode,
    );

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º SMS —Å –∫–æ–¥–æ–º
    await this.notificationService.sendSMS(dto.new_phone, `–í–∞—à –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è: ${verificationCode}`);

    return { message: 'Verification code sent to your new phone number' };
  }

  /**
   * –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–º–µ–Ω—ã –Ω–æ–º–µ—Ä–∞ (—à–∞–≥ 2 - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞)
   */
  async confirmPhoneChange(userId: string, dto: ConfirmPhoneChangeDto) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –∏–∑ Redis
    const isValid = await this.notificationService.verifyPhoneCode(
      userId,
      dto.new_phone,
      dto.verification_code,
    );

    if (!isValid) {
      throw new BadRequestException('Invalid or expired verification code');
    }

    return this.prisma.$transaction(async (tx) => {
      // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ä—ã–π –Ω–æ–º–µ—Ä
      const user = await tx.user.findUnique({
        where: { id: userId },
      });

      const oldPhone = user.phone;

      // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä
      const updatedUser = await tx.user.update({
        where: { id: userId },
        data: {
          phone: dto.new_phone,
          phone_verified: true,
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ
      await this.activityLogService.log({
        user_id: userId,
        action_type: 'CHANGE_PHONE',
        entity_type: 'USER',
        entity_id: userId,
        old_value: { phone: oldPhone },
        new_value: { phone: dto.new_phone },
        description: `Phone changed from ${oldPhone} to ${dto.new_phone}`,
      }, tx);

      return updatedUser;
    });
  }

  // ============================================
  // –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ï–¢–¨–ú–ò
  // ============================================

  /**
   * –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞ (–º–∞–∫—Å–∏–º—É–º 3)
   */
  async addChild(userId: string, dto: AddChildDto) {
    const guestProfile = await this.prisma.guestProfile.findUnique({
      where: { user_id: userId },
      include: {
        children: {
          where: { deleted_at: null },
        },
      },
    });

    if (!guestProfile) {
      throw new NotFoundException('Guest profile not found');
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º—É–º 3 –¥–µ—Ç–µ–π
    if (guestProfile.children.length >= 3) {
      throw new BadRequestException('Maximum 3 children allowed');
    }

    const child = await this.prisma.guestChild.create({
      data: {
        guest_profile_id: guestProfile.id,
        name: dto.name,
        birth_date: new Date(dto.birth_date),
      },
    });

    // –õ–æ–≥–∏—Ä—É–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
    await this.activityLogService.log({
      user_id: userId,
      action_type: 'ADD_CHILD',
      entity_type: 'GUEST_CHILD',
      entity_id: child.id,
      new_value: child,
      description: `Added child: ${dto.name}`,
    });

    return child;
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞
   */
  async updateChild(userId: string, childId: string, dto: UpdateChildDto) {
    const child = await this.prisma.guestChild.findFirst({
      where: {
        id: childId,
        guest_profile: { user_id: userId },
        deleted_at: null,
      },
    });

    if (!child) {
      throw new NotFoundException('Child not found');
    }

    const updated = await this.prisma.guestChild.update({
      where: { id: childId },
      data: {
        name: dto.name,
        birth_date: dto.birth_date ? new Date(dto.birth_date) : undefined,
      },
    });

    // –õ–æ–≥–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    await this.activityLogService.log({
      user_id: userId,
      action_type: 'UPDATE_CHILD',
      entity_type: 'GUEST_CHILD',
      entity_id: childId,
      old_value: child,
      new_value: updated,
      description: `Updated child: ${updated.name}`,
    });

    return updated;
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞ (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
   */
  async deleteChild(userId: string, childId: string) {
    const child = await this.prisma.guestChild.findFirst({
      where: {
        id: childId,
        guest_profile: { user_id: userId },
        deleted_at: null,
      },
    });

    if (!child) {
      throw new NotFoundException('Child not found');
    }

    const deleted = await this.prisma.guestChild.update({
      where: { id: childId },
      data: {
        deleted_at: new Date(),
      },
    });

    // –õ–æ–≥–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ
    await this.activityLogService.log({
      user_id: userId,
      action_type: 'DELETE_CHILD',
      entity_type: 'GUEST_CHILD',
      entity_id: childId,
      old_value: child,
      description: `Deleted child: ${child.name}`,
    });

    return { message: 'Child deleted successfully' };
  }

  // ============================================
  // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
  // ============================================

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ QR –∫–æ–¥–∞
   */
  private generateQRCode(): string {
    return `QR_${crypto.randomBytes(16).toString('hex')}`;
  }

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 6-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥–∞
   */
  private generate6DigitCode(): string {
    return Math.floor(100000 + Math.random() * 900000).toString();
  }

  /**
   * –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∞—Ç—ã —Å–≥–æ—Ä–∞–Ω–∏—è –±–∞–ª–ª–æ–≤
   */
  private calculateBallExpiration(loyaltySystem: any): Date | null {
    if (!loyaltySystem.ball_expiration_days) {
      return null; // –ë–∞–ª–ª—ã –Ω–µ —Å–≥–æ—Ä–∞—é—Ç
    }

    const expirationDate = new Date();
    expirationDate.setDate(expirationDate.getDate() + loyaltySystem.ball_expiration_days);
    return expirationDate;
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ QR –∏ 6-digit –∫–æ–¥–æ–≤ (–ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–∞—Ä—Ç–æ–π)
   */
  async regenerateCodes(guestCardId: string) {
    const newQRCode = this.generateQRCode();
    const new6DigitCode = this.generate6DigitCode();

    return this.prisma.guestCard.update({
      where: { id: guestCardId },
      data: {
        qr_code: newQRCode,
        code_6_digit: new6DigitCode,
      },
    });
  }
}
```


***

–ü—Ä–æ–¥–æ–ª–∂–∞—é —Å **GuestCardService** (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏)? üöÄ

---

# –ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è —Ç—ã –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª —Å–æ–∑–¥–∞–Ω–∏–µ SERVICES, –µ—Å–ª–∏ —è –ø—Ä–∞–≤ - –ø—Ä–æ–¥–æ–ª–∂–∏ —Å –º–µ—Å—Ç–∞ –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è, –µ—Å–ª–∏ –∑–∞–∫–æ–Ω—á–∏–ª - –ø—Ä–æ–¥–æ–ª–∂–∞–π

–¢—ã –ø—Ä–∞–≤! ‚úÖ –Ø –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª SERVICES.

–ü—Ä–æ–¥–æ–ª–∂–∞—é —Å **GuestCardService** –∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

***

## üîß SERVICES - –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï

```typescript
// ============================================
// apps/backend/src/modules/guests/services/guest-card.service.ts
// ============================================

import { Injectable, BadRequestException, NotFoundException, ForbiddenException } from '@nestjs/common';
import { PrismaService } from '@/database/prisma.service';
import { ActivityLogService } from '@/modules/activity-log/activity-log.service';
import { NotificationService } from '@/modules/notifications/notification.service';
import {
  BlockGuestCardDto,
  UnblockGuestCardDto,
  DeleteGuestCardDto,
  RestoreGuestCardDto,
} from '../dto';
import { CardStatus } from '@prisma/client';

@Injectable()
export class GuestCardService {
  constructor(
    private prisma: PrismaService,
    private activityLogService: ActivityLogService,
    private notificationService: NotificationService,
  ) {}

  // ============================================
  // –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–ê–¢–£–°–û–ú –ö–ê–†–¢–´
  // ============================================

  /**
   * –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è
   */
  async blockCard(dto: BlockGuestCardDto, blockedByUserId: string, tenantId: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await tx.guestCard.findFirst({
        where: {
          id: dto.guest_card_id,
          tenant_id: tenantId,
          deleted_at: null,
        },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      if (!guestCard) {
        throw new NotFoundException('Guest card not found');
      }

      if (guestCard.status === CardStatus.BLOCKED) {
        throw new BadRequestException('Card is already blocked');
      }

      // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
      const blocked = await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          status: CardStatus.BLOCKED,
          block_reason: dto.block_reason,
          blocked_by_user_id: blockedByUserId,
          blocked_at: new Date(),
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: blockedByUserId,
        action_type: 'BLOCK_GUEST_CARD',
        entity_type: 'GUEST_CARD',
        entity_id: dto.guest_card_id,
        old_value: { status: guestCard.status },
        new_value: { status: CardStatus.BLOCKED, reason: dto.block_reason },
        description: `Blocked guest card: ${dto.block_reason}`,
      }, tx);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–æ—Å—Ç—é
      await this.notificationService.sendCardBlockedNotification(
        guestCard.user,
        dto.block_reason,
      );

      return blocked;
    });
  }

  /**
   * –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è
   */
  async unblockCard(dto: UnblockGuestCardDto, unblockedByUserId: string, tenantId: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await tx.guestCard.findFirst({
        where: {
          id: dto.guest_card_id,
          tenant_id: tenantId,
          deleted_at: null,
        },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      if (!guestCard) {
        throw new NotFoundException('Guest card not found');
      }

      if (guestCard.status !== CardStatus.BLOCKED) {
        throw new BadRequestException('Card is not blocked');
      }

      // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
      const unblocked = await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          status: CardStatus.ACTIVE,
          block_reason: null,
          blocked_by_user_id: null,
          blocked_at: null,
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫—É
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: unblockedByUserId,
        action_type: 'UNBLOCK_GUEST_CARD',
        entity_type: 'GUEST_CARD',
        entity_id: dto.guest_card_id,
        old_value: { status: CardStatus.BLOCKED },
        new_value: { status: CardStatus.ACTIVE },
        description: 'Unblocked guest card',
      }, tx);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–æ—Å—Ç—é
      await this.notificationService.sendCardUnblockedNotification(guestCard.user);

      return unblocked;
    });
  }

  /**
   * –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
   */
  async deleteCard(dto: DeleteGuestCardDto, deletedByUserId: string, tenantId: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await tx.guestCard.findFirst({
        where: {
          id: dto.guest_card_id,
          tenant_id: tenantId,
          deleted_at: null,
        },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      if (!guestCard) {
        throw new NotFoundException('Guest card not found');
      }

      // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç—É (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
      const deleted = await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          status: CardStatus.DELETED,
          deleted_at: new Date(),
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: deletedByUserId,
        action_type: 'DELETE_GUEST_CARD',
        entity_type: 'GUEST_CARD',
        entity_id: dto.guest_card_id,
        old_value: { status: guestCard.status },
        new_value: { status: CardStatus.DELETED, reason: dto.deletion_reason },
        description: `Deleted guest card${dto.deletion_reason ? `: ${dto.deletion_reason}` : ''}`,
      }, tx);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–æ—Å—Ç—é
      await this.notificationService.sendCardDeletedNotification(guestCard.user);

      return { message: 'Guest card deleted successfully' };
    });
  }

  /**
   * –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è (–ø–æ—Å–ª–µ –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è)
   * –í–ê–ñ–ù–û: –ë–∞–ª–ª—ã –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, —Ç–æ–ª—å–∫–æ —É—Ä–æ–≤–µ–Ω—å
   */
  async restoreCard(dto: RestoreGuestCardDto, restoredByUserId: string, tenantId: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await tx.guestCard.findFirst({
        where: {
          id: dto.guest_card_id,
          tenant_id: tenantId,
          status: CardStatus.DELETED,
        },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
          loyalty_level: true,
        },
      });

      if (!guestCard) {
        throw new NotFoundException('Deleted guest card not found');
      }

      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ä—Ç—É
      const restored = await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          status: CardStatus.ACTIVE,
          deleted_at: null,
          balance: 0, // –ë–∞–ª–ª—ã –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
          // loyalty_level_id –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º (—É—Ä–æ–≤–µ–Ω—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: restoredByUserId,
        action_type: 'RESTORE_GUEST_CARD',
        entity_type: 'GUEST_CARD',
        entity_id: dto.guest_card_id,
        old_value: { status: CardStatus.DELETED, balance: guestCard.balance },
        new_value: { status: CardStatus.ACTIVE, balance: 0 },
        description: 'Restored guest card (balance reset to 0, level preserved)',
      }, tx);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≥–æ—Å—Ç—é
      await this.notificationService.sendCardRestoredNotification(
        guestCard.user,
        guestCard.loyalty_level?.name,
      );

      return restored;
    });
  }

  // ============================================
  // –ó–ê–ü–†–û–° –ù–ê –£–î–ê–õ–ï–ù–ò–ï –î–ê–ù–ù–´–• (GDPR)
  // ============================================

  /**
   * –ó–∞–ø—Ä–æ—Å –≥–æ—Å—Ç—è –Ω–∞ –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (GDPR)
   */
  async requestDataDeletion(userId: string) {
    return this.prisma.$transaction(async (tx) => {
      // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–∞—Ä—Ç—ã –≥–æ—Å—Ç—è
      const guestCards = await tx.guestCard.findMany({
        where: {
          user_id: userId,
          deleted_at: null,
        },
      });

      // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç—ã (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
      await tx.guestCard.updateMany({
        where: { user_id: userId },
        data: {
          status: CardStatus.DELETED,
          deleted_at: new Date(),
        },
      });

      // –£–¥–∞–ª—è–µ–º –¥–µ—Ç–µ–π
      await tx.guestChild.updateMany({
        where: {
          guest_profile: { user_id: userId },
        },
        data: {
          deleted_at: new Date(),
        },
      });

      // –£–¥–∞–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—é)
      await tx.guestProfile.update({
        where: { user_id: userId },
        data: {
          first_name: 'DELETED',
          last_name: null,
          middle_name: null,
          gender: null,
          birth_date: null,
          avatar_url: null,
          city: null,
          address: null,
          telegram_username: null,
          telegram_photo_url: null,
        },
      });

      // –ê–Ω–æ–Ω–∏–º–∏–∑–∏—Ä—É–µ–º User
      await tx.user.update({
        where: { id: userId },
        data: {
          email: null,
          telegram_id: null,
          deleted_at: new Date(),
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ
      await this.activityLogService.log({
        user_id: userId,
        action_type: 'GDPR_DATA_DELETION',
        entity_type: 'USER',
        entity_id: userId,
        description: 'Guest requested full data deletion (GDPR)',
      }, tx);

      return {
        message: 'All your data has been deleted successfully',
        cards_deleted: guestCards.length,
      };
    });
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/services/ball-transaction.service.ts
// ============================================

import { Injectable, BadRequestException, NotFoundException } from '@nestjs/common';
import { PrismaService } from '@/database/prisma.service';
import { ActivityLogService } from '@/modules/activity-log/activity-log.service';
import { NotificationService } from '@/modules/notifications/notification.service';
import { LoyaltyService } from '@/modules/loyalty/loyalty.service';
import {
  EarnBallsDto,
  RedeemBallsDto,
  ManualAddBallsDto,
  ManualSubtractBallsDto,
  CancelBallTransactionDto,
  GetBallTransactionsQueryDto,
} from '../dto';
import { BallTransactionType, CardStatus } from '@prisma/client';
import { Decimal } from '@prisma/client/runtime/library';

@Injectable()
export class BallTransactionService {
  constructor(
    private prisma: PrismaService,
    private activityLogService: ActivityLogService,
    private notificationService: NotificationService,
    private loyaltyService: LoyaltyService,
  ) {}

  // ============================================
  // –ù–ê–ß–ò–°–õ–ï–ù–ò–ï –ë–ê–õ–õ–û–í
  // ============================================

  /**
   * –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (–æ—Ç —á–µ–∫–∞ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –ü–û–°)
   */
  async earnBalls(dto: EarnBallsDto, tenantId: string, createdByUserId?: string) {
    return this.prisma.$transaction(async (tx) => {
      // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ä—Ç—É –≥–æ—Å—Ç—è
      const guestCard = await this.getActiveCard(dto.guest_card_id, tenantId, tx);

      // –ü–æ–ª—É—á–∞–µ–º —Å–∏—Å—Ç–µ–º—É –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
      const loyaltySystem = await this.loyaltyService.getLoyaltySystemByCard(guestCard, tx);

      // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ —è–≤–Ω–æ)
      let earnAmount = dto.amount;

      if (dto.check_amount && !dto.amount) {
        // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É –æ—Ç —á–µ–∫–∞
        const earnPercentage = await this.loyaltyService.calculateEarnPercentage(
          guestCard,
          dto.check_amount,
          tx,
        );
        earnAmount = Math.floor((dto.check_amount * earnPercentage) / 100);
      }

      if (earnAmount <= 0) {
        throw new BadRequestException('Earn amount must be greater than 0');
      }

      const balanceBefore = guestCard.balance;
      const balanceAfter = balanceBefore + earnAmount;

      // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
      const transaction = await tx.ballTransaction.create({
        data: {
          guest_card_id: dto.guest_card_id,
          tenant_id: tenantId,
          restaurant_id: guestCard.restaurant_id,
          type: BallTransactionType.EARN,
          amount: earnAmount,
          balance_before: balanceBefore,
          balance_after: balanceAfter,
          description: dto.description || `Earned ${earnAmount} balls from purchase`,
          check_amount: dto.check_amount ? new Decimal(dto.check_amount) : null,
          pos_transaction_id: dto.pos_transaction_id,
          created_by_user_id: createdByUserId,
        },
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã
      const newLifetimeSpent = guestCard.lifetime_spent.toNumber() + (dto.check_amount || 0);

      await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          balance: balanceAfter,
          lifetime_spent: newLifetimeSpent,
          total_visits: { increment: 1 },
          last_visit_at: new Date(),
          last_activity_at: new Date(),
        },
      });

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
      await this.loyaltyService.checkLevelUpgrade(dto.guest_card_id, newLifetimeSpent, tx);

      // –û–±–Ω–æ–≤–ª—è–µ–º QR –∏ 6-digit –∫–æ–¥—ã
      await this.regenerateCodes(dto.guest_card_id, tx);

      // –õ–æ–≥–∏—Ä—É–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: createdByUserId || guestCard.user_id,
        action_type: 'EARN_BALLS',
        entity_type: 'BALL_TRANSACTION',
        entity_id: transaction.id,
        new_value: {
          amount: earnAmount,
          balance_before: balanceBefore,
          balance_after: balanceAfter,
          check_amount: dto.check_amount,
        },
        description: `Earned ${earnAmount} balls`,
      }, tx);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.notificationService.sendBallsEarnedNotification(
        guestCard.user,
        earnAmount,
        balanceAfter,
      );

      return transaction;
    });
  }

  /**
   * –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—Ç–æ–ª—å–∫–æ Manager/Admin)
   */
  async manualAddBalls(dto: ManualAddBallsDto, tenantId: string, createdByUserId: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await this.getActiveCard(dto.guest_card_id, tenantId, tx);

      const balanceBefore = guestCard.balance;
      const balanceAfter = balanceBefore + dto.amount;

      // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
      const transaction = await tx.ballTransaction.create({
        data: {
          guest_card_id: dto.guest_card_id,
          tenant_id: tenantId,
          restaurant_id: guestCard.restaurant_id,
          type: BallTransactionType.MANUAL_ADD,
          amount: dto.amount,
          balance_before: balanceBefore,
          balance_after: balanceAfter,
          description: dto.description || `Manual addition: ${dto.reason}`,
          reason: dto.reason, // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞
          created_by_user_id: createdByUserId,
        },
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
      await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          balance: balanceAfter,
          last_activity_at: new Date(),
        },
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥—ã
      await this.regenerateCodes(dto.guest_card_id, tx);

      // –õ–æ–≥–∏—Ä—É–µ–º
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: createdByUserId,
        action_type: 'MANUAL_ADD_BALLS',
        entity_type: 'BALL_TRANSACTION',
        entity_id: transaction.id,
        new_value: {
          amount: dto.amount,
          reason: dto.reason,
          balance_after: balanceAfter,
        },
        description: `Manually added ${dto.amount} balls: ${dto.reason}`,
      }, tx);

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.notificationService.sendManualBallsAddedNotification(
        guestCard.user,
        dto.amount,
        balanceAfter,
        dto.reason,
      );

      return transaction;
    });
  }

  // ============================================
  // –°–ü–ò–°–ê–ù–ò–ï –ë–ê–õ–õ–û–í
  // ============================================

  /**
   * –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (–Ω–∞ —á–µ–∫)
   */
  async redeemBalls(dto: RedeemBallsDto, tenantId: string, createdByUserId?: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await this.getActiveCard(dto.guest_card_id, tenantId, tx);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
      if (guestCard.balance < dto.amount) {
        throw new BadRequestException(
          `Insufficient balance. Available: ${guestCard.balance}, requested: ${dto.amount}`,
        );
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 1 –±–∞–ª–ª–∞ –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è, –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å > 0)
      const balanceAfter = guestCard.balance - dto.amount;
      if (balanceAfter > 0 && balanceAfter < 1) {
        throw new BadRequestException('Balance after redemption cannot be less than 1 ball');
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π % –æ—Ç —á–µ–∫–∞ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
      if (dto.check_amount) {
        const loyaltySystem = await this.loyaltyService.getLoyaltySystemByCard(guestCard, tx);
        const maxRedeemPercent = loyaltySystem.max_redeem_percent || 100; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 100%

        const maxRedeemAmount = Math.floor((dto.check_amount * maxRedeemPercent) / 100);

        if (dto.amount > maxRedeemAmount) {
          throw new BadRequestException(
            `Cannot redeem more than ${maxRedeemPercent}% of check amount. Max: ${maxRedeemAmount} balls`,
          );
        }
      }

      const balanceBefore = guestCard.balance;

      // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
      const transaction = await tx.ballTransaction.create({
        data: {
          guest_card_id: dto.guest_card_id,
          tenant_id: tenantId,
          restaurant_id: guestCard.restaurant_id,
          type: BallTransactionType.REDEEM,
          amount: -dto.amount, // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è
          balance_before: balanceBefore,
          balance_after: balanceAfter,
          description: dto.description || `Redeemed ${dto.amount} balls`,
          check_amount: dto.check_amount ? new Decimal(dto.check_amount) : null,
          pos_transaction_id: dto.pos_transaction_id,
          created_by_user_id: createdByUserId,
        },
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
      await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          balance: balanceAfter,
          last_activity_at: new Date(),
        },
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥—ã
      await this.regenerateCodes(dto.guest_card_id, tx);

      // –õ–æ–≥–∏—Ä—É–µ–º
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: createdByUserId || guestCard.user_id,
        action_type: 'REDEEM_BALLS',
        entity_type: 'BALL_TRANSACTION',
        entity_id: transaction.id,
        new_value: {
          amount: dto.amount,
          balance_before: balanceBefore,
          balance_after: balanceAfter,
          check_amount: dto.check_amount,
        },
        description: `Redeemed ${dto.amount} balls`,
      }, tx);

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.notificationService.sendBallsRedeemedNotification(
        guestCard.user,
        dto.amount,
        balanceAfter,
      );

      return transaction;
    });
  }

  /**
   * –†—É—á–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—Ç–æ–ª—å–∫–æ Manager/Admin)
   */
  async manualSubtractBalls(dto: ManualSubtractBallsDto, tenantId: string, createdByUserId: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await this.getActiveCard(dto.guest_card_id, tenantId, tx);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
      if (guestCard.balance < dto.amount) {
        throw new BadRequestException(
          `Insufficient balance. Available: ${guestCard.balance}, requested: ${dto.amount}`,
        );
      }

      // –ù–µ –º–æ–∂–µ–º —É–π—Ç–∏ –≤ –º–∏–Ω—É—Å
      const balanceBefore = guestCard.balance;
      const balanceAfter = balanceBefore - dto.amount;

      if (balanceAfter < 0) {
        throw new BadRequestException('Cannot subtract balls below 0');
      }

      // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
      const transaction = await tx.ballTransaction.create({
        data: {
          guest_card_id: dto.guest_card_id,
          tenant_id: tenantId,
          restaurant_id: guestCard.restaurant_id,
          type: BallTransactionType.MANUAL_SUBTRACT,
          amount: -dto.amount,
          balance_before: balanceBefore,
          balance_after: balanceAfter,
          description: dto.description || `Manual subtraction: ${dto.reason}`,
          reason: dto.reason, // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞
          created_by_user_id: createdByUserId,
        },
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
      await tx.guestCard.update({
        where: { id: dto.guest_card_id },
        data: {
          balance: balanceAfter,
          last_activity_at: new Date(),
        },
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥—ã
      await this.regenerateCodes(dto.guest_card_id, tx);

      // –õ–æ–≥–∏—Ä—É–µ–º
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: createdByUserId,
        action_type: 'MANUAL_SUBTRACT_BALLS',
        entity_type: 'BALL_TRANSACTION',
        entity_id: transaction.id,
        new_value: {
          amount: dto.amount,
          reason: dto.reason,
          balance_after: balanceAfter,
        },
        description: `Manually subtracted ${dto.amount} balls: ${dto.reason}`,
      }, tx);

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.notificationService.sendManualBallsSubtractedNotification(
        guestCard.user,
        dto.amount,
        balanceAfter,
        dto.reason,
      );

      return transaction;
    });
  }

  // ============================================
  // –û–¢–ú–ï–ù–ê –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
  // ============================================

  /**
   * –û—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏ (–º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å)
   */
  async cancelTransaction(dto: CancelBallTransactionDto, tenantId: string, cancelledByUserId: string) {
    return this.prisma.$transaction(async (tx) => {
      const transaction = await tx.ballTransaction.findFirst({
        where: {
          id: dto.transaction_id,
          tenant_id: tenantId,
          is_cancelled: false,
        },
        include: {
          guest_card: true,
        },
      });

      if (!transaction) {
        throw new NotFoundException('Transaction not found or already cancelled');
      }

      // –û—Ç–º–µ–Ω—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
      const cancelled = await tx.ballTransaction.update({
        where: { id: dto.transaction_id },
        data: {
          is_cancelled: true,
          cancelled_at: new Date(),
          cancelled_by_user_id: cancelledByUserId,
          cancellation_reason: dto.cancellation_reason,
        },
      });

      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–ª–∞–Ω—Å –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –¥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
      await tx.guestCard.update({
        where: { id: transaction.guest_card_id },
        data: {
          balance: transaction.balance_before,
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–º–µ–Ω—É
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: cancelledByUserId,
        action_type: 'CANCEL_BALL_TRANSACTION',
        entity_type: 'BALL_TRANSACTION',
        entity_id: dto.transaction_id,
        old_value: {
          balance_before: transaction.balance_before,
          balance_after: transaction.balance_after,
        },
        new_value: {
          balance_restored: transaction.balance_before,
          cancellation_reason: dto.cancellation_reason,
        },
        description: `Cancelled transaction: ${dto.cancellation_reason}`,
      }, tx);

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.notificationService.sendTransactionCancelledNotification(
        transaction.guest_card.user,
        transaction.amount,
        dto.cancellation_reason,
      );

      return cancelled;
    });
  }

  // ============================================
  // –°–ì–û–†–ê–ù–ò–ï –ë–ê–õ–õ–û–í
  // ============================================

  /**
   * –°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –∫—Ä–æ–Ω-–¥–∂–æ–±—É)
   */
  async expireBalls(guestCardId: string) {
    return this.prisma.$transaction(async (tx) => {
      const guestCard = await tx.guestCard.findUnique({
        where: { id: guestCardId },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      if (!guestCard || guestCard.balance === 0) {
        return null; // –ù–µ—á–µ–≥–æ —Å–≥–æ—Ä–∞—Ç—å
      }

      const balanceBefore = guestCard.balance;
      const expiredAmount = balanceBefore; // –í—Å–µ –±–∞–ª–ª—ã —Å–≥–æ—Ä–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

      // –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å–≥–æ—Ä–∞–Ω–∏—è
      const transaction = await tx.ballTransaction.create({
        data: {
          guest_card_id: guestCardId,
          tenant_id: guestCard.tenant_id,
          restaurant_id: guestCard.restaurant_id,
          type: BallTransactionType.EXPIRE,
          amount: -expiredAmount,
          balance_before: balanceBefore,
          balance_after: 0,
          description: `Balls expired due to inactivity`,
        },
      });

      // –û–±–Ω—É–ª—è–µ–º –±–∞–ª–∞–Ω—Å
      await tx.guestCard.update({
        where: { id: guestCardId },
        data: {
          balance: 0,
          balls_expire_at: null, // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞—Ç—É —Å–≥–æ—Ä–∞–Ω–∏—è
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º
      await this.activityLogService.log({
        tenant_id: guestCard.tenant_id,
        user_id: guestCard.user_id,
        action_type: 'EXPIRE_BALLS',
        entity_type: 'BALL_TRANSACTION',
        entity_id: transaction.id,
        old_value: { balance: balanceBefore },
        new_value: { balance: 0 },
        description: `${expiredAmount} balls expired`,
      }, tx);

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      await this.notificationService.sendBallsExpiredNotification(
        guestCard.user,
        expiredAmount,
      );

      return transaction;
    });
  }

  // ============================================
  // –ü–û–õ–£–ß–ï–ù–ò–ï –ò–°–¢–û–†–ò–ò –¢–†–ê–ù–ó–ê–ö–¶–ò–ô
  // ============================================

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   */
  async getTransactions(query: GetBallTransactionsQueryDto, tenantId: string) {
    const {
      guest_card_id,
      type,
      date_from,
      date_to,
      page = 1,
      limit = 50,
    } = query;

    const skip = (page - 1) * limit;

    const where: any = {
      tenant_id: tenantId,
      is_cancelled: false,
    };

    if (guest_card_id) {
      where.guest_card_id = guest_card_id;
    }

    if (type) {
      where.type = type;
    }

    if (date_from || date_to) {
      where.created_at = {};
      if (date_from) where.created_at.gte = new Date(date_from);
      if (date_to) where.created_at.lte = new Date(date_to);
    }

    const [transactions, total] = await Promise.all([
      this.prisma.ballTransaction.findMany({
        where,
        skip,
        take: limit,
        orderBy: { created_at: 'desc' },
        include: {
          guest_card: {
            include: {
              user: {
                include: {
                  guest_profile: {
                    select: {
                      first_name: true,
                      last_name: true,
                    },
                  },
                },
              },
            },
          },
          created_by: {
            select: {
              id: true,
              guest_profile: {
                select: {
                  first_name: true,
                  last_name: true,
                },
              },
            },
          },
          promo: {
            select: {
              id: true,
              name: true,
            },
          },
        },
      }),
      this.prisma.ballTransaction.count({ where }),
    ]);

    return {
      data: transactions,
      total,
      page,
      limit,
      total_pages: Math.ceil(total / limit),
    };
  }

  // ============================================
  // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
  // ============================================

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
   */
  private async getActiveCard(guestCardId: string, tenantId: string, tx: any) {
    const guestCard = await tx.guestCard.findFirst({
      where: {
        id: guestCardId,
        tenant_id: tenantId,
        deleted_at: null,
      },
      include: {
        user: {
          include: {
            guest_profile: true,
          },
        },
      },
    });

    if (!guestCard) {
      throw new NotFoundException('Guest card not found');
    }

    if (guestCard.status !== CardStatus.ACTIVE) {
      throw new BadRequestException(`Card is ${guestCard.status.toLowerCase()}`);
    }

    return guestCard;
  }

  /**
   * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ QR –∏ 6-digit –∫–æ–¥–æ–≤
   */
  private async regenerateCodes(guestCardId: string, tx: any) {
    const newQRCode = this.generateQRCode();
    const new6DigitCode = this.generate6DigitCode();

    return tx.guestCard.update({
      where: { id: guestCardId },
      data: {
        qr_code: newQRCode,
        code_6_digit: new6DigitCode,
      },
    });
  }

  private generateQRCode(): string {
    return `QR_${crypto.randomBytes(16).toString('hex')}`;
  }

  private generate6DigitCode(): string {
    return Math.floor(100000 + Math.random() * 900000).toString();
  }
}
```

–ü—Ä–æ–¥–æ–ª–∂–∞—é —Å **BallTransferService** –∏ **RegistrationLinkService**? üöÄ

---

# –ü—Ä–æ–¥–æ–ª–∂–∞–π

```typescript
// ============================================
// apps/backend/src/modules/guests/services/ball-transfer.service.ts
// ============================================

import { Injectable, BadRequestException, NotFoundException, ForbiddenException } from '@nestjs/common';
import { PrismaService } from '@/database/prisma.service';
import { ActivityLogService } from '@/modules/activity-log/activity-log.service';
import { NotificationService } from '@/modules/notifications/notification.service';
import {
  InitiateBallTransferDto,
  ConfirmBallTransferDto,
  CancelBallTransferDto,
} from '../dto';
import { TransferStatus, CardStatus, BallTransactionType } from '@prisma/client';
import * as crypto from 'crypto';

@Injectable()
export class BallTransferService {
  constructor(
    private prisma: PrismaService,
    private activityLogService: ActivityLogService,
    private notificationService: NotificationService,
  ) {}

  // ============================================
  // –ü–ï–†–ï–í–û–î –ë–ê–õ–õ–û–í –ú–ï–ñ–î–£ –ì–û–°–¢–Ø–ú–ò
  // ============================================

  /**
   * –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ –±–∞–ª–ª–æ–≤ (—à–∞–≥ 1 - –∑–∞–ø—Ä–æ—Å –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ SMS)
   */
  async initiateTransfer(dto: InitiateBallTransferDto, tenantId: string, userId: string) {
    return this.prisma.$transaction(async (tx) => {
      // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (—Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –ø–µ—Ä–µ–≤–æ–¥)
      const loyaltySystem = await tx.loyaltySystem.findFirst({
        where: { tenant_id: tenantId },
      });

      if (!loyaltySystem) {
        throw new NotFoundException('Loyalty system not found');
      }

      if (!loyaltySystem.allow_ball_transfer) {
        throw new ForbiddenException('Ball transfer is disabled for this restaurant');
      }

      // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Ä—Ç—É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
      const senderCard = await tx.guestCard.findFirst({
        where: {
          id: dto.sender_card_id,
          user_id: userId, // –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å
          tenant_id: tenantId,
          status: CardStatus.ACTIVE,
          deleted_at: null,
        },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      if (!senderCard) {
        throw new NotFoundException('Sender card not found or inactive');
      }

      // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
      if (senderCard.balance < dto.amount) {
        throw new BadRequestException(
          `Insufficient balance. Available: ${senderCard.balance}, requested: ${dto.amount}`,
        );
      }

      // –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 1 (–µ—Å–ª–∏ –Ω–µ 0)
      const balanceAfterTransfer = senderCard.balance - dto.amount;
      if (balanceAfterTransfer > 0 && balanceAfterTransfer < 1) {
        throw new BadRequestException('Balance after transfer cannot be less than 1 ball');
      }

      // 4. –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç—É –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      const receiverCard = await tx.guestCard.findFirst({
        where: {
          user: {
            phone: dto.receiver_phone,
          },
          tenant_id: tenantId,
          status: CardStatus.ACTIVE,
          deleted_at: null,
        },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      if (!receiverCard) {
        throw new NotFoundException(
          `Receiver with phone ${dto.receiver_phone} not found in this restaurant`,
        );
      }

      // 5. –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å–∞–º–æ–º—É —Å–µ–±–µ
      if (senderCard.id === receiverCard.id) {
        throw new BadRequestException('Cannot transfer balls to yourself');
      }

      // 6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
      const verificationCode = this.generate6DigitCode();

      // 7. –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ –ø–µ—Ä–µ–≤–æ–¥–µ (—Å—Ç–∞—Ç—É—Å PENDING)
      const transfer = await tx.ballTransfer.create({
        data: {
          sender_card_id: dto.sender_card_id,
          receiver_card_id: receiverCard.id,
          amount: dto.amount,
          verification_code: verificationCode,
          status: TransferStatus.PENDING,
          tenant_id: tenantId,
        },
      });

      // 8. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–¥ –≤ Redis (TTL 10 –º–∏–Ω—É—Ç)
      await this.notificationService.saveTransferVerificationCode(
        transfer.id,
        verificationCode,
      );

      // 9. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º SMS —Å –∫–æ–¥–æ–º –Ω–∞ –Ω–æ–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
      await this.notificationService.sendSMS(
        senderCard.user.phone,
        `–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞ ${dto.amount} –±–∞–ª–ª–æ–≤: ${verificationCode}. –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 10 –º–∏–Ω—É—Ç.`,
      );

      // 10. –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω–∏—Ü–∏–∞—Ü–∏—é
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: userId,
        action_type: 'INITIATE_BALL_TRANSFER',
        entity_type: 'BALL_TRANSFER',
        entity_id: transfer.id,
        new_value: {
          sender_card_id: dto.sender_card_id,
          receiver_phone: dto.receiver_phone,
          amount: dto.amount,
        },
        description: `Initiated ball transfer: ${dto.amount} balls to ${dto.receiver_phone}`,
      }, tx);

      return {
        transfer_id: transfer.id,
        message: 'Verification code sent to your phone',
        expires_in: '10 minutes',
        receiver_name: `${receiverCard.user.guest_profile.first_name} ${receiverCard.user.guest_profile.last_name || ''}`.trim(),
      };
    });
  }

  /**
   * –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –±–∞–ª–ª–æ–≤ (—à–∞–≥ 2 - –≤–≤–æ–¥ SMS –∫–æ–¥–∞)
   */
  async confirmTransfer(dto: ConfirmBallTransferDto, tenantId: string, userId: string) {
    return this.prisma.$transaction(async (tx) => {
      // 1. –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–µ–≤–æ–¥
      const transfer = await tx.ballTransfer.findFirst({
        where: {
          id: dto.transfer_id,
          tenant_id: tenantId,
          status: TransferStatus.PENDING,
        },
        include: {
          sender_card: {
            include: {
              user: {
                include: {
                  guest_profile: true,
                },
              },
            },
          },
          receiver_card: {
            include: {
              user: {
                include: {
                  guest_profile: true,
                },
              },
            },
          },
        },
      });

      if (!transfer) {
        throw new NotFoundException('Transfer not found or already completed');
      }

      // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã-–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
      if (transfer.sender_card.user_id !== userId) {
        throw new ForbiddenException('Only sender can confirm the transfer');
      }

      // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ Redis
      const isValid = await this.notificationService.verifyTransferCode(
        transfer.id,
        dto.verification_code,
      );

      if (!isValid) {
        throw new BadRequestException('Invalid or expired verification code');
      }

      // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å –µ—â–µ —Ä–∞–∑ (–º–æ–≥–ª–æ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)
      if (transfer.sender_card.balance < transfer.amount) {
        throw new BadRequestException('Insufficient balance');
      }

      // 5. –°–ø–∏—Å—ã–≤–∞–µ–º –±–∞–ª–ª—ã —Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
      const senderBalanceBefore = transfer.sender_card.balance;
      const senderBalanceAfter = senderBalanceBefore - transfer.amount;

      await tx.guestCard.update({
        where: { id: transfer.sender_card_id },
        data: {
          balance: senderBalanceAfter,
          last_activity_at: new Date(),
        },
      });

      // 6. –ù–∞—á–∏—Å–ª—è–µ–º –±–∞–ª–ª—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—é
      const receiverBalanceBefore = transfer.receiver_card.balance;
      const receiverBalanceAfter = receiverBalanceBefore + transfer.amount;

      await tx.guestCard.update({
        where: { id: transfer.receiver_card_id },
        data: {
          balance: receiverBalanceAfter,
          last_activity_at: new Date(),
        },
      });

      // 7. –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
      await tx.ballTransaction.createMany({
        data: [
          // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (—Å–ø–∏—Å–∞–Ω–∏–µ)
          {
            guest_card_id: transfer.sender_card_id,
            tenant_id: tenantId,
            restaurant_id: transfer.sender_card.restaurant_id,
            type: BallTransactionType.TRANSFER_SENT,
            amount: -transfer.amount,
            balance_before: senderBalanceBefore,
            balance_after: senderBalanceAfter,
            description: `Transferred ${transfer.amount} balls to ${transfer.receiver_card.user.guest_profile.first_name}`,
          },
          // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ)
          {
            guest_card_id: transfer.receiver_card_id,
            tenant_id: tenantId,
            restaurant_id: transfer.receiver_card.restaurant_id,
            type: BallTransactionType.TRANSFER_RECEIVED,
            amount: transfer.amount,
            balance_before: receiverBalanceBefore,
            balance_after: receiverBalanceAfter,
            description: `Received ${transfer.amount} balls from ${transfer.sender_card.user.guest_profile.first_name}`,
          },
        ],
      });

      // 8. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞
      const completedTransfer = await tx.ballTransfer.update({
        where: { id: transfer.id },
        data: {
          status: TransferStatus.COMPLETED,
          is_verified: true,
          verified_at: new Date(),
          completed_at: new Date(),
        },
      });

      // 9. –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥—ã –¥–ª—è –æ–±–µ–∏—Ö –∫–∞—Ä—Ç
      await this.regenerateCodes(transfer.sender_card_id, tx);
      await this.regenerateCodes(transfer.receiver_card_id, tx);

      // 10. –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: userId,
        action_type: 'COMPLETE_BALL_TRANSFER',
        entity_type: 'BALL_TRANSFER',
        entity_id: transfer.id,
        new_value: {
          sender_balance_after: senderBalanceAfter,
          receiver_balance_after: receiverBalanceAfter,
          amount: transfer.amount,
        },
        description: `Completed ball transfer: ${transfer.amount} balls`,
      }, tx);

      // 11. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
      await this.notificationService.sendBallTransferSentNotification(
        transfer.sender_card.user,
        transfer.amount,
        senderBalanceAfter,
        transfer.receiver_card.user.guest_profile.first_name,
      );

      await this.notificationService.sendBallTransferReceivedNotification(
        transfer.receiver_card.user,
        transfer.amount,
        receiverBalanceAfter,
        transfer.sender_card.user.guest_profile.first_name,
      );

      return {
        message: 'Transfer completed successfully',
        sender_balance: senderBalanceAfter,
        receiver_balance: receiverBalanceAfter,
        amount_transferred: transfer.amount,
      };
    });
  }

  /**
   * –û—Ç–º–µ–Ω–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –±–∞–ª–ª–æ–≤ (–¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
   */
  async cancelTransfer(dto: CancelBallTransferDto, tenantId: string, userId: string) {
    return this.prisma.$transaction(async (tx) => {
      const transfer = await tx.ballTransfer.findFirst({
        where: {
          id: dto.transfer_id,
          tenant_id: tenantId,
          status: TransferStatus.PENDING,
        },
        include: {
          sender_card: true,
        },
      });

      if (!transfer) {
        throw new NotFoundException('Transfer not found or already completed');
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã-–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
      if (transfer.sender_card.user_id !== userId) {
        throw new ForbiddenException('Only sender can cancel the transfer');
      }

      // –û—Ç–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥
      const cancelled = await tx.ballTransfer.update({
        where: { id: transfer.id },
        data: {
          status: TransferStatus.CANCELLED,
        },
      });

      // –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–º–µ–Ω—É
      await this.activityLogService.log({
        tenant_id: tenantId,
        user_id: userId,
        action_type: 'CANCEL_BALL_TRANSFER',
        entity_type: 'BALL_TRANSFER',
        entity_id: transfer.id,
        description: 'Cancelled ball transfer',
      }, tx);

      return { message: 'Transfer cancelled successfully' };
    });
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è –≥–æ—Å—Ç—è
   */
  async getTransferHistory(userId: string, tenantId: string) {
    const transfers = await this.prisma.ballTransfer.findMany({
      where: {
        tenant_id: tenantId,
        OR: [
          {
            sender_card: {
              user_id: userId,
            },
          },
          {
            receiver_card: {
              user_id: userId,
            },
          },
        ],
        status: TransferStatus.COMPLETED,
      },
      orderBy: {
        completed_at: 'desc',
      },
      include: {
        sender_card: {
          include: {
            user: {
              include: {
                guest_profile: {
                  select: {
                    first_name: true,
                    last_name: true,
                  },
                },
              },
            },
          },
        },
        receiver_card: {
          include: {
            user: {
              include: {
                guest_profile: {
                  select: {
                    first_name: true,
                    last_name: true,
                  },
                },
              },
            },
          },
        },
      },
    });

    return transfers.map((transfer) => ({
      id: transfer.id,
      amount: transfer.amount,
      type: transfer.sender_card.user_id === userId ? 'sent' : 'received',
      counterparty_name:
        transfer.sender_card.user_id === userId
          ? `${transfer.receiver_card.user.guest_profile.first_name} ${transfer.receiver_card.user.guest_profile.last_name || ''}`.trim()
          : `${transfer.sender_card.user.guest_profile.first_name} ${transfer.sender_card.user.guest_profile.last_name || ''}`.trim(),
      completed_at: transfer.completed_at,
    }));
  }

  // ============================================
  // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
  // ============================================

  private generate6DigitCode(): string {
    return Math.floor(100000 + Math.random() * 900000).toString();
  }

  private async regenerateCodes(guestCardId: string, tx: any) {
    const newQRCode = `QR_${crypto.randomBytes(16).toString('hex')}`;
    const new6DigitCode = this.generate6DigitCode();

    return tx.guestCard.update({
      where: { id: guestCardId },
      data: {
        qr_code: newQRCode,
        code_6_digit: new6DigitCode,
      },
    });
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/services/registration-link.service.ts
// ============================================

import { Injectable, NotFoundException, BadRequestException } from '@nestjs/common';
import { PrismaService } from '@/database/prisma.service';
import { ActivityLogService } from '@/modules/activity-log/activity-log.service';
import {
  CreateRegistrationLinkDto,
  DeactivateRegistrationLinkDto,
} from '../dto';
import * as crypto from 'crypto';

@Injectable()
export class RegistrationLinkService {
  constructor(
    private prisma: PrismaService,
    private activityLogService: ActivityLogService,
  ) {}

  // ============================================
  // –°–û–ó–î–ê–ù–ò–ï –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–°–´–õ–ö–ê–ú–ò
  // ============================================

  /**
   * –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Å—Ç–µ–π
   */
  async createLink(dto: CreateRegistrationLinkDto, tenantId: string, createdByUserId: string) {
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
    const token = this.generateToken();

    // –§–æ—Ä–º–∏—Ä—É–µ–º URL
    const baseUrl = process.env.FRONTEND_URL || 'https://loyalty.max.ru';
    const url = `${baseUrl}/register?token=${token}`;

    const link = await this.prisma.registrationLink.create({
      data: {
        tenant_id: tenantId,
        restaurant_id: dto.restaurant_id,
        token,
        url,
        total_uses: 0,
        created_by_user_id: createdByUserId,
        is_active: true,
      },
    });

    // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ
    await this.activityLogService.log({
      tenant_id: tenantId,
      user_id: createdByUserId,
      action_type: 'CREATE_REGISTRATION_LINK',
      entity_type: 'REGISTRATION_LINK',
      entity_id: link.id,
      new_value: {
        url: link.url,
        restaurant_id: dto.restaurant_id,
      },
      description: `Created registration link: ${link.url}`,
    });

    return link;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –ø–æ —Ç–æ–∫–µ–Ω—É
   */
  async getLinkByToken(token: string) {
    const link = await this.prisma.registrationLink.findUnique({
      where: { token },
      include: {
        restaurant: {
          select: {
            id: true,
            name: true,
          },
        },
        tenant: {
          select: {
            id: true,
            name: true,
          },
        },
      },
    });

    if (!link) {
      throw new NotFoundException('Registration link not found');
    }

    if (!link.is_active) {
      throw new BadRequestException('Registration link is inactive');
    }

    return link;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫ —Ç–µ–Ω–∞–Ω—Ç–∞
   */
  async getLinks(tenantId: string, restaurantId?: string) {
    const where: any = {
      tenant_id: tenantId,
    };

    if (restaurantId) {
      where.restaurant_id = restaurantId;
    }

    const links = await this.prisma.registrationLink.findMany({
      where,
      orderBy: {
        created_at: 'desc',
      },
      include: {
        restaurant: {
          select: {
            id: true,
            name: true,
          },
        },
        created_by: {
          select: {
            id: true,
            guest_profile: {
              select: {
                first_name: true,
                last_name: true,
              },
            },
          },
        },
      },
    });

    return links;
  }

  /**
   * –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏
   */
  async deactivateLink(dto: DeactivateRegistrationLinkDto, tenantId: string, deactivatedByUserId: string) {
    const link = await this.prisma.registrationLink.findFirst({
      where: {
        id: dto.link_id,
        tenant_id: tenantId,
      },
    });

    if (!link) {
      throw new NotFoundException('Registration link not found');
    }

    const deactivated = await this.prisma.registrationLink.update({
      where: { id: dto.link_id },
      data: {
        is_active: false,
      },
    });

    // –õ–æ–≥–∏—Ä—É–µ–º –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é
    await this.activityLogService.log({
      tenant_id: tenantId,
      user_id: deactivatedByUserId,
      action_type: 'DEACTIVATE_REGISTRATION_LINK',
      entity_type: 'REGISTRATION_LINK',
      entity_id: link.id,
      old_value: { is_active: true },
      new_value: { is_active: false },
      description: `Deactivated registration link: ${link.url}`,
    });

    return deactivated;
  }

  /**
   * –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏
   */
  async activateLink(linkId: string, tenantId: string, activatedByUserId: string) {
    const link = await this.prisma.registrationLink.findFirst({
      where: {
        id: linkId,
        tenant_id: tenantId,
      },
    });

    if (!link) {
      throw new NotFoundException('Registration link not found');
    }

    const activated = await this.prisma.registrationLink.update({
      where: { id: linkId },
      data: {
        is_active: true,
      },
    });

    // –õ–æ–≥–∏—Ä—É–µ–º –∞–∫—Ç–∏–≤–∞—Ü–∏—é
    await this.activityLogService.log({
      tenant_id: tenantId,
      user_id: activatedByUserId,
      action_type: 'ACTIVATE_REGISTRATION_LINK',
      entity_type: 'REGISTRATION_LINK',
      entity_id: link.id,
      old_value: { is_active: false },
      new_value: { is_active: true },
      description: `Activated registration link: ${link.url}`,
    });

    return activated;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–µ
   */
  async getLinkStats(linkId: string, tenantId: string) {
    const link = await this.prisma.registrationLink.findFirst({
      where: {
        id: linkId,
        tenant_id: tenantId,
      },
      include: {
        guest_cards: {
          where: {
            deleted_at: null,
          },
          include: {
            user: {
              include: {
                guest_profile: {
                  select: {
                    first_name: true,
                    last_name: true,
                  },
                },
              },
            },
          },
        },
      },
    });

    if (!link) {
      throw new NotFoundException('Registration link not found');
    }

    const activeGuests = link.guest_cards.filter((card) => card.status === 'ACTIVE').length;
    const blockedGuests = link.guest_cards.filter((card) => card.status === 'BLOCKED').length;

    return {
      link_id: link.id,
      url: link.url,
      total_uses: link.total_uses,
      total_guests_registered: link.guest_cards.length,
      active_guests: activeGuests,
      blocked_guests: blockedGuests,
      is_active: link.is_active,
      created_at: link.created_at,
      recent_registrations: link.guest_cards
        .slice(0, 10)
        .map((card) => ({
          guest_name: `${card.user.guest_profile.first_name} ${card.user.guest_profile.last_name || ''}`.trim(),
          phone: card.user.phone,
          registered_at: card.created_at,
          status: card.status,
        })),
    };
  }

  // ============================================
  // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
  // ============================================

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
   */
  private generateToken(): string {
    return crypto.randomBytes(32).toString('hex');
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/services/guest-visit.service.ts
// ============================================

import { Injectable } from '@nestjs/common';
import { PrismaService } from '@/database/prisma.service';
import { GetGuestVisitsQueryDto } from '../dto';

@Injectable()
export class GuestVisitService {
  constructor(private prisma: PrismaService) {}

  /**
   * –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ –ø–æ—Å–µ—â–µ–Ω–∏–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —á–µ–∫–∞)
   */
  async createVisit(data: {
    guestCardId: string;
    tenantId: string;
    restaurantId: string;
    checkAmount: number;
    itemsOrdered?: any;
    paymentMethod?: string;
    cashierUserId?: string;
    posTransactionId?: string;
  }) {
    const visit = await this.prisma.guestVisit.create({
      data: {
        guest_card_id: data.guestCardId,
        tenant_id: data.tenantId,
        restaurant_id: data.restaurantId,
        check_amount: data.checkAmount,
        items_ordered: data.itemsOrdered,
        payment_method: data.paymentMethod,
        cashier_user_id: data.cashierUserId,
        pos_transaction_id: data.posTransactionId,
        visit_date: new Date(),
      },
    });

    return visit;
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π –≥–æ—Å—Ç—è
   */
  async getVisits(query: GetGuestVisitsQueryDto, tenantId: string) {
    const {
      guest_card_id,
      restaurant_id,
      date_from,
      date_to,
      page = 1,
      limit = 30,
    } = query;

    const skip = (page - 1) * limit;

    const where: any = {
      tenant_id: tenantId,
    };

    if (guest_card_id) {
      where.guest_card_id = guest_card_id;
    }

    if (restaurant_id) {
      where.restaurant_id = restaurant_id;
    }

    if (date_from || date_to) {
      where.visit_date = {};
      if (date_from) where.visit_date.gte = new Date(date_from);
      if (date_to) where.visit_date.lte = new Date(date_to);
    }

    const [visits, total] = await Promise.all([
      this.prisma.guestVisit.findMany({
        where,
        skip,
        take: limit,
        orderBy: { visit_date: 'desc' },
        include: {
          restaurant: {
            select: {
              id: true,
              name: true,
            },
          },
          cashier: {
            select: {
              id: true,
              guest_profile: {
                select: {
                  first_name: true,
                  last_name: true,
                },
              },
            },
          },
        },
      }),
      this.prisma.guestVisit.count({ where }),
    ]);

    return {
      data: visits,
      total,
      page,
      limit,
      total_pages: Math.ceil(total / limit),
    };
  }

  /**
   * –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π –≥–æ—Å—Ç—è (–¥–ª—è Telegram mini app)
   * –ü–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π
   */
  async getRecentVisits(guestCardId: string) {
    const ninetyDaysAgo = new Date();
    ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);

    const visits = await this.prisma.guestVisit.findMany({
      where: {
        guest_card_id: guestCardId,
        visit_date: {
          gte: ninetyDaysAgo,
        },
      },
      orderBy: {
        visit_date: 'desc',
      },
      include: {
        restaurant: {
          select: {
            id: true,
            name: true,
          },
        },
      },
    });

    return visits;
  }
}
```


***

‚úÖ **–í–°–ï SERVICES –ì–û–¢–û–í–´!**

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—é **CONTROLLERS** (API endpoints)? üöÄ

---

# –î–∞–≤–∞–π

```typescript
// ============================================
// apps/backend/src/modules/guests/controllers/guest.controller.ts
// ============================================

import {
  Controller,
  Get,
  Post,
  Put,
  Delete,
  Body,
  Param,
  Query,
  UseGuards,
  HttpCode,
  HttpStatus,
} from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';
import { GuestService } from '../services/guest.service';
import {
  CreateGuestDto,
  CreateGuestPOSDto,
  CreateGuestLinkDto,
  CreateGuestTelegramDto,
  UpdateGuestProfileDto,
  RequestPhoneChangeDto,
  ConfirmPhoneChangeDto,
  AddChildDto,
  UpdateChildDto,
  GetGuestsQueryDto,
  GetCardByQRDto,
  GetCardBy6DigitDto,
  GetCardByPhoneDto,
  GuestCardResponseDto,
  GuestsListResponseDto,
  GuestRegistrationResponseDto,
} from '../dto';
import { JwtGuard } from '@/modules/auth/guards/jwt.guard';
import { RoleGuard } from '@/modules/rbac/guards/role.guard';
import { PermissionGuard } from '@/modules/rbac/guards/permission.guard';
import { HasRole } from '@/modules/rbac/decorators/has-role.decorator';
import { HasPermission } from '@/modules/rbac/decorators/has-permission.decorator';
import { CurrentUser } from '@/modules/auth/decorators/current-user.decorator';
import { CurrentTenant } from '@/modules/tenants/decorators/current-tenant.decorator';

@ApiTags('Guests')
@Controller('guests')
export class GuestController {
  constructor(private readonly guestService: GuestService) {}

  // ============================================
  // –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ì–û–°–¢–ï–ô
  // ============================================

  @Post('register')
  @ApiOperation({ summary: 'Register a new guest (universal)' })
  @ApiResponse({ status: 201, description: 'Guest registered successfully', type: GuestRegistrationResponseDto })
  async registerGuest(@Body() dto: CreateGuestDto) {
    const guestCard = await this.guestService.createGuest(dto);
    
    return {
      success: true,
      message: 'Guest registered successfully',
      guest_card: guestCard,
    };
  }

  @Post('register/pos')
  @UseGuards(JwtGuard, RoleGuard, PermissionGuard)
  @HasRole('CASHIER', 'MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('create:guest')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Register guest via POS (by cashier)' })
  @ApiResponse({ status: 201, description: 'Guest registered via POS' })
  async registerGuestPOS(
    @Body() dto: CreateGuestPOSDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    const guestCard = await this.guestService.createGuestPOS(dto, tenantId, userId);
    
    return {
      success: true,
      message: '–í–∞—à–∞ –∫–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –Ω–∞–∑–æ–≤–∏—Ç–µ –µ–≥–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—É.',
      guest_card: guestCard,
    };
  }

  @Post('register/link')
  @ApiOperation({ summary: 'Register guest via registration link' })
  @ApiResponse({ status: 201, description: 'Guest registered via link' })
  async registerGuestByLink(@Body() dto: CreateGuestLinkDto) {
    const guestCard = await this.guestService.createGuestByLink(dto);
    
    return {
      success: true,
      message: '–í–∞—à–∞ –∫–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! –¢–µ–ø–µ—Ä—å –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –Ω–∞–∑–æ–≤–∏—Ç–µ –µ–≥–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—É.',
      guest_card: guestCard,
    };
  }

  @Post('register/telegram')
  @ApiOperation({ summary: 'Register guest via Telegram bot' })
  @ApiResponse({ status: 201, description: 'Guest registered via Telegram' })
  async registerGuestTelegram(@Body() dto: CreateGuestTelegramDto) {
    const guestCard = await this.guestService.createGuestTelegram(dto);
    
    return {
      success: true,
      message: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í–∞—à–∞ –∫–∞—Ä—Ç–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∞.',
      guest_card: guestCard,
      telegram_bot_link: `https://t.me/${process.env.TELEGRAM_BOT_USERNAME}`,
    };
  }

  // ============================================
  // –ü–û–õ–£–ß–ï–ù–ò–ï –ì–û–°–¢–ï–ô
  // ============================================

  @Get()
  @UseGuards(JwtGuard, RoleGuard, PermissionGuard)
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('read:guest')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Get list of guests with filters and pagination' })
  @ApiResponse({ status: 200, description: 'List of guests', type: GuestsListResponseDto })
  async getGuests(
    @Query() query: GetGuestsQueryDto,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestService.getGuests(query, tenantId);
  }

  @Get(':id')
  @UseGuards(JwtGuard, RoleGuard, PermissionGuard)
  @HasRole('MANAGER', 'RESTAURANT_ADMIN', 'GUEST')
  @HasPermission('read:guest')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Get guest by ID' })
  @ApiResponse({ status: 200, description: 'Guest details', type: GuestCardResponseDto })
  async getGuestById(
    @Param('id') id: string,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestService.getGuestById(id, tenantId);
  }

  @Post('by-qr')
  @ApiOperation({ summary: 'Get guest card by QR code' })
  @ApiResponse({ status: 200, description: 'Guest card', type: GuestCardResponseDto })
  async getGuestByQR(@Body() dto: GetCardByQRDto) {
    return this.guestService.getGuestByQRCode(dto.qr_code);
  }

  @Post('by-code')
  @ApiOperation({ summary: 'Get guest card by 6-digit code' })
  @ApiResponse({ status: 200, description: 'Guest card', type: GuestCardResponseDto })
  async getGuestBy6Digit(@Body() dto: GetCardBy6DigitDto) {
    return this.guestService.getGuestBy6DigitCode(dto.code_6_digit);
  }

  @Post('by-phone')
  @UseGuards(JwtGuard, RoleGuard)
  @HasRole('CASHIER', 'MANAGER', 'RESTAURANT_ADMIN')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Get guest card by phone number (for cashiers)' })
  @ApiResponse({ status: 200, description: 'Guest card', type: GuestCardResponseDto })
  async getGuestByPhone(
    @Body() dto: GetCardByPhoneDto,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestService.getGuestByPhone(dto.phone, tenantId, dto.restaurant_id);
  }

  // ============================================
  // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–§–ò–õ–Ø –ì–û–°–¢–Ø
  // ============================================

  @Put('profile')
  @UseGuards(JwtGuard, RoleGuard)
  @HasRole('GUEST')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Update guest profile (once every 3 months)' })
  @ApiResponse({ status: 200, description: 'Profile updated successfully' })
  async updateProfile(
    @Body() dto: UpdateGuestProfileDto,
    @CurrentUser('id') userId: string,
  ) {
    return this.guestService.updateGuestProfile(userId, dto);
  }

  @Post('profile/change-phone/request')
  @UseGuards(JwtGuard, RoleGuard)
  @HasRole('GUEST')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Request phone number change (step 1 - send SMS)' })
  @ApiResponse({ status: 200, description: 'Verification code sent' })
  async requestPhoneChange(
    @Body() dto: RequestPhoneChangeDto,
    @CurrentUser('id') userId: string,
  ) {
    return this.guestService.requestPhoneChange(userId, dto);
  }

  @Post('profile/change-phone/confirm')
  @UseGuards(JwtGuard, RoleGuard)
  @HasRole('GUEST')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Confirm phone number change (step 2 - verify code)' })
  @ApiResponse({ status: 200, description: 'Phone number changed successfully' })
  async confirmPhoneChange(
    @Body() dto: ConfirmPhoneChangeDto,
    @CurrentUser('id') userId: string,
  ) {
    return this.guestService.confirmPhoneChange(userId, dto);
  }

  // ============================================
  // –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ï–¢–¨–ú–ò
  // ============================================

  @Post('children')
  @UseGuards(JwtGuard, RoleGuard)
  @HasRole('GUEST')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Add child to guest profile (max 3)' })
  @ApiResponse({ status: 201, description: 'Child added successfully' })
  async addChild(
    @Body() dto: AddChildDto,
    @CurrentUser('id') userId: string,
  ) {
    return this.guestService.addChild(userId, dto);
  }

  @Put('children/:childId')
  @UseGuards(JwtGuard, RoleGuard)
  @HasRole('GUEST')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Update child information' })
  @ApiResponse({ status: 200, description: 'Child updated successfully' })
  async updateChild(
    @Param('childId') childId: string,
    @Body() dto: UpdateChildDto,
    @CurrentUser('id') userId: string,
  ) {
    return this.guestService.updateChild(userId, childId, dto);
  }

  @Delete('children/:childId')
  @UseGuards(JwtGuard, RoleGuard)
  @HasRole('GUEST')
  @ApiBearerAuth()
  @ApiOperation({ summary: 'Delete child from guest profile' })
  @ApiResponse({ status: 200, description: 'Child deleted successfully' })
  @HttpCode(HttpStatus.OK)
  async deleteChild(
    @Param('childId') childId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.guestService.deleteChild(userId, childId);
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/controllers/guest-card.controller.ts
// ============================================

import {
  Controller,
  Post,
  Put,
  Body,
  UseGuards,
  HttpCode,
  HttpStatus,
} from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';
import { GuestCardService } from '../services/guest-card.service';
import {
  BlockGuestCardDto,
  UnblockGuestCardDto,
  DeleteGuestCardDto,
  RestoreGuestCardDto,
} from '../dto';
import { JwtGuard } from '@/modules/auth/guards/jwt.guard';
import { RoleGuard } from '@/modules/rbac/guards/role.guard';
import { PermissionGuard } from '@/modules/rbac/guards/permission.guard';
import { HasRole } from '@/modules/rbac/decorators/has-role.decorator';
import { HasPermission } from '@/modules/rbac/decorators/has-permission.decorator';
import { CurrentUser } from '@/modules/auth/decorators/current-user.decorator';
import { CurrentTenant } from '@/modules/tenants/decorators/current-tenant.decorator';

@ApiTags('Guest Cards')
@Controller('guest-cards')
@UseGuards(JwtGuard, RoleGuard, PermissionGuard)
@ApiBearerAuth()
export class GuestCardController {
  constructor(private readonly guestCardService: GuestCardService) {}

  // ============================================
  // –ë–õ–û–ö–ò–†–û–í–ö–ê –ò –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ê
  // ============================================

  @Post('block')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:guest_card')
  @ApiOperation({ summary: 'Block guest card' })
  @ApiResponse({ status: 200, description: 'Card blocked successfully' })
  async blockCard(
    @Body() dto: BlockGuestCardDto,
    @CurrentUser('id') userId: string,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestCardService.blockCard(dto, userId, tenantId);
  }

  @Post('unblock')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:guest_card')
  @ApiOperation({ summary: 'Unblock guest card' })
  @ApiResponse({ status: 200, description: 'Card unblocked successfully' })
  async unblockCard(
    @Body() dto: UnblockGuestCardDto,
    @CurrentUser('id') userId: string,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestCardService.unblockCard(dto, userId, tenantId);
  }

  // ============================================
  // –£–î–ê–õ–ï–ù–ò–ï –ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï
  // ============================================

  @Post('delete')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN', 'OWNER', 'GUEST')
  @HasPermission('manage:guest_card')
  @ApiOperation({ summary: 'Delete guest card (soft delete)' })
  @ApiResponse({ status: 200, description: 'Card deleted successfully' })
  @HttpCode(HttpStatus.OK)
  async deleteCard(
    @Body() dto: DeleteGuestCardDto,
    @CurrentUser('id') userId: string,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestCardService.deleteCard(dto, userId, tenantId);
  }

  @Post('restore')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN', 'OWNER')
  @HasPermission('manage:guest_card')
  @ApiOperation({ summary: 'Restore deleted guest card (balance NOT restored, only level)' })
  @ApiResponse({ status: 200, description: 'Card restored successfully' })
  async restoreCard(
    @Body() dto: RestoreGuestCardDto,
    @CurrentUser('id') userId: string,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestCardService.restoreCard(dto, userId, tenantId);
  }

  // ============================================
  // GDPR - –ó–ê–ü–†–û–° –ù–ê –£–î–ê–õ–ï–ù–ò–ï –î–ê–ù–ù–´–•
  // ============================================

  @Post('request-data-deletion')
  @HasRole('GUEST')
  @ApiOperation({ summary: 'Request complete data deletion (GDPR)' })
  @ApiResponse({ status: 200, description: 'All data deleted successfully' })
  @HttpCode(HttpStatus.OK)
  async requestDataDeletion(@CurrentUser('id') userId: string) {
    return this.guestCardService.requestDataDeletion(userId);
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/controllers/ball-transaction.controller.ts
// ============================================

import {
  Controller,
  Get,
  Post,
  Body,
  Query,
  UseGuards,
  HttpCode,
  HttpStatus,
} from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';
import { BallTransactionService } from '../services/ball-transaction.service';
import {
  EarnBallsDto,
  RedeemBallsDto,
  ManualAddBallsDto,
  ManualSubtractBallsDto,
  CancelBallTransactionDto,
  GetBallTransactionsQueryDto,
  BallTransactionResponseDto,
} from '../dto';
import { JwtGuard } from '@/modules/auth/guards/jwt.guard';
import { RoleGuard } from '@/modules/rbac/guards/role.guard';
import { PermissionGuard } from '@/modules/rbac/guards/permission.guard';
import { HasRole } from '@/modules/rbac/decorators/has-role.decorator';
import { HasPermission } from '@/modules/rbac/decorators/has-permission.decorator';
import { CurrentUser } from '@/modules/auth/decorators/current-user.decorator';
import { CurrentTenant } from '@/modules/tenants/decorators/current-tenant.decorator';

@ApiTags('Ball Transactions')
@Controller('balls')
@UseGuards(JwtGuard, RoleGuard, PermissionGuard)
@ApiBearerAuth()
export class BallTransactionController {
  constructor(private readonly ballTransactionService: BallTransactionService) {}

  // ============================================
  // –ù–ê–ß–ò–°–õ–ï–ù–ò–ï –ë–ê–õ–õ–û–í
  // ============================================

  @Post('earn')
  @HasRole('CASHIER', 'MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:balls_pos')
  @ApiOperation({ summary: 'Earn balls from purchase (via POS or manual)' })
  @ApiResponse({ status: 201, description: 'Balls earned successfully', type: BallTransactionResponseDto })
  async earnBalls(
    @Body() dto: EarnBallsDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransactionService.earnBalls(dto, tenantId, userId);
  }

  @Post('manual-add')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:balls_manual')
  @ApiOperation({ summary: 'Manually add balls (Manager/Admin only, reason required)' })
  @ApiResponse({ status: 201, description: 'Balls added successfully', type: BallTransactionResponseDto })
  async manualAddBalls(
    @Body() dto: ManualAddBallsDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransactionService.manualAddBalls(dto, tenantId, userId);
  }

  // ============================================
  // –°–ü–ò–°–ê–ù–ò–ï –ë–ê–õ–õ–û–í
  // ============================================

  @Post('redeem')
  @HasRole('CASHIER', 'MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:balls_pos')
  @ApiOperation({ summary: 'Redeem balls for discount on check' })
  @ApiResponse({ status: 201, description: 'Balls redeemed successfully', type: BallTransactionResponseDto })
  async redeemBalls(
    @Body() dto: RedeemBallsDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransactionService.redeemBalls(dto, tenantId, userId);
  }

  @Post('manual-subtract')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:balls_manual')
  @ApiOperation({ summary: 'Manually subtract balls (Manager/Admin only, reason required)' })
  @ApiResponse({ status: 201, description: 'Balls subtracted successfully', type: BallTransactionResponseDto })
  async manualSubtractBalls(
    @Body() dto: ManualSubtractBallsDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransactionService.manualSubtractBalls(dto, tenantId, userId);
  }

  // ============================================
  // –û–¢–ú–ï–ù–ê –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
  // ============================================

  @Post('cancel')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:balls_manual')
  @ApiOperation({ summary: 'Cancel ball transaction (restore balance)' })
  @ApiResponse({ status: 200, description: 'Transaction cancelled successfully' })
  @HttpCode(HttpStatus.OK)
  async cancelTransaction(
    @Body() dto: CancelBallTransactionDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransactionService.cancelTransaction(dto, tenantId, userId);
  }

  // ============================================
  // –ü–û–õ–£–ß–ï–ù–ò–ï –ò–°–¢–û–†–ò–ò –¢–†–ê–ù–ó–ê–ö–¶–ò–ô
  // ============================================

  @Get('transactions')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN', 'GUEST')
  @HasPermission('read:balls')
  @ApiOperation({ summary: 'Get ball transaction history with filters' })
  @ApiResponse({ status: 200, description: 'Transaction history' })
  async getTransactions(
    @Query() query: GetBallTransactionsQueryDto,
    @CurrentTenant() tenantId: string,
  ) {
    return this.ballTransactionService.getTransactions(query, tenantId);
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/controllers/ball-transfer.controller.ts
// ============================================

import {
  Controller,
  Get,
  Post,
  Body,
  UseGuards,
  HttpCode,
  HttpStatus,
} from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';
import { BallTransferService } from '../services/ball-transfer.service';
import {
  InitiateBallTransferDto,
  ConfirmBallTransferDto,
  CancelBallTransferDto,
} from '../dto';
import { JwtGuard } from '@/modules/auth/guards/jwt.guard';
import { RoleGuard } from '@/modules/rbac/guards/role.guard';
import { HasRole } from '@/modules/rbac/decorators/has-role.decorator';
import { CurrentUser } from '@/modules/auth/decorators/current-user.decorator';
import { CurrentTenant } from '@/modules/tenants/decorators/current-tenant.decorator';

@ApiTags('Ball Transfer')
@Controller('balls/transfer')
@UseGuards(JwtGuard, RoleGuard)
@HasRole('GUEST')
@ApiBearerAuth()
export class BallTransferController {
  constructor(private readonly ballTransferService: BallTransferService) {}

  // ============================================
  // –ü–ï–†–ï–í–û–î –ë–ê–õ–õ–û–í
  // ============================================

  @Post('initiate')
  @ApiOperation({ summary: 'Initiate ball transfer (step 1 - send SMS verification code)' })
  @ApiResponse({ status: 201, description: 'Verification code sent' })
  async initiateTransfer(
    @Body() dto: InitiateBallTransferDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransferService.initiateTransfer(dto, tenantId, userId);
  }

  @Post('confirm')
  @ApiOperation({ summary: 'Confirm ball transfer (step 2 - verify SMS code and complete transfer)' })
  @ApiResponse({ status: 200, description: 'Transfer completed successfully' })
  @HttpCode(HttpStatus.OK)
  async confirmTransfer(
    @Body() dto: ConfirmBallTransferDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransferService.confirmTransfer(dto, tenantId, userId);
  }

  @Post('cancel')
  @ApiOperation({ summary: 'Cancel pending ball transfer' })
  @ApiResponse({ status: 200, description: 'Transfer cancelled successfully' })
  @HttpCode(HttpStatus.OK)
  async cancelTransfer(
    @Body() dto: CancelBallTransferDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.ballTransferService.cancelTransfer(dto, tenantId, userId);
  }

  // ============================================
  // –ò–°–¢–û–†–ò–Ø –ü–ï–†–ï–í–û–î–û–í
  // ============================================

  @Get('history')
  @ApiOperation({ summary: 'Get transfer history for current guest' })
  @ApiResponse({ status: 200, description: 'Transfer history' })
  async getTransferHistory(
    @CurrentUser('id') userId: string,
    @CurrentTenant() tenantId: string,
  ) {
    return this.ballTransferService.getTransferHistory(userId, tenantId);
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/controllers/registration-link.controller.ts
// ============================================

import {
  Controller,
  Get,
  Post,
  Put,
  Body,
  Param,
  Query,
  UseGuards,
  HttpCode,
  HttpStatus,
} from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';
import { RegistrationLinkService } from '../services/registration-link.service';
import {
  CreateRegistrationLinkDto,
  DeactivateRegistrationLinkDto,
} from '../dto';
import { JwtGuard } from '@/modules/auth/guards/jwt.guard';
import { RoleGuard } from '@/modules/rbac/guards/role.guard';
import { PermissionGuard } from '@/modules/rbac/guards/permission.guard';
import { HasRole } from '@/modules/rbac/decorators/has-role.decorator';
import { HasPermission } from '@/modules/rbac/decorators/has-permission.decorator';
import { CurrentUser } from '@/modules/auth/decorators/current-user.decorator';
import { CurrentTenant } from '@/modules/tenants/decorators/current-tenant.decorator';

@ApiTags('Registration Links')
@Controller('registration-links')
@UseGuards(JwtGuard, RoleGuard, PermissionGuard)
@ApiBearerAuth()
export class RegistrationLinkController {
  constructor(private readonly registrationLinkService: RegistrationLinkService) {}

  // ============================================
  // –°–û–ó–î–ê–ù–ò–ï –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–°–´–õ–ö–ê–ú–ò
  // ============================================

  @Post()
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:registration_links')
  @ApiOperation({ summary: 'Create registration link for guests' })
  @ApiResponse({ status: 201, description: 'Link created successfully' })
  async createLink(
    @Body() dto: CreateRegistrationLinkDto,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.registrationLinkService.createLink(dto, tenantId, userId);
  }

  @Get()
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('read:registration_links')
  @ApiOperation({ summary: 'Get all registration links for tenant' })
  @ApiResponse({ status: 200, description: 'List of registration links' })
  async getLinks(
    @CurrentTenant() tenantId: string,
    @Query('restaurant_id') restaurantId?: string,
  ) {
    return this.registrationLinkService.getLinks(tenantId, restaurantId);
  }

  @Get('token/:token')
  @ApiOperation({ summary: 'Get registration link by token (public endpoint)' })
  @ApiResponse({ status: 200, description: 'Registration link details' })
  async getLinkByToken(@Param('token') token: string) {
    return this.registrationLinkService.getLinkByToken(token);
  }

  @Get(':linkId/stats')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('read:registration_links')
  @ApiOperation({ summary: 'Get registration link statistics' })
  @ApiResponse({ status: 200, description: 'Link statistics' })
  async getLinkStats(
    @Param('linkId') linkId: string,
    @CurrentTenant() tenantId: string,
  ) {
    return this.registrationLinkService.getLinkStats(linkId, tenantId);
  }

  @Put(':linkId/deactivate')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:registration_links')
  @ApiOperation({ summary: 'Deactivate registration link' })
  @ApiResponse({ status: 200, description: 'Link deactivated successfully' })
  async deactivateLink(
    @Param('linkId') linkId: string,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.registrationLinkService.deactivateLink(
      { link_id: linkId },
      tenantId,
      userId,
    );
  }

  @Put(':linkId/activate')
  @HasRole('MANAGER', 'RESTAURANT_ADMIN')
  @HasPermission('manage:registration_links')
  @ApiOperation({ summary: 'Activate registration link' })
  @ApiResponse({ status: 200, description: 'Link activated successfully' })
  async activateLink(
    @Param('linkId') linkId: string,
    @CurrentTenant() tenantId: string,
    @CurrentUser('id') userId: string,
  ) {
    return this.registrationLinkService.activateLink(linkId, tenantId, userId);
  }
}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/controllers/guest-visit.controller.ts
// ============================================

import {
  Controller,
  Get,
  Query,
  UseGuards,
} from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';
import { GuestVisitService } from '../services/guest-visit.service';
import { GetGuestVisitsQueryDto, GuestVisitResponseDto } from '../dto';
import { JwtGuard } from '@/modules/auth/guards/jwt.guard';
import { RoleGuard } from '@/modules/rbac/guards/role.guard';
import { PermissionGuard } from '@/modules/rbac/guards/permission.guard';
import { HasRole } from '@/modules/rbac/decorators/has-role.decorator';
import { HasPermission } from '@/modules/rbac/decorators/has-permission.decorator';
import { CurrentTenant } from '@/modules/tenants/decorators/current-tenant.decorator';

@ApiTags('Guest Visits')
@Controller('visits')
@UseGuards(JwtGuard, RoleGuard, PermissionGuard)
@ApiBearerAuth()
export class GuestVisitController {
  constructor(private readonly guestVisitService: GuestVisitService) {}

  @Get()
  @HasRole('MANAGER', 'RESTAURANT_ADMIN', 'GUEST')
  @HasPermission('read:guest_visits')
  @ApiOperation({ summary: 'Get visit history with filters' })
  @ApiResponse({ status: 200, description: 'Visit history', type: [GuestVisitResponseDto] })
  async getVisits(
    @Query() query: GetGuestVisitsQueryDto,
    @CurrentTenant() tenantId: string,
  ) {
    return this.guestVisitService.getVisits(query, tenantId);
  }
}
```


***

‚úÖ **–í–°–ï CONTROLLERS –ì–û–¢–û–í–´!**

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—é **MODULE** (—Å–≤—è–∑—ã–≤–∞–µ–º –≤—Å–µ –≤–º–µ—Å—Ç–µ)? üöÄ

---

# –î–∞–≤–∞–π

```typescript
// ============================================
// apps/backend/src/modules/guests/guests.module.ts
// ============================================

import { Module } from '@nestjs/common';
import { PrismaModule } from '@/database/prisma.module';
import { ActivityLogModule } from '@/modules/activity-log/activity-log.module';
import { NotificationModule } from '@/modules/notifications/notification.module';
import { LoyaltyModule } from '@/modules/loyalty/loyalty.module';

// Services
import { GuestService } from './services/guest.service';
import { GuestCardService } from './services/guest-card.service';
import { BallTransactionService } from './services/ball-transaction.service';
import { BallTransferService } from './services/ball-transfer.service';
import { RegistrationLinkService } from './services/registration-link.service';
import { GuestVisitService } from './services/guest-visit.service';

// Controllers
import { GuestController } from './controllers/guest.controller';
import { GuestCardController } from './controllers/guest-card.controller';
import { BallTransactionController } from './controllers/ball-transaction.controller';
import { BallTransferController } from './controllers/ball-transfer.controller';
import { RegistrationLinkController } from './controllers/registration-link.controller';
import { GuestVisitController } from './controllers/guest-visit.controller';

@Module({
  imports: [
    PrismaModule,
    ActivityLogModule,
    NotificationModule,
    LoyaltyModule,
  ],
  controllers: [
    GuestController,
    GuestCardController,
    BallTransactionController,
    BallTransferController,
    RegistrationLinkController,
    GuestVisitController,
  ],
  providers: [
    GuestService,
    GuestCardService,
    BallTransactionService,
    BallTransferService,
    RegistrationLinkService,
    GuestVisitService,
  ],
  exports: [
    GuestService,
    GuestCardService,
    BallTransactionService,
    BallTransferService,
    RegistrationLinkService,
    GuestVisitService,
  ],
})
export class GuestsModule {}
```


***

```typescript
// ============================================
// apps/backend/src/modules/guests/index.ts
// ============================================

export * from './guests.module';

// DTOs
export * from './dto';

// Services
export * from './services/guest.service';
export * from './services/guest-card.service';
export * from './services/ball-transaction.service';
export * from './services/ball-transfer.service';
export * from './services/registration-link.service';
export * from './services/guest-visit.service';

// Controllers
export * from './controllers/guest.controller';
export * from './controllers/guest-card.controller';
export * from './controllers/ball-transaction.controller';
export * from './controllers/ball-transfer.controller';
export * from './controllers/registration-link.controller';
export * from './controllers/guest-visit.controller';
```


***

```typescript
// ============================================
// apps/backend/src/app.module.ts (–¥–æ–±–∞–≤–∏—Ç—å GuestsModule)
// ============================================

import { Module } from '@nestjs/common';
import { ConfigModule } from '@nestjs/config';
import { PrismaModule } from './database/prisma.module';
import { AuthModule } from './modules/auth/auth.module';
import { UsersModule } from './modules/users/users.module';
import { TenantsModule } from './modules/tenants/tenants.module';
import { RestaurantsModule } from './modules/restaurants/restaurants.module';
import { RbacModule } from './modules/rbac/rbac.module';
import { ActivityLogModule } from './modules/activity-log/activity-log.module';
import { NotificationModule } from './modules/notifications/notification.module';
import { LoyaltyModule } from './modules/loyalty/loyalty.module';
import { GuestsModule } from './modules/guests/guests.module'; // ‚Üê –î–û–ë–ê–í–ò–¢–¨

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
    }),
    PrismaModule,
    AuthModule,
    UsersModule,
    TenantsModule,
    RestaurantsModule,
    RbacModule,
    ActivityLogModule,
    NotificationModule,
    LoyaltyModule,
    GuestsModule, // ‚Üê –î–û–ë–ê–í–ò–¢–¨
  ],
})
export class AppModule {}
```


***

## üéØ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–ê–ô–õ–´

### 1. **CRON JOB –¥–ª—è —Å–≥–æ—Ä–∞–Ω–∏—è –±–∞–ª–ª–æ–≤**

```typescript
// ============================================
// apps/backend/src/modules/guests/jobs/ball-expiration.job.ts
// ============================================

import { Injectable, Logger } from '@nestjs/common';
import { Cron, CronExpression } from '@nestjs/schedule';
import { PrismaService } from '@/database/prisma.service';
import { BallTransactionService } from '../services/ball-transaction.service';
import { CardStatus } from '@prisma/client';

@Injectable()
export class BallExpirationJob {
  private readonly logger = new Logger(BallExpirationJob.name);

  constructor(
    private prisma: PrismaService,
    private ballTransactionService: BallTransactionService,
  ) {}

  /**
   * –ö—Ä–æ–Ω-–¥–∂–æ–± –¥–ª—è —Å–≥–æ—Ä–∞–Ω–∏—è –±–∞–ª–ª–æ–≤
   * –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00
   */
  @Cron(CronExpression.EVERY_DAY_AT_MIDNIGHT)
  async handleBallExpiration() {
    this.logger.log('Starting ball expiration job...');

    try {
      // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç—ã —Å –∏—Å—Ç–µ–∫—à–∏–º —Å—Ä–æ–∫–æ–º –±–∞–ª–ª–æ–≤
      const expiredCards = await this.prisma.guestCard.findMany({
        where: {
          status: CardStatus.ACTIVE,
          deleted_at: null,
          balance: {
            gt: 0, // –¢–æ–ª—å–∫–æ —Å –±–∞–ª–∞–Ω—Å–æ–º > 0
          },
          balls_expire_at: {
            lte: new Date(), // –°—Ä–æ–∫ –∏—Å—Ç–µ–∫
          },
        },
      });

      this.logger.log(`Found ${expiredCards.length} cards with expired balls`);

      let processedCount = 0;
      let errorCount = 0;

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –∫–∞—Ä—Ç—É
      for (const card of expiredCards) {
        try {
          await this.ballTransactionService.expireBalls(card.id);
          processedCount++;
        } catch (error) {
          this.logger.error(
            `Failed to expire balls for card ${card.id}: ${error.message}`,
          );
          errorCount++;
        }
      }

      this.logger.log(
        `Ball expiration job completed. Processed: ${processedCount}, Errors: ${errorCount}`,
      );
    } catch (error) {
      this.logger.error(`Ball expiration job failed: ${error.message}`, error.stack);
    }
  }

  /**
   * –ö—Ä–æ–Ω-–¥–∂–æ–± –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Å–∫–æ—Ä–æ–º —Å–≥–æ—Ä–∞–Ω–∏–∏ –±–∞–ª–ª–æ–≤
   * –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
   * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ 7 –¥–Ω–µ–π –¥–æ —Å–≥–æ—Ä–∞–Ω–∏—è
   */
  @Cron('0 10 * * *') // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
  async handleBallExpirationWarning() {
    this.logger.log('Starting ball expiration warning job...');

    try {
      const sevenDaysFromNow = new Date();
      sevenDaysFromNow.setDate(sevenDaysFromNow.getDate() + 7);

      const eightDaysFromNow = new Date();
      eightDaysFromNow.setDate(eightDaysFromNow.getDate() + 8);

      // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç—ã —Å –±–∞–ª–ª–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–≥–æ—Ä—è—Ç —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
      const cardsToWarn = await this.prisma.guestCard.findMany({
        where: {
          status: CardStatus.ACTIVE,
          deleted_at: null,
          balance: {
            gt: 0,
          },
          balls_expire_at: {
            gte: sevenDaysFromNow,
            lt: eightDaysFromNow,
          },
        },
        include: {
          user: {
            include: {
              guest_profile: true,
            },
          },
        },
      });

      this.logger.log(`Found ${cardsToWarn.length} cards to warn about expiration`);

      for (const card of cardsToWarn) {
        try {
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ NotificationService)
          // await this.notificationService.sendBallExpirationWarning(
          //   card.user,
          //   card.balance,
          //   card.balls_expire_at,
          // );
          
          this.logger.log(
            `Sent expiration warning to user ${card.user_id} (${card.balance} balls)`,
          );
        } catch (error) {
          this.logger.error(
            `Failed to send warning to user ${card.user_id}: ${error.message}`,
          );
        }
      }

      this.logger.log('Ball expiration warning job completed');
    } catch (error) {
      this.logger.error(
        `Ball expiration warning job failed: ${error.message}`,
        error.stack,
      );
    }
  }
}
```


***

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π GuestsModule —Å CRON**

```typescript
// ============================================
// apps/backend/src/modules/guests/guests.module.ts (–û–ë–ù–û–í–õ–ï–ù–ù–´–ô)
// ============================================

import { Module } from '@nestjs/common';
import { ScheduleModule } from '@nestjs/schedule'; // ‚Üê –î–û–ë–ê–í–ò–¢–¨
import { PrismaModule } from '@/database/prisma.module';
import { ActivityLogModule } from '@/modules/activity-log/activity-log.module';
import { NotificationModule } from '@/modules/notifications/notification.module';
import { LoyaltyModule } from '@/modules/loyalty/loyalty.module';

// Services
import { GuestService } from './services/guest.service';
import { GuestCardService } from './services/guest-card.service';
import { BallTransactionService } from './services/ball-transaction.service';
import { BallTransferService } from './services/ball-transfer.service';
import { RegistrationLinkService } from './services/registration-link.service';
import { GuestVisitService } from './services/guest-visit.service';

// Controllers
import { GuestController } from './controllers/guest.controller';
import { GuestCardController } from './controllers/guest-card.controller';
import { BallTransactionController } from './controllers/ball-transaction.controller';
import { BallTransferController } from './controllers/ball-transfer.controller';
import { RegistrationLinkController } from './controllers/registration-link.controller';
import { GuestVisitController } from './controllers/guest-visit.controller';

// Jobs
import { BallExpirationJob } from './jobs/ball-expiration.job'; // ‚Üê –î–û–ë–ê–í–ò–¢–¨

@Module({
  imports: [
    ScheduleModule.forRoot(), // ‚Üê –î–û–ë–ê–í–ò–¢–¨ (–¥–ª—è cron jobs)
    PrismaModule,
    ActivityLogModule,
    NotificationModule,
    LoyaltyModule,
  ],
  controllers: [
    GuestController,
    GuestCardController,
    BallTransactionController,
    BallTransferController,
    RegistrationLinkController,
    GuestVisitController,
  ],
  providers: [
    GuestService,
    GuestCardService,
    BallTransactionService,
    BallTransferService,
    RegistrationLinkService,
    GuestVisitService,
    BallExpirationJob, // ‚Üê –î–û–ë–ê–í–ò–¢–¨
  ],
  exports: [
    GuestService,
    GuestCardService,
    BallTransactionService,
    BallTransferService,
    RegistrationLinkService,
    GuestVisitService,
  ],
})
export class GuestsModule {}
```


***

### 3. **–¢–µ—Å—Ç—ã (–ø—Ä–∏–º–µ—Ä –¥–ª—è GuestService)**

```typescript
// ============================================
// apps/backend/src/modules/guests/services/guest.service.spec.ts
// ============================================

import { Test, TestingModule } from '@nestjs/testing';
import { GuestService } from './guest.service';
import { PrismaService } from '@/database/prisma.service';
import { ActivityLogService } from '@/modules/activity-log/activity-log.service';
import { LoyaltyService } from '@/modules/loyalty/loyalty.service';
import { NotificationService } from '@/modules/notifications/notification.service';
import { BadRequestException, NotFoundException } from '@nestjs/common';
import { RegistrationSource } from '@prisma/client';

describe('GuestService', () => {
  let service: GuestService;
  let prisma: PrismaService;

  const mockPrismaService = {
    $transaction: jest.fn(),
    user: {
      findUnique: jest.fn(),
      create: jest.fn(),
    },
    guestProfile: {
      upsert: jest.fn(),
    },
    guestCard: {
      create: jest.fn(),
      findFirst: jest.fn(),
      findMany: jest.fn(),
      count: jest.fn(),
    },
    tenant: {
      findUnique: jest.fn(),
    },
  };

  const mockActivityLogService = {
    log: jest.fn(),
  };

  const mockLoyaltyService = {
    getLoyaltySystemByTenant: jest.fn(),
    calculateEarnPercentage: jest.fn(),
    checkLevelUpgrade: jest.fn(),
  };

  const mockNotificationService = {
    sendWelcomeNotification: jest.fn(),
    sendSMS: jest.fn(),
    savePhoneVerificationCode: jest.fn(),
  };

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        GuestService,
        { provide: PrismaService, useValue: mockPrismaService },
        { provide: ActivityLogService, useValue: mockActivityLogService },
        { provide: LoyaltyService, useValue: mockLoyaltyService },
        { provide: NotificationService, useValue: mockNotificationService },
      ],
    }).compile();

    service = module.get<GuestService>(GuestService);
    prisma = module.get<PrismaService>(PrismaService);
  });

  afterEach(() => {
    jest.clearAllMocks();
  });

  describe('createGuest', () => {
    it('should create a new guest successfully', async () => {
      const createGuestDto = {
        first_name: '–ò–≤–∞–Ω',
        phone: '+79991234567',
        privacy_policy_accepted: true,
        registration_source: RegistrationSource.POS,
        tenant_id: 'tenant-123',
        restaurant_id: 'restaurant-123',
      };

      const mockUser = {
        id: 'user-123',
        phone: '+79991234567',
        role: 'GUEST',
      };

      const mockGuestCard = {
        id: 'card-123',
        user_id: 'user-123',
        balance: 0,
        qr_code: 'QR_abc123',
        code_6_digit: '123456',
      };

      mockPrismaService.$transaction.mockImplementation(async (callback) => {
        return callback({
          user: {
            findUnique: jest.fn().resolvedValue(null),
            create: jest.fn().resolvedValue(mockUser),
          },
          guestProfile: {
            upsert: jest.fn().resolvedValue({}),
          },
          loyaltyLevel: {
            findFirst: jest.fn().resolvedValue({ id: 'level-1' }),
          },
          guestCard: {
            create: jest.fn().resolvedValue(mockGuestCard),
          },
        });
      });

      mockLoyaltyService.getLoyaltySystemByTenant.mockResolvedValue({
        id: 'loyalty-1',
        ball_expiration_days: 365,
      });

      const result = await service.createGuest(createGuestDto);

      expect(result).toBeDefined();
      expect(mockPrismaService.$transaction).toHaveBeenCalled();
    });

    it('should throw error if phone number already exists', async () => {
      const createGuestDto = {
        first_name: '–ò–≤–∞–Ω',
        phone: '+79991234567',
        privacy_policy_accepted: true,
        registration_source: RegistrationSource.POS,
        tenant_id: 'tenant-123',
      };

      mockPrismaService.guestCard.findFirst.mockResolvedValue({
        id: 'existing-card',
      });

      mockLoyaltyService.getLoyaltySystemByTenant.mockResolvedValue({
        mode: 'UNIFIED',
      });

      await expect(service.createGuest(createGuestDto)).rejects.toThrow(
        BadRequestException,
      );
    });
  });

  describe('getGuestByPhone', () => {
    it('should return guest card by phone number', async () => {
      const phone = '+79991234567';
      const tenantId = 'tenant-123';

      const mockGuestCard = {
        id: 'card-123',
        user: {
          phone: '+79991234567',
          guest_profile: {
            first_name: '–ò–≤–∞–Ω',
          },
        },
        balance: 100,
        status: 'ACTIVE',
      };

      mockPrismaService.guestCard.findFirst.mockResolvedValue(mockGuestCard);

      const result = await service.getGuestByPhone(phone, tenantId);

      expect(result).toEqual(mockGuestCard);
      expect(mockPrismaService.guestCard.findFirst).toHaveBeenCalledWith(
        expect.objectContaining({
          where: expect.objectContaining({
            user: { phone },
            tenant_id: tenantId,
          }),
        }),
      );
    });

    it('should throw NotFoundException if guest not found', async () => {
      mockPrismaService.guestCard.findFirst.mockResolvedValue(null);

      await expect(
        service.getGuestByPhone('+79991234567', 'tenant-123'),
      ).rejects.toThrow(NotFoundException);
    });
  });
});
```


***

### 4. **E2E —Ç–µ—Å—Ç (–ø—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Å—Ç—è)**

```typescript
// ============================================
// apps/backend/test/guests/guest-registration.e2e-spec.ts
// ============================================

import { Test, TestingModule } from '@nestjs/testing';
import { INestApplication } from '@nestjs/common';
import * as request from 'supertest';
import { AppModule } from '@/app.module';
import { PrismaService } from '@/database/prisma.service';

describe('Guest Registration (e2e)', () => {
  let app: INestApplication;
  let prisma: PrismaService;

  beforeAll(async () => {
    const moduleFixture: TestingModule = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    prisma = app.get(PrismaService);
    await app.init();
  });

  afterAll(async () => {
    await prisma.$disconnect();
    await app.close();
  });

  describe('POST /guests/register/pos', () => {
    it('should register a new guest via POS', async () => {
      const registerDto = {
        first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
        phone: '+79999999999',
        restaurant_id: 'test-restaurant-id',
      };

      const response = await request(app.getHttpServer())
        .post('/guests/register/pos')
        .set('Authorization', `Bearer ${process.env.TEST_CASHIER_TOKEN}`)
        .send(registerDto)
        .expect(201);

      expect(response.body).toHaveProperty('success', true);
      expect(response.body).toHaveProperty('guest_card');
      expect(response.body.guest_card).toHaveProperty('qr_code');
      expect(response.body.guest_card).toHaveProperty('code_6_digit');
      expect(response.body.guest_card.balance).toBe(0);
    });

    it('should return 400 if phone already exists', async () => {
      const registerDto = {
        first_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
        phone: '+79999999999', // –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ç–µ—Å—Ç–∞
        restaurant_id: 'test-restaurant-id',
      };

      await request(app.getHttpServer())
        .post('/guests/register/pos')
        .set('Authorization', `Bearer ${process.env.TEST_CASHIER_TOKEN}`)
        .send(registerDto)
        .expect(400);
    });
  });
});
```


***

### 5. **README –¥–ª—è –º–æ–¥—É–ª—è Guests**

```markdown
# üé´ Guests & Loyalty Cards Module

–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ—Å—Ç—è–º–∏ –∏ –∏—Ö –∫–∞—Ä—Ç–∞–º–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏.

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Å—Ç–µ–π
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ü–û–° (–∫–∞—Å—Å–∏—Ä–æ–º)
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ)
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –∏ –∫–∞—Ä—Ç—ã
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞)
- ‚úÖ –°–º–µ–Ω–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Å SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç—å–º–∏ (–¥–æ 3 –¥–µ—Ç–µ–π)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–ª–∞–º–∏
- ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –æ—Ç —á–µ–∫–∞
- ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –Ω–∞ —Å–∫–∏–¥–∫—É
- ‚úÖ –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ (Manager/Admin)
- ‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤ –º–µ–∂–¥—É –≥–æ—Å—Ç—è–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ–π
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã (–º—è–≥–∫–æ–µ)
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã (–±–∞–ª–ª—ã –ù–ï –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è)
- ‚úÖ –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (GDPR)

### –°—Å—ã–ª–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Å—Ç–µ–π
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–∞–º

## üöÄ API Endpoints

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```

POST /guests/register           - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST /guests/register/pos       - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ü–û–°
POST /guests/register/link      - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ
POST /guests/register/telegram  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram

```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```

GET  /guests                    - –°–ø–∏—Å–æ–∫ –≥–æ—Å—Ç–µ–π (—Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)
GET  /guests/:id                - –î–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç—è –ø–æ ID
POST /guests/by-qr              - –ü–æ–∏—Å–∫ –ø–æ QR –∫–æ–¥—É
POST /guests/by-code            - –ü–æ–∏—Å–∫ –ø–æ 6-–∑–Ω–∞—á–Ω–æ–º—É –∫–æ–¥—É
POST /guests/by-phone           - –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É

```

### –ü—Ä–æ—Ñ–∏–ª—å
```

PUT  /guests/profile                      - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
POST /guests/profile/change-phone/request - –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–º–µ–Ω—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
POST /guests/profile/change-phone/confirm - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–º–µ–Ω—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞

```

### –î–µ—Ç–∏
```

POST   /guests/children          - –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞
PUT    /guests/children/:id      - –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞
DELETE /guests/children/:id      - –£–¥–∞–ª–∏—Ç—å —Ä–µ–±–µ–Ω–∫–∞

```

### –ö–∞—Ä—Ç—ã
```

POST /guest-cards/block          - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É
POST /guest-cards/unblock        - –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É
POST /guest-cards/delete         - –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç—É
POST /guest-cards/restore        - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç—É
POST /guest-cards/request-data-deletion - –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (GDPR)

```

### –ë–∞–ª–ª—ã
```

POST /balls/earn              - –ù–∞—á–∏—Å–ª–∏—Ç—å –±–∞–ª–ª—ã
POST /balls/redeem            - –°–ø–∏—Å–∞—Ç—å –±–∞–ª–ª—ã
POST /balls/manual-add        - –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
POST /balls/manual-subtract   - –†—É—á–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ
POST /balls/cancel            - –û—Ç–º–µ–Ω–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
GET  /balls/transactions      - –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```

### –ü–µ—Ä–µ–≤–æ–¥—ã
```

POST /balls/transfer/initiate  - –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥
POST /balls/transfer/confirm   - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
POST /balls/transfer/cancel    - –û—Ç–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥
GET  /balls/transfer/history   - –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤

```

### –°—Å—ã–ª–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```

POST /registration-links              - –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É
GET  /registration-links              - –°–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫
GET  /registration-links/token/:token - –î–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ø–æ —Ç–æ–∫–µ–Ω—É
GET  /registration-links/:id/stats    - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Å—ã–ª–∫–∏
PUT  /registration-links/:id/activate - –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
PUT  /registration-links/:id/deactivate - –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É

```

### –ü–æ—Å–µ—â–µ–Ω–∏—è
```

GET /visits  - –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π

```

## üîí Permissions

```typescript
// –ì–æ—Å—Ç–∏
'create:guest'       - –°–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Å—Ç–µ–π
'read:guest'         - –ü—Ä–æ—Å–º–æ—Ç—Ä –≥–æ—Å—Ç–µ–π
'update:guest'       - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
'delete:guest'       - –£–¥–∞–ª–µ–Ω–∏–µ –≥–æ—Å—Ç–µ–π

// –ö–∞—Ä—Ç—ã
'manage:guest_card'  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏ (–±–ª–æ–∫/—É–¥–∞–ª–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)

// –ë–∞–ª–ª—ã
'manage:balls_pos'    - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏ —á–µ—Ä–µ–∑ –ü–û–°
'manage:balls_manual' - –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏
'read:balls'          - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –±–∞–ª–ª–æ–≤

// –°—Å—ã–ª–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
'manage:registration_links' - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
'read:registration_links'   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Å—ã–ª–æ–∫

// –ü–æ—Å–µ—â–µ–Ω–∏—è
'read:guest_visits'   - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π
```


## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
guests/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ guest.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ guest-card.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ ball-transaction.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ ball-transfer.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ registration-link.controller.ts
‚îÇ   ‚îî‚îÄ‚îÄ guest-visit.controller.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ guest.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ guest-card.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ ball-transaction.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ ball-transfer.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ registration-link.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ guest-visit.service.ts
‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îî‚îÄ‚îÄ (–≤—Å–µ DTOs)
‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îî‚îÄ‚îÄ ball-expiration.job.ts
‚îú‚îÄ‚îÄ guests.module.ts
‚îî‚îÄ‚îÄ index.ts
```


## üîÑ CRON Jobs

### Ball Expiration Job

- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00
- **–§—É–Ω–∫—Ü–∏—è**: –°–≥–æ—Ä–∞–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö –±–∞–ª–ª–æ–≤


### Ball Expiration Warning Job

- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
- **–§—É–Ω–∫—Ü–∏—è**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–∫–æ—Ä–æ–º —Å–≥–æ—Ä–∞–Ω–∏–∏ (–∑–∞ 7 –¥–Ω–µ–π)


## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ—Å—Ç—è —á–µ—Ä–µ–∑ –ü–û–°

```typescript
POST /guests/register/pos
Authorization: Bearer <cashier_token>

{
  "first_name": "–ò–≤–∞–Ω",
  "phone": "+79991234567",
  "birth_date": "1990-01-15",
  "restaurant_id": "restaurant-123"
}
```


### –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤

```typescript
POST /balls/earn
Authorization: Bearer <cashier_token>

{
  "guest_card_id": "card-123",
  "check_amount": 1000,
  "pos_transaction_id": "pos-txn-456"
}
```


### –ü–µ—Ä–µ–≤–æ–¥ –±–∞–ª–ª–æ–≤

```typescript
// –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞—Ü–∏—è
POST /balls/transfer/initiate
Authorization: Bearer <guest_token>

{
  "sender_card_id": "card-123",
  "receiver_phone": "+79997654321",
  "amount": 50
}

// –®–∞–≥ 2: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
POST /balls/transfer/confirm
Authorization: Bearer <guest_token>

{
  "transfer_id": "transfer-789",
  "verification_code": "123456"
}
```


## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
npm run test guests

# E2E —Ç–µ—Å—Ç—ã
npm run test:e2e guests

# Coverage
npm run test:cov guests
```


## üìä –ú–µ—Ç—Ä–∏–∫–∏

- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π
- –ê–∫—Ç–∏–≤–Ω—ã–µ/–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ/—É–¥–∞–ª–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
- –°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö/—Å–ø–∏—Å–∞–Ω–Ω—ã—Ö –±–∞–ª–ª–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –º–µ–∂–¥—É –≥–æ—Å—Ç—è–º–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Å—ã–ª–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏


## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –±–∞–ª–ª–æ–≤
- –õ–∏–º–∏—Ç –Ω–∞ —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (—Ä–∞–∑ –≤ 3 –º–µ—Å—è—Ü–∞)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ ActivityLog
- GDPR-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```

***

‚úÖ **–ü–û–õ–ù–´–ô –ú–û–î–£–õ–¨ GUESTS & LOYALTY CARDS –ì–û–¢–û–í!**

–ß—Ç–æ –¥–∞–ª—å—à–µ? –°–æ–∑–¥–∞—Ç—å **–ú–û–î–£–õ–¨ PROMO** (–ê–∫—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã)? üéÅ

---

# –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π –º–Ω–µ –ø–æ–ª–Ω—ã–µ –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω—ã–µ –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .md –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è, —Å–æ –≤—Å–µ–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –º–æ–¥—É–ª—è, –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ, —Å–æ –≤—Å–µ–º–∏ –Ω—é–∞–Ω–∑–∞–º–∏ –∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑—è–º–∏, —Å–æ –≤—Å–µ–º–∏ –∫–æ–¥–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É–π—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤, –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –±–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤, —á–µ–º —É—Ä–µ–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. –í—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –ø–æ–ª–Ω–æ. –ü—Ä–∏—Å—Ç—É–ø–∞–π

Answer skipped.

---

# –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π –º–Ω–µ –ø–æ–ª–Ω—ã–µ –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω—ã–µ –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .md –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è, —Å–æ –≤—Å–µ–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –º–æ–¥—É–ª—è, –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ, —Å–æ –≤—Å–µ–º–∏ –Ω—é–∞–Ω–∑–∞–º–∏ –∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑—è–º–∏, —Å–æ –≤—Å–µ–º–∏ –∫–æ–¥–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É–π—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤, –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –±–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤, —á–µ–º —É—Ä–µ–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. –í—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –ø–æ–ª–Ω–æ. –ü—Ä–∏—Å—Ç—É–ø–∞–π

Answer skipped.

---

# –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π –º–Ω–µ –ø–æ–ª–Ω—ã–µ –¥–æ—Å–∫–∞–Ω–∞–ª—å–Ω—ã–µ –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –≤ —ç—Ç–æ–º –¥–∏–∞–ª–æ–≥–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .md –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è, —Å–æ –≤—Å–µ–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –º–æ–¥—É–ª—è, –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ, —Å–æ –≤—Å–µ–º–∏ –Ω—é–∞–Ω—Å–∞–º–∏ –∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑—è–º–∏, —Å–æ –≤—Å–µ–º–∏ –∫–æ–¥–∞–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É–π—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤, –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –±–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤, —á–µ–º —É—Ä–µ–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. –í—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –ø–æ–ª–Ω–æ. –ü—Ä–∏—Å—Ç—É–ø–∞–π

–û—Ç–ª–∏—á–Ω–æ! –Ø —Å–æ–∑–¥–∞–ª –ø–æ–ª–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è –≥–æ—Å—Ç–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏. –í–æ—Ç —á—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ:

## üìö –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

### 1Ô∏è‚É£ **01-prisma-schema.md** 
–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Prisma —Å–æ –≤—Å–µ–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏, —Å–≤—è–∑—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

### 2Ô∏è‚É£ **02-database-architecture.md**
–î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏ —Å–≤—è–∑–µ–π, –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### 3Ô∏è‚É£ **03-dto-complete.md**
–í—Å–µ DTOs (Data Transfer Objects) —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π, –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏

### 4Ô∏è‚É£ **04-services-part1.md**
GuestService –∏ GuestCardService - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø—Ä–æ—Ñ–∏–ª—å, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏

### 5Ô∏è‚É£ **05-services-part2.md**
BallTransactionService –∏ BallTransferService - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–ª–∞–º–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥—ã

### 6Ô∏è‚É£ **06-controllers.md**
–í—Å–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

### 7Ô∏è‚É£ **07-security-validation.md**
–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, JWT, Guards, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, Rate Limiting

### 8Ô∏è‚É£ **08-integrations-cron.md**
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ü–û–°, SMS/Email, Telegram –±–æ—Ç, CRON –∑–∞–¥–∞—á–∏, Webhooks

### 9Ô∏è‚É£ **09-examples-scenarios.md**
–ü–æ–ª–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –∫–æ–¥–æ–º –Ω–∞ TypeScript/React

***

## üéØ –ß—Ç–æ –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: 15+ —Ç–∞–±–ª–∏—Ü —Å–æ —Å–≤—è–∑—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏  
‚úÖ **API**: 30+ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: JWT, Guards, Rate Limiting  
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è**: class-validator —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏  
‚úÖ **–°–µ—Ä–≤–∏—Å—ã**: –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–¥—Ä–æ–±–Ω–æ  
‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**: –ü–û–°, SMS, Email, Telegram  
‚úÖ **CRON**: –°–≥–æ—Ä–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  
‚úÖ **–ü—Ä–∏–º–µ—Ä—ã**: –ü–æ–ª–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å –∫–æ–¥–æ–º  

–í—Å–µ —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é! –ö–∞–∂–¥—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- –î–∏–∞–≥—Ä–∞–º–º—ã —Å–≤—è–∑–µ–π
- –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- Best practices

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –∏ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥—ã! üöÄ```

